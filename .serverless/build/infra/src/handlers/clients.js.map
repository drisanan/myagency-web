{
  "version": 3,
  "sources": ["../../../../../infra/src/handlers/clients.ts"],
  "sourcesContent": ["export type Client = {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n  agencyId: string;\n  agencyEmail?: string;\n  createdAt: string;\n  updatedAt: string;\n  deletedAt?: string;\n};\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || process.env.API_BASE_URL;\n\nfunction requireApiBase() {\n  if (!API_BASE_URL) throw new Error('API_BASE_URL is not configured');\n  return API_BASE_URL;\n}\n\n// The Critical Helper: Ensures credentials (cookies) are sent with every request\nasync function apiFetch(path: string, init?: RequestInit) {\n  const base = requireApiBase();\n  if (typeof fetch === 'undefined') {\n    throw new Error('fetch is not available');\n  }\n  \n  const headers: Record<string, string> = { \n    'Content-Type': 'application/json', \n    ...(init?.headers as any) \n  };\n  \n  const url = `${base}${path}`;\n  \n  const options: RequestInit = { \n    ...init, \n    headers, \n    credentials: 'include' // <--- THIS FIXES THE 401 \"MISSING SESSION\"\n  };\n\n  // Logging to match tasks.ts pattern for debugging\n  console.log('[clients.apiFetch]', {\n    url,\n    method: options.method || 'GET',\n    hasBody: Boolean(options.body),\n    credentials: options.credentials,\n  });\n\n  const res = await fetch(url, options);\n  \n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API ${path} failed: ${res.status} ${text}`);\n  }\n  return res.json();\n}\n\nexport async function listClients() {\n  // GET /clients\n  const data = await apiFetch('/clients');\n  return (data?.clients as Client[]) ?? [];\n}\n\nexport async function getClient(id: string) {\n  // GET /clients/:id\n  const data = await apiFetch(`/clients/${id}`);\n  return data?.client as Client | null;\n}\n\nexport async function createClient(input: {\n  email: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n}) {\n  // POST /clients\n  const data = await apiFetch('/clients', { \n    method: 'POST', \n    body: JSON.stringify(input) \n  });\n  return data?.client as Client;\n}\n\nexport async function updateClient(id: string, patch: Partial<Omit<Client, 'id' | 'createdAt' | 'agencyId'>>) {\n  // PATCH /clients/:id\n  const data = await apiFetch(`/clients/${id}`, { \n    method: 'PATCH', \n    body: JSON.stringify(patch) \n  });\n  return data?.client as Client;\n}\n\nexport async function deleteClient(id: string) {\n  // DELETE /clients/:id\n  await apiFetch(`/clients/${id}`, { method: 'DELETE' });\n  return { ok: true };\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA,IAAM,eAAe,QAAQ,IAAI,4BAA4B,QAAQ,IAAI;AAEzE,SAAS,iBAAiB;AACxB,MAAI,CAAC,aAAc,OAAM,IAAI,MAAM,gCAAgC;AACnE,SAAO;AACT;AAGA,eAAe,SAAS,MAAc,MAAoB;AACxD,QAAM,OAAO,eAAe;AAC5B,MAAI,OAAO,UAAU,aAAa;AAChC,UAAM,IAAI,MAAM,wBAAwB;AAAA,EAC1C;AAEA,QAAM,UAAkC;AAAA,IACtC,gBAAgB;AAAA,IAChB,GAAI,MAAM;AAAA,EACZ;AAEA,QAAM,MAAM,GAAG,IAAI,GAAG,IAAI;AAE1B,QAAM,UAAuB;AAAA,IAC3B,GAAG;AAAA,IACH;AAAA,IACA,aAAa;AAAA;AAAA,EACf;AAGA,UAAQ,IAAI,sBAAsB;AAAA,IAChC;AAAA,IACA,QAAQ,QAAQ,UAAU;AAAA,IAC1B,SAAS,QAAQ,QAAQ,IAAI;AAAA,IAC7B,aAAa,QAAQ;AAAA,EACvB,CAAC;AAED,QAAM,MAAM,MAAM,MAAM,KAAK,OAAO;AAEpC,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,IAAI,MAAM,OAAO,IAAI,YAAY,IAAI,MAAM,IAAI,IAAI,EAAE;AAAA,EAC7D;AACA,SAAO,IAAI,KAAK;AAClB;AAEA,eAAsB,cAAc;AAElC,QAAM,OAAO,MAAM,SAAS,UAAU;AACtC,SAAQ,MAAM,WAAwB,CAAC;AACzC;AAEA,eAAsB,UAAU,IAAY;AAE1C,QAAM,OAAO,MAAM,SAAS,YAAY,EAAE,EAAE;AAC5C,SAAO,MAAM;AACf;AAEA,eAAsB,aAAa,OAKhC;AAED,QAAM,OAAO,MAAM,SAAS,YAAY;AAAA,IACtC,QAAQ;AAAA,IACR,MAAM,KAAK,UAAU,KAAK;AAAA,EAC5B,CAAC;AACD,SAAO,MAAM;AACf;AAEA,eAAsB,aAAa,IAAY,OAA+D;AAE5G,QAAM,OAAO,MAAM,SAAS,YAAY,EAAE,IAAI;AAAA,IAC5C,QAAQ;AAAA,IACR,MAAM,KAAK,UAAU,KAAK;AAAA,EAC5B,CAAC;AACD,SAAO,MAAM;AACf;AAEA,eAAsB,aAAa,IAAY;AAE7C,QAAM,SAAS,YAAY,EAAE,IAAI,EAAE,QAAQ,SAAS,CAAC;AACrD,SAAO,EAAE,IAAI,KAAK;AACpB;",
  "names": []
}
