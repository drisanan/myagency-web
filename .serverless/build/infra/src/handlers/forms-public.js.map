{
  "version": 3,
  "sources": ["../../../../../infra/src/handlers/forms-public.ts"],
  "sourcesContent": ["export type FormSubmissionData = {\n  email: string;\n  phone?: string;\n  password?: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n  division?: string;\n  graduationYear?: string;\n  profileImageUrl?: string;\n  radar?: Record<string, number>;\n};\n\nexport type FormSubmissionRecord = {\n  id: string;\n  PK: string;\n  SK: string;\n  createdAt: number;\n  consumed: boolean;\n  agencyEmail: string;\n  data: FormSubmissionData;\n};\n\nexport type AgencyPublicProfile = {\n  name: string;\n  email: string;\n  settings: Record<string, any>;\n};\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || process.env.API_BASE_URL;\n\nfunction requireApiBase() {\n  if (!API_BASE_URL) throw new Error('API_BASE_URL is not configured');\n  return API_BASE_URL;\n}\n\n// Standardized fetch wrapper ensuring credentials (cookies) are sent\nasync function apiFetch(path: string, init?: RequestInit) {\n  const base = requireApiBase();\n  if (typeof fetch === 'undefined') {\n    throw new Error('fetch is not available');\n  }\n\n  const headers: Record<string, string> = { \n    'Content-Type': 'application/json', \n    ...(init?.headers as any) \n  };\n\n  const url = `${base}${path}`;\n  const options: RequestInit = { \n    ...init, \n    headers, \n    credentials: 'include' // <--- Key for session persistence\n  };\n\n  console.log('[forms.apiFetch]', {\n    url,\n    method: options.method || 'GET',\n    hasBody: Boolean(options.body),\n    credentials: options.credentials,\n  });\n\n  const res = await fetch(url, options);\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API ${path} failed: ${res.status} ${text}`);\n  }\n  return res.json();\n}\n\n/**\n * Issues a new signed token for a public form.\n */\nexport async function issueFormToken(agencyEmail: string) {\n  // POST /forms/issue\n  const data = await apiFetch('/forms/issue', {\n    method: 'POST',\n    body: JSON.stringify({ agencyEmail }),\n  });\n  return data as { ok: boolean; token: string; url: string };\n}\n\n/**\n * Retrieves public agency details using a form token.\n */\nexport async function getFormAgency(token: string) {\n  // GET /forms/agency?token=...\n  const qs = new URLSearchParams({ token }).toString();\n  const data = await apiFetch(`/forms/agency?${qs}`);\n  return data?.agency as AgencyPublicProfile;\n}\n\n/**\n * Submits a new form entry.\n */\nexport async function submitForm(token: string, form: Partial<FormSubmissionData>) {\n  // POST /forms/submit\n  const data = await apiFetch('/forms/submit', {\n    method: 'POST',\n    body: JSON.stringify({ token, form }),\n  });\n  return data as { ok: boolean; id: string };\n}\n\n/**\n * Lists pending (unconsumed) form submissions for an agency.\n */\nexport async function listFormSubmissions(agencyEmail: string) {\n  // GET /forms/submissions?agencyEmail=...\n  const qs = new URLSearchParams({ agencyEmail }).toString();\n  const data = await apiFetch(`/forms/submissions?${qs}`);\n  return (data?.items as FormSubmissionRecord[]) ?? [];\n}\n\n/**\n * Marks specific form submissions as consumed (processed).\n */\nexport async function consumeFormSubmissions(agencyEmail: string, ids: string[]) {\n  // POST /forms/consume\n  await apiFetch('/forms/consume', {\n    method: 'POST',\n    body: JSON.stringify({ agencyEmail, ids }),\n  });\n  return { ok: true };\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BA,IAAM,eAAe,QAAQ,IAAI,4BAA4B,QAAQ,IAAI;AAEzE,SAAS,iBAAiB;AACxB,MAAI,CAAC,aAAc,OAAM,IAAI,MAAM,gCAAgC;AACnE,SAAO;AACT;AAGA,eAAe,SAAS,MAAc,MAAoB;AACxD,QAAM,OAAO,eAAe;AAC5B,MAAI,OAAO,UAAU,aAAa;AAChC,UAAM,IAAI,MAAM,wBAAwB;AAAA,EAC1C;AAEA,QAAM,UAAkC;AAAA,IACtC,gBAAgB;AAAA,IAChB,GAAI,MAAM;AAAA,EACZ;AAEA,QAAM,MAAM,GAAG,IAAI,GAAG,IAAI;AAC1B,QAAM,UAAuB;AAAA,IAC3B,GAAG;AAAA,IACH;AAAA,IACA,aAAa;AAAA;AAAA,EACf;AAEA,UAAQ,IAAI,oBAAoB;AAAA,IAC9B;AAAA,IACA,QAAQ,QAAQ,UAAU;AAAA,IAC1B,SAAS,QAAQ,QAAQ,IAAI;AAAA,IAC7B,aAAa,QAAQ;AAAA,EACvB,CAAC;AAED,QAAM,MAAM,MAAM,MAAM,KAAK,OAAO;AAEpC,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,IAAI,MAAM,OAAO,IAAI,YAAY,IAAI,MAAM,IAAI,IAAI,EAAE;AAAA,EAC7D;AACA,SAAO,IAAI,KAAK;AAClB;AAKA,eAAsB,eAAe,aAAqB;AAExD,QAAM,OAAO,MAAM,SAAS,gBAAgB;AAAA,IAC1C,QAAQ;AAAA,IACR,MAAM,KAAK,UAAU,EAAE,YAAY,CAAC;AAAA,EACtC,CAAC;AACD,SAAO;AACT;AAKA,eAAsB,cAAc,OAAe;AAEjD,QAAM,KAAK,IAAI,gBAAgB,EAAE,MAAM,CAAC,EAAE,SAAS;AACnD,QAAM,OAAO,MAAM,SAAS,iBAAiB,EAAE,EAAE;AACjD,SAAO,MAAM;AACf;AAKA,eAAsB,WAAW,OAAe,MAAmC;AAEjF,QAAM,OAAO,MAAM,SAAS,iBAAiB;AAAA,IAC3C,QAAQ;AAAA,IACR,MAAM,KAAK,UAAU,EAAE,OAAO,KAAK,CAAC;AAAA,EACtC,CAAC;AACD,SAAO;AACT;AAKA,eAAsB,oBAAoB,aAAqB;AAE7D,QAAM,KAAK,IAAI,gBAAgB,EAAE,YAAY,CAAC,EAAE,SAAS;AACzD,QAAM,OAAO,MAAM,SAAS,sBAAsB,EAAE,EAAE;AACtD,SAAQ,MAAM,SAAoC,CAAC;AACrD;AAKA,eAAsB,uBAAuB,aAAqB,KAAe;AAE/E,QAAM,SAAS,kBAAkB;AAAA,IAC/B,QAAQ;AAAA,IACR,MAAM,KAAK,UAAU,EAAE,aAAa,IAAI,CAAC;AAAA,EAC3C,CAAC;AACD,SAAO,EAAE,IAAI,KAAK;AACpB;",
  "names": []
}
