{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/agencies.ts"],"sourcesContent":["const STORAGE_KEY = 'agencies_data';\n\nfunction readStore(): Agency[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    return JSON.parse(raw) as Agency[];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeStore(items: Agency[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nexport type AgencySettings = {\n  primaryColor?: string;\n  secondaryColor?: string;\n  logoDataUrl?: string;\n};\nexport type Agency = {\n  id: string;\n  name: string;\n  email: string;\n  password?: string;\n  ownerFirstName?: string;\n  ownerLastName?: string;\n  ownerEmail?: string;\n  ownerPhone?: string;\n  active?: boolean;\n  settings?: AgencySettings;\n};\n\nconst SEED_AGENCIES: Agency[] = [\n  { id: 'agency-001', name: 'Prime Sports', email: 'agency1@an.test', settings: { primaryColor: '#1976d2' } },\n  { id: 'agency-002', name: 'NextGen', email: 'agency2@an.test', settings: { primaryColor: '#9c27b0' } },\n  { id: 'agency-003', name: 'Elite Edge', email: 'agency3@an.test', settings: { primaryColor: '#2e7d32' } },\n];\n\nlet AGENCIES: Agency[] = (() => {\n  const fromStore = readStore();\n  if (fromStore.length > 0) return fromStore;\n  writeStore(SEED_AGENCIES);\n  return [...SEED_AGENCIES];\n})();\n\nexport { AGENCIES };\n\nexport async function listAgencies() {\n  return AGENCIES.map(a => ({ id: a.id, name: a.name }));\n}\n\nexport async function getAgencies() {\n  return [...AGENCIES];\n}\n\nexport async function getAgencyByEmail(email: string) {\n  return AGENCIES.find(a => a.email === email) ?? null;\n}\n\nexport async function getAgencyById(id: string) {\n  return AGENCIES.find(a => a.id === id) ?? null;\n}\n\nexport async function getAgencySettings(email: string) {\n  const a = AGENCIES.find(x => x.email === email);\n  return a?.settings ?? {};\n}\n\nexport async function updateAgencySettings(email: string, settings: AgencySettings) {\n  const a = AGENCIES.find(x => x.email === email);\n  if (!a) return { ok: false };\n  a.settings = { ...(a.settings ?? {}), ...settings };\n  writeStore(AGENCIES);\n  return { ok: true, settings: a.settings };\n}\n\ntype UpsertInput = Omit<Agency, 'id'> & { id?: string };\nexport async function upsertAgency(input: UpsertInput) {\n  if (input.id) {\n    const idx = AGENCIES.findIndex(a => a.id === input.id);\n    if (idx >= 0) {\n      AGENCIES[idx] = { ...AGENCIES[idx], ...input, id: input.id };\n      writeStore(AGENCIES);\n      return { id: input.id };\n    }\n  }\n  const id = `agency-${(Math.random() * 1e6).toFixed(0)}`;\n  AGENCIES.push({\n    id,\n    name: input.name,\n    email: input.email,\n    password: input.password,\n    ownerFirstName: input.ownerFirstName,\n    ownerLastName: input.ownerLastName,\n    ownerEmail: input.ownerEmail,\n    ownerPhone: input.ownerPhone,\n    active: input.active ?? true,\n    settings: input.settings ?? {},\n  });\n  writeStore(AGENCIES);\n  return { id };\n}\n\nexport async function deleteAgency(id: string) {\n  const idx = AGENCIES.findIndex(a => a.id === id);\n  if (idx >= 0) {\n    AGENCIES.splice(idx, 1);\n    writeStore(AGENCIES);\n    return { ok: true };\n  }\n  return { ok: false };\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 165, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/agencies/page.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { Box, Button, Typography } from '@mui/material';\nimport { DataGrid, GridColDef } from '@mui/x-data-grid';\nimport Link from 'next/link';\nimport { getAgencies } from '@/services/agencies';\nimport { useSession } from '@/features/auth/session';\nimport { useRouter } from 'next/navigation';\nimport { logImpersonationStart } from '@/services/audit';\n\nexport default function AgenciesPage() {\n  const { session, setSession } = useSession();\n  const router = useRouter();\n  const [rows, setRows] = React.useState<any[]>([]);\n\n  React.useEffect(() => {\n    if (session?.role !== 'parent') {\n      router.push('/dashboard');\n      return;\n    }\n    getAgencies().then(list => {\n      setRows(list.map(a => ({ id: a.id, name: a.name, email: a.email, active: a.active ?? true })));\n    });\n  }, [session, router]);\n\n  const columns: GridColDef[] = [\n    { field: 'name', headerName: 'Name', flex: 1 },\n    { field: 'email', headerName: 'Email', flex: 1 },\n    { field: 'active', headerName: 'Active', width: 120 },\n    {\n      field: 'actions',\n      headerName: 'Actions',\n      width: 180,\n      renderCell: (params) => {\n        const impersonate = () => {\n          if (!session) return;\n          const parent = session;\n          // save base session to restore later\n          if (typeof window !== 'undefined') {\n            window.localStorage.setItem('session_impersonation_base', JSON.stringify(parent));\n          }\n          logImpersonationStart(parent.email, params.row.email);\n          setSession({ role: 'agency', email: params.row.email, agencyId: params.row.id, impersonatedBy: { email: parent.email, role: 'parent' } } as any);\n          router.push('/dashboard');\n        };\n        return (\n          <Button size=\"small\" onClick={impersonate}>Impersonate</Button>\n        );\n      }\n    },\n  ];\n\n  return (\n    <Box>\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n        <Typography variant=\"h5\">Agencies</Typography>\n        <Button data-testid=\"agencies-new\" LinkComponent={Link} href=\"/agencies/new\" variant=\"contained\">New Agency</Button>\n      </Box>\n      <div style={{ height: 440, width: 800 }}>\n        <DataGrid rows={rows} columns={columns} disableRowSelectionOnClick />\n      </div>\n    </Box>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;;AAUe,SAAS;;IACtB,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,IAAA,6IAAU;IAC1C,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,wKAAK,CAAC,QAAQ,CAAQ,EAAE;IAEhD,wKAAK,CAAC,SAAS;kCAAC;YACd,IAAI,SAAS,SAAS,UAAU;gBAC9B,OAAO,IAAI,CAAC;gBACZ;YACF;YACA,IAAA,sIAAW,IAAG,IAAI;0CAAC,CAAA;oBACjB,QAAQ,KAAK,GAAG;kDAAC,CAAA,IAAK,CAAC;gCAAE,IAAI,EAAE,EAAE;gCAAE,MAAM,EAAE,IAAI;gCAAE,OAAO,EAAE,KAAK;gCAAE,QAAQ,EAAE,MAAM,IAAI;4BAAK,CAAC;;gBAC7F;;QACF;iCAAG;QAAC;QAAS;KAAO;IAEpB,MAAM,UAAwB;QAC5B;YAAE,OAAO;YAAQ,YAAY;YAAQ,MAAM;QAAE;QAC7C;YAAE,OAAO;YAAS,YAAY;YAAS,MAAM;QAAE;QAC/C;YAAE,OAAO;YAAU,YAAY;YAAU,OAAO;QAAI;QACpD;YACE,OAAO;YACP,YAAY;YACZ,OAAO;YACP,YAAY,CAAC;gBACX,MAAM,cAAc;oBAClB,IAAI,CAAC,SAAS;oBACd,MAAM,SAAS;oBACf,qCAAqC;oBACrC,wCAAmC;wBACjC,OAAO,YAAY,CAAC,OAAO,CAAC,8BAA8B,KAAK,SAAS,CAAC;oBAC3E;oBACA,IAAA,6IAAqB,EAAC,OAAO,KAAK,EAAE,OAAO,GAAG,CAAC,KAAK;oBACpD,WAAW;wBAAE,MAAM;wBAAU,OAAO,OAAO,GAAG,CAAC,KAAK;wBAAE,UAAU,OAAO,GAAG,CAAC,EAAE;wBAAE,gBAAgB;4BAAE,OAAO,OAAO,KAAK;4BAAE,MAAM;wBAAS;oBAAE;oBACvI,OAAO,IAAI,CAAC;gBACd;gBACA,qBACE,6LAAC,8MAAM;oBAAC,MAAK;oBAAQ,SAAS;8BAAa;;;;;;YAE/C;QACF;KACD;IAED,qBACE,6LAAC,kMAAG;;0BACF,6LAAC,kMAAG;gBAAC,IAAI;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,YAAY;oBAAU,IAAI;gBAAE;;kCACvF,6LAAC,8NAAU;wBAAC,SAAQ;kCAAK;;;;;;kCACzB,6LAAC,8MAAM;wBAAC,eAAY;wBAAe,eAAe,0KAAI;wBAAE,MAAK;wBAAgB,SAAQ;kCAAY;;;;;;;;;;;;0BAEnG,6LAAC;gBAAI,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAI;0BACpC,cAAA,6LAAC,wLAAQ;oBAAC,MAAM;oBAAM,SAAS;oBAAS,0BAA0B;;;;;;;;;;;;;;;;;AAI1E;GArDwB;;QACU,6IAAU;QAC3B,kJAAS;;;KAFF"}}]
}