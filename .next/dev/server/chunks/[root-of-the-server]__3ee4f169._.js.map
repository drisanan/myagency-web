{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/store.ts"],"sourcesContent":["type Submission = {\n  id: string;\n  createdAt: number;\n  data: any;\n  consumed?: boolean;\n};\n\nconst SUBMISSIONS: { [agencyEmail: string]: Submission[] } = {};\nconst STORAGE_KEY = 'form_submissions_v1';\nconst FILE_PATH = (() => {\n  try {\n    const path = require('path');\n    return path.join(process.cwd(), 'tmp-forms-submissions.json');\n  } catch {\n    return null;\n  }\n})();\nconst fs = (() => {\n  try { return require('fs'); } catch { return null; }\n})();\n\nfunction readStore(): { [agencyEmail: string]: Submission[] } {\n  if (typeof window === 'undefined') {\n    if (fs && FILE_PATH && fs.existsSync(FILE_PATH)) {\n      try {\n        const raw = fs.readFileSync(FILE_PATH, 'utf-8');\n        return raw ? (JSON.parse(raw) as { [agencyEmail: string]: Submission[] }) : {};\n      } catch {\n        return {};\n      }\n    }\n    return {};\n  }\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    return raw ? (JSON.parse(raw) as { [agencyEmail: string]: Submission[] }) : {};\n  } catch {\n    return {};\n  }\n}\n\nfunction writeStore(data: { [agencyEmail: string]: Submission[] }) {\n  if (typeof window === 'undefined') {\n    try {\n      if (fs && FILE_PATH) {\n        const path = require('path');\n        const dir = path.dirname(FILE_PATH);\n        if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n        fs.writeFileSync(FILE_PATH, JSON.stringify(data), 'utf-8');\n      }\n    } catch {\n      // ignore\n    }\n  } else {\n    try {\n      window.localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n    } catch {\n      // ignore\n    }\n  }\n}\n\nfunction syncFromStorage() {\n  const latest = readStore();\n  // Replace in-memory with latest\n  Object.keys(SUBMISSIONS).forEach((k) => delete SUBMISSIONS[k]);\n  Object.entries(latest).forEach(([k, v]) => {\n    SUBMISSIONS[k] = v;\n  });\n}\n\n// Initialize from storage\nObject.assign(SUBMISSIONS, readStore());\n\nfunction persist() {\n  writeStore(SUBMISSIONS);\n}\n\nexport function putSubmission(agencyEmail: string, data: any): Submission {\n  const id = `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n  const rec: Submission = { id, createdAt: Date.now(), data, consumed: false };\n  if (!SUBMISSIONS[agencyEmail]) SUBMISSIONS[agencyEmail] = [];\n  SUBMISSIONS[agencyEmail].unshift(rec);\n  persist();\n  return rec;\n}\n\nexport function listSubmissions(agencyEmail: string, includeConsumed = false): Submission[] {\n  syncFromStorage();\n  const all = SUBMISSIONS[agencyEmail] || [];\n  return includeConsumed ? all.slice() : all.filter((s) => !s.consumed);\n}\n\nexport function consumeSubmissions(agencyEmail: string, ids: string[]) {\n  const all = SUBMISSIONS[agencyEmail] || [];\n  const set = new Set(ids);\n  all.forEach((s) => {\n    if (set.has(s.id)) s.consumed = true;\n  });\n  persist();\n}\n\n\n"],"names":[],"mappings":";;;;;;;;AAOA,MAAM,cAAuD,CAAC;AAC9D,MAAM,cAAc;AACpB,MAAM,YAAY,CAAC;IACjB,IAAI;QACF,MAAM;QACN,OAAO,KAAK,IAAI,CAAC,QAAQ,GAAG,IAAI;IAClC,EAAE,OAAM;QACN,OAAO;IACT;AACF,CAAC;AACD,MAAM,KAAK,CAAC;IACV,IAAI;QAAE;IAAsB,EAAE,OAAM;QAAE,OAAO;IAAM;AACrD,CAAC;AAED,SAAS;IACP,wCAAmC;QACjC,IAAI,MAAM,aAAa,GAAG,UAAU,CAAC,YAAY;YAC/C,IAAI;gBACF,MAAM,MAAM,GAAG,YAAY,CAAC,WAAW;gBACvC,OAAO,MAAO,KAAK,KAAK,CAAC,OAAmD,CAAC;YAC/E,EAAE,OAAM;gBACN,OAAO,CAAC;YACV;QACF;QACA,OAAO,CAAC;IACV;;;AAOF;AAEA,SAAS,WAAW,IAA6C;IAC/D,wCAAmC;QACjC,IAAI;YACF,IAAI,MAAM,WAAW;gBACnB,MAAM;gBACN,MAAM,MAAM,KAAK,OAAO,CAAC;gBACzB,IAAI,CAAC,GAAG,UAAU,CAAC,MAAM,GAAG,SAAS,CAAC,KAAK;oBAAE,WAAW;gBAAK;gBAC7D,GAAG,aAAa,CAAC,WAAW,KAAK,SAAS,CAAC,OAAO;YACpD;QACF,EAAE,OAAM;QACN,SAAS;QACX;IACF;;AAOF;AAEA,SAAS;IACP,MAAM,SAAS;IACf,gCAAgC;IAChC,OAAO,IAAI,CAAC,aAAa,OAAO,CAAC,CAAC,IAAM,OAAO,WAAW,CAAC,EAAE;IAC7D,OAAO,OAAO,CAAC,QAAQ,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE;QACpC,WAAW,CAAC,EAAE,GAAG;IACnB;AACF;AAEA,0BAA0B;AAC1B,OAAO,MAAM,CAAC,aAAa;AAE3B,SAAS;IACP,WAAW;AACb;AAEO,SAAS,cAAc,WAAmB,EAAE,IAAS;IAC1D,MAAM,KAAK,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;IACpE,MAAM,MAAkB;QAAE;QAAI,WAAW,KAAK,GAAG;QAAI;QAAM,UAAU;IAAM;IAC3E,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE,WAAW,CAAC,YAAY,GAAG,EAAE;IAC5D,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC;IACjC;IACA,OAAO;AACT;AAEO,SAAS,gBAAgB,WAAmB,EAAE,kBAAkB,KAAK;IAC1E;IACA,MAAM,MAAM,WAAW,CAAC,YAAY,IAAI,EAAE;IAC1C,OAAO,kBAAkB,IAAI,KAAK,KAAK,IAAI,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,QAAQ;AACtE;AAEO,SAAS,mBAAmB,WAAmB,EAAE,GAAa;IACnE,MAAM,MAAM,WAAW,CAAC,YAAY,IAAI,EAAE;IAC1C,MAAM,MAAM,IAAI,IAAI;IACpB,IAAI,OAAO,CAAC,CAAC;QACX,IAAI,IAAI,GAAG,CAAC,EAAE,EAAE,GAAG,EAAE,QAAQ,GAAG;IAClC;IACA;AACF"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/consume/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { consumeSubmissions } from '../store';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { agencyEmail, ids } = (await req.json()) as { agencyEmail: string; ids: string[] };\n    if (!agencyEmail || !Array.isArray(ids)) {\n      return NextResponse.json({ ok: false, error: 'Missing parameters' }, { status: 400 });\n    }\n    consumeSubmissions(agencyEmail, ids);\n    return NextResponse.json({ ok: true });\n  } catch (e: any) {\n    return NextResponse.json({ ok: false, error: e?.message || 'Consume failed' }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,GAAG,EAAE,GAAI,MAAM,IAAI,IAAI;QAC5C,IAAI,CAAC,eAAe,CAAC,MAAM,OAAO,CAAC,MAAM;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QACrF;QACA,IAAA,oJAAkB,EAAC,aAAa;QAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAiB,GAAG;YAAE,QAAQ;QAAI;IAC/F;AACF"}}]
}