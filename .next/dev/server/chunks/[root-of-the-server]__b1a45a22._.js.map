{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/google/tokenStore.ts"],"sourcesContent":["export type TokenData = {\n  access_token?: string;\n  refresh_token?: string;\n  scope?: string;\n  token_type?: string;\n  expiry_date?: number;\n};\n\n// WARNING: In-memory store is only for local testing. Replace with a secure DB in production.\nconst TOKENS: Record<string, TokenData> = {};\n\nexport function saveTokens(clientId: string, tokens: TokenData) {\n  const key = clientId || 'default';\n  console.info('[gmail-token:save]', {\n    clientId: key,\n    hasAccess: Boolean(tokens?.access_token),\n    hasRefresh: Boolean(tokens?.refresh_token),\n    expiry: tokens?.expiry_date,\n  });\n  TOKENS[key] = { ...(TOKENS[key] || {}), ...tokens };\n}\n\nexport function getTokens(clientId: string): TokenData | undefined {\n  const key = clientId || 'default';\n  const t = TOKENS[key];\n  console.info('[gmail-token:get]', {\n    clientId: key,\n    exists: Boolean(t),\n    hasAccess: Boolean(t?.access_token),\n    hasRefresh: Boolean(t?.refresh_token),\n  });\n  return t;\n}\n\nexport function clearTokens(clientId?: string) {\n  if (clientId) {\n    delete TOKENS[clientId];\n  } else {\n    Object.keys(TOKENS).forEach((k) => delete TOKENS[k]);\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;;;AAQA,8FAA8F;AAC9F,MAAM,SAAoC,CAAC;AAEpC,SAAS,WAAW,QAAgB,EAAE,MAAiB;IAC5D,MAAM,MAAM,YAAY;IACxB,QAAQ,IAAI,CAAC,sBAAsB;QACjC,UAAU;QACV,WAAW,QAAQ,QAAQ;QAC3B,YAAY,QAAQ,QAAQ;QAC5B,QAAQ,QAAQ;IAClB;IACA,MAAM,CAAC,IAAI,GAAG;QAAE,GAAI,MAAM,CAAC,IAAI,IAAI,CAAC,CAAC;QAAG,GAAG,MAAM;IAAC;AACpD;AAEO,SAAS,UAAU,QAAgB;IACxC,MAAM,MAAM,YAAY;IACxB,MAAM,IAAI,MAAM,CAAC,IAAI;IACrB,QAAQ,IAAI,CAAC,qBAAqB;QAChC,UAAU;QACV,QAAQ,QAAQ;QAChB,WAAW,QAAQ,GAAG;QACtB,YAAY,QAAQ,GAAG;IACzB;IACA,OAAO;AACT;AAEO,SAAS,YAAY,QAAiB;IAC3C,IAAI,UAAU;QACZ,OAAO,MAAM,CAAC,SAAS;IACzB,OAAO;QACL,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,CAAC,IAAM,OAAO,MAAM,CAAC,EAAE;IACrD;AACF"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/google/oauth/callback/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { saveTokens } from '../../tokenStore';\n\nexport async function GET(req: NextRequest) {\n  const url = new URL(req.url);\n  const code = url.searchParams.get('code');\n  const state = url.searchParams.get('state') || '';\n  console.info('[gmail-oauth:callback:start]', { state, hasCode: Boolean(code) });\n  if (!code) {\n    return new Response(`<!doctype html>\n<html><body><script>\n  (function() {\n    try {\n      if (window.opener) {\n        window.opener.postMessage({ type: 'google-oauth-error', reason: 'missing_code' }, '${url.origin}');\n      }\n    } catch (e) {}\n  })();\n</script>\n<p>Authentication complete. You can close this window.</p>\n</body></html>`, { headers: { 'Content-Type': 'text/html' }});\n  }\n\n  try {\n    const { google } = await import('googleapis');\n    const oAuth2Client = new google.auth.OAuth2(\n      process.env.GOOGLE_CLIENT_ID,\n      process.env.GOOGLE_CLIENT_SECRET,\n      process.env.GOOGLE_REDIRECT_URI\n    );\n    const { tokens } = await oAuth2Client.getToken(code);\n    console.info('[gmail-oauth:callback:tokens]', {\n      state,\n      hasAccess: Boolean(tokens?.access_token),\n      hasRefresh: Boolean(tokens?.refresh_token),\n      scope: tokens?.scope,\n      expiry: tokens?.expiry_date,\n    });\n    saveTokens(state || 'default', tokens);\n    console.info('[gmail-oauth:callback:save]', { state, saved: true });\n    return new Response(`<!doctype html>\n<html><body><script>\n  (function() {\n    try {\n      if (window.opener) {\n        window.opener.postMessage({ type: 'google-oauth-success', clientId: '${state}' }, '${url.origin}');\n      }\n    } catch (e) {}\n  })();\n</script>\n<p>Authentication complete. You can close this window.</p>\n</body></html>`, { headers: { 'Content-Type': 'text/html' }});\n  } catch (e) {\n    console.error('[gmail-oauth:callback:error]', { state, message: (e as any)?.message });\n    return new Response(`<!doctype html>\n<html><body><script>\n  (function() {\n    try {\n      if (window.opener) {\n        window.opener.postMessage({ type: 'google-oauth-error', reason: 'exchange_failed' }, '${url.origin}');\n      }\n    } catch (e) {}\n  })();\n</script>\n<p>Authentication complete. You can close this window.</p>\n</body></html>`, { headers: { 'Content-Type': 'text/html' }});\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AACA;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;IAC3B,MAAM,OAAO,IAAI,YAAY,CAAC,GAAG,CAAC;IAClC,MAAM,QAAQ,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY;IAC/C,QAAQ,IAAI,CAAC,gCAAgC;QAAE;QAAO,SAAS,QAAQ;IAAM;IAC7E,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,SAAS,CAAC;;;;;2FAKkE,EAAE,IAAI,MAAM,CAAC;;;;;;cAM1F,CAAC,EAAE;YAAE,SAAS;gBAAE,gBAAgB;YAAY;QAAC;IACzD;IAEA,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,GAAG;QACnB,MAAM,eAAe,IAAI,OAAO,IAAI,CAAC,MAAM,CACzC,QAAQ,GAAG,CAAC,gBAAgB,EAC5B,QAAQ,GAAG,CAAC,oBAAoB,EAChC,QAAQ,GAAG,CAAC,mBAAmB;QAEjC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,aAAa,QAAQ,CAAC;QAC/C,QAAQ,IAAI,CAAC,iCAAiC;YAC5C;YACA,WAAW,QAAQ,QAAQ;YAC3B,YAAY,QAAQ,QAAQ;YAC5B,OAAO,QAAQ;YACf,QAAQ,QAAQ;QAClB;QACA,IAAA,kJAAU,EAAC,SAAS,WAAW;QAC/B,QAAQ,IAAI,CAAC,+BAA+B;YAAE;YAAO,OAAO;QAAK;QACjE,OAAO,IAAI,SAAS,CAAC;;;;;6EAKoD,EAAE,MAAM,MAAM,EAAE,IAAI,MAAM,CAAC;;;;;;cAM1F,CAAC,EAAE;YAAE,SAAS;gBAAE,gBAAgB;YAAY;QAAC;IACzD,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,gCAAgC;YAAE;YAAO,SAAU,GAAW;QAAQ;QACpF,OAAO,IAAI,SAAS,CAAC;;;;;8FAKqE,EAAE,IAAI,MAAM,CAAC;;;;;;cAM7F,CAAC,EAAE;YAAE,SAAS;gBAAE,gBAAgB;YAAY;QAAC;IACzD;AACF"}}]
}