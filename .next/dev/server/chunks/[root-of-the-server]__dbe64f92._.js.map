{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/token.ts"],"sourcesContent":["import crypto from 'crypto';\n\nconst ALG = 'sha256';\nconst SECRET = process.env.FORMS_SECRET || 'dev-forms-secret-change-me';\n\nexport function sign(payload: object): string {\n  const header = { alg: 'HS256', typ: 'JWT' };\n  const enc = (o: any) => Buffer.from(JSON.stringify(o)).toString('base64url');\n  const head = enc(header);\n  const body = enc(payload);\n  const hmac = crypto.createHmac(ALG, SECRET).update(`${head}.${body}`).digest('base64url');\n  return `${head}.${body}.${hmac}`;\n}\n\nexport function verify<T = any>(token: string): T | null {\n  const parts = token.split('.');\n  if (parts.length !== 3) return null;\n  const [head, body, sig] = parts;\n  const hmac = crypto.createHmac(ALG, SECRET).update(`${head}.${body}`).digest('base64url');\n  if (hmac !== sig) return null;\n  try {\n    const json = JSON.parse(Buffer.from(body, 'base64url').toString('utf-8'));\n    if (json.exp && Date.now() > Number(json.exp)) return null;\n    return json as T;\n  } catch {\n    return null;\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM;AACZ,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY,IAAI;AAEpC,SAAS,KAAK,OAAe;IAClC,MAAM,SAAS;QAAE,KAAK;QAAS,KAAK;IAAM;IAC1C,MAAM,MAAM,CAAC,IAAW,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC,IAAI,QAAQ,CAAC;IAChE,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,KAAK,QAAQ,MAAM,CAAC,GAAG,KAAK,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7E,OAAO,GAAG,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,MAAM;AAClC;AAEO,SAAS,OAAgB,KAAa;IAC3C,MAAM,QAAQ,MAAM,KAAK,CAAC;IAC1B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAC/B,MAAM,CAAC,MAAM,MAAM,IAAI,GAAG;IAC1B,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,KAAK,QAAQ,MAAM,CAAC,GAAG,KAAK,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7E,IAAI,SAAS,KAAK,OAAO;IACzB,IAAI;QACF,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,MAAM,aAAa,QAAQ,CAAC;QAChE,IAAI,KAAK,GAAG,IAAI,KAAK,GAAG,KAAK,OAAO,KAAK,GAAG,GAAG,OAAO;QACtD,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/store.ts"],"sourcesContent":["type Submission = {\n  id: string;\n  createdAt: number;\n  data: any;\n  consumed?: boolean;\n};\n\nconst SUBMISSIONS: { [agencyEmail: string]: Submission[] } = {};\nconst STORAGE_KEY = 'form_submissions_v1';\n\nfunction readStore(): { [agencyEmail: string]: Submission[] } {\n  if (typeof window === 'undefined') return SUBMISSIONS;\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    return raw ? (JSON.parse(raw) as { [agencyEmail: string]: Submission[] }) : {};\n  } catch {\n    return {};\n  }\n}\n\nfunction writeStore(data: { [agencyEmail: string]: Submission[] }) {\n  if (typeof window === 'undefined') return;\n  try {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(data));\n  } catch {\n    // ignore\n  }\n}\n\n// Initialize from storage\nObject.assign(SUBMISSIONS, readStore());\n\nfunction persist() {\n  writeStore(SUBMISSIONS);\n}\n\nexport function putSubmission(agencyEmail: string, data: any): Submission {\n  const id = `${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n  const rec: Submission = { id, createdAt: Date.now(), data, consumed: false };\n  if (!SUBMISSIONS[agencyEmail]) SUBMISSIONS[agencyEmail] = [];\n  SUBMISSIONS[agencyEmail].unshift(rec);\n  persist();\n  return rec;\n}\n\nexport function listSubmissions(agencyEmail: string, includeConsumed = false): Submission[] {\n  const all = SUBMISSIONS[agencyEmail] || [];\n  return includeConsumed ? all.slice() : all.filter((s) => !s.consumed);\n}\n\nexport function consumeSubmissions(agencyEmail: string, ids: string[]) {\n  const all = SUBMISSIONS[agencyEmail] || [];\n  const set = new Set(ids);\n  all.forEach((s) => {\n    if (set.has(s.id)) s.consumed = true;\n  });\n  persist();\n}\n\n\n"],"names":[],"mappings":";;;;;;;;AAOA,MAAM,cAAuD,CAAC;AAC9D,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO;;;AAO5C;AAEA,SAAS,WAAW,IAA6C;IAC/D,wCAAmC;;;AAMrC;AAEA,0BAA0B;AAC1B,OAAO,MAAM,CAAC,aAAa;AAE3B,SAAS;IACP,WAAW;AACb;AAEO,SAAS,cAAc,WAAmB,EAAE,IAAS;IAC1D,MAAM,KAAK,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;IACpE,MAAM,MAAkB;QAAE;QAAI,WAAW,KAAK,GAAG;QAAI;QAAM,UAAU;IAAM;IAC3E,IAAI,CAAC,WAAW,CAAC,YAAY,EAAE,WAAW,CAAC,YAAY,GAAG,EAAE;IAC5D,WAAW,CAAC,YAAY,CAAC,OAAO,CAAC;IACjC;IACA,OAAO;AACT;AAEO,SAAS,gBAAgB,WAAmB,EAAE,kBAAkB,KAAK;IAC1E,MAAM,MAAM,WAAW,CAAC,YAAY,IAAI,EAAE;IAC1C,OAAO,kBAAkB,IAAI,KAAK,KAAK,IAAI,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,QAAQ;AACtE;AAEO,SAAS,mBAAmB,WAAmB,EAAE,GAAa;IACnE,MAAM,MAAM,WAAW,CAAC,YAAY,IAAI,EAAE;IAC1C,MAAM,MAAM,IAAI,IAAI;IACpB,IAAI,OAAO,CAAC,CAAC;QACX,IAAI,IAAI,GAAG,CAAC,EAAE,EAAE,GAAG,EAAE,QAAQ,GAAG;IAClC;IACA;AACF"}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/submit/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verify } from '../../forms/token';\nimport { putSubmission } from '../store';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url);\n    const body = await req.json().catch(() => ({}));\n    const token = (body.token || searchParams.get('token') || '').trim();\n    const form = body.form || {};\n    const payload = verify<{ agencyEmail: string; exp?: number }>(token);\n    console.info('[intake-api:submit:start]', { hasToken: Boolean(token), agencyEmail: payload?.agencyEmail });\n    if (!payload?.agencyEmail) {\n      return NextResponse.json({ ok: false, error: 'Invalid token' }, { status: 400 });\n    }\n    const safeForm = form || {};\n    const rec = putSubmission(payload.agencyEmail, {\n      email: safeForm.email || '',\n      password: safeForm.password || '',\n      firstName: safeForm.firstName || '',\n      lastName: safeForm.lastName || '',\n      sport: safeForm.sport || '',\n      division: safeForm.division || '',\n      graduationYear: safeForm.graduationYear || '',\n      radar: safeForm.radar || {},\n    });\n    console.info('[intake-api:submit:success]', { id: rec.id, agencyEmail: payload.agencyEmail });\n    return NextResponse.json({ ok: true, id: rec.id });\n  } catch (e: any) {\n    console.error('[intake-api:submit:error]', { error: e?.message });\n    return NextResponse.json({ ok: false, error: e?.message || 'Submit failed' }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,MAAM,QAAQ,CAAC,KAAK,KAAK,IAAI,aAAa,GAAG,CAAC,YAAY,EAAE,EAAE,IAAI;QAClE,MAAM,OAAO,KAAK,IAAI,IAAI,CAAC;QAC3B,MAAM,UAAU,IAAA,wIAAM,EAAwC;QAC9D,QAAQ,IAAI,CAAC,6BAA6B;YAAE,UAAU,QAAQ;YAAQ,aAAa,SAAS;QAAY;QACxG,IAAI,CAAC,SAAS,aAAa;YACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QACA,MAAM,WAAW,QAAQ,CAAC;QAC1B,MAAM,MAAM,IAAA,+IAAa,EAAC,QAAQ,WAAW,EAAE;YAC7C,OAAO,SAAS,KAAK,IAAI;YACzB,UAAU,SAAS,QAAQ,IAAI;YAC/B,WAAW,SAAS,SAAS,IAAI;YACjC,UAAU,SAAS,QAAQ,IAAI;YAC/B,OAAO,SAAS,KAAK,IAAI;YACzB,UAAU,SAAS,QAAQ,IAAI;YAC/B,gBAAgB,SAAS,cAAc,IAAI;YAC3C,OAAO,SAAS,KAAK,IAAI,CAAC;QAC5B;QACA,QAAQ,IAAI,CAAC,+BAA+B;YAAE,IAAI,IAAI,EAAE;YAAE,aAAa,QAAQ,WAAW;QAAC;QAC3F,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,IAAI,IAAI,EAAE;QAAC;IAClD,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,6BAA6B;YAAE,OAAO,GAAG;QAAQ;QAC/D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAgB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF"}}]
}