{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/notes.ts"],"sourcesContent":["type Note = {\n  id: string;\n  athleteId: string;\n  agencyEmail: string;\n  author?: string;\n  title?: string;\n  body: string;\n  type?: 'call' | 'coach' | 'dm' | 'event' | 'other';\n  createdAt: number;\n  updatedAt: number;\n};\n\nconst STORAGE_KEY = 'notes_data';\n\nfunction readStore(): Note[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    return JSON.parse(raw) as Note[];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeStore(items: Note[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nlet NOTES: Note[] = readStore();\n\nexport function listNotes(athleteId: string, agencyEmail: string) {\n  if (typeof window !== 'undefined') NOTES = readStore();\n  return NOTES.filter((n) => n.athleteId === athleteId && n.agencyEmail === agencyEmail);\n}\n\nexport function createNote(input: Partial<Note> & { athleteId: string; agencyEmail: string; body: string }) {\n  const now = Date.now();\n  const note: Note = {\n    id: input.id ?? `n-${now}-${Math.random().toString(36).slice(2, 8)}`,\n    athleteId: input.athleteId,\n    agencyEmail: input.agencyEmail,\n    author: input.author,\n    title: input.title,\n    body: input.body,\n    type: (input.type as Note['type']) ?? 'other',\n    createdAt: now,\n    updatedAt: now,\n  };\n  NOTES.unshift(note);\n  writeStore(NOTES);\n  return note;\n}\n\nexport function updateNote(id: string, patch: Partial<Note>, agencyEmail: string) {\n  if (typeof window !== 'undefined') NOTES = readStore();\n  const idx = NOTES.findIndex((n) => n.id === id && n.agencyEmail === agencyEmail);\n  if (idx === -1) return null;\n  const merged = { ...NOTES[idx], ...patch, updatedAt: Date.now() };\n  NOTES[idx] = merged;\n  writeStore(NOTES);\n  return merged;\n}\n\nexport function deleteNote(id: string, agencyEmail: string) {\n  if (typeof window !== 'undefined') NOTES = readStore();\n  const before = NOTES.length;\n  NOTES = NOTES.filter((n) => !(n.id === id && n.agencyEmail === agencyEmail));\n  if (NOTES.length !== before) writeStore(NOTES);\n  return { ok: true };\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;AAYA,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;IAC5C,MAAM;AAOR;AAEA,SAAS,WAAW,KAAa;IAC/B,wCAAmC;;;AAErC;AAEA,IAAI,QAAgB;AAEb,SAAS,UAAU,SAAiB,EAAE,WAAmB;IAC9D;;IACA,OAAO,MAAM,MAAM,CAAC,CAAC,IAAM,EAAE,SAAS,KAAK,aAAa,EAAE,WAAW,KAAK;AAC5E;AAEO,SAAS,WAAW,KAA+E;IACxG,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,OAAa;QACjB,IAAI,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;QACpE,WAAW,MAAM,SAAS;QAC1B,aAAa,MAAM,WAAW;QAC9B,QAAQ,MAAM,MAAM;QACpB,OAAO,MAAM,KAAK;QAClB,MAAM,MAAM,IAAI;QAChB,MAAM,AAAC,MAAM,IAAI,IAAqB;QACtC,WAAW;QACX,WAAW;IACb;IACA,MAAM,OAAO,CAAC;IACd,WAAW;IACX,OAAO;AACT;AAEO,SAAS,WAAW,EAAU,EAAE,KAAoB,EAAE,WAAmB;IAC9E;;IACA,MAAM,MAAM,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,EAAE,WAAW,KAAK;IACpE,IAAI,QAAQ,CAAC,GAAG,OAAO;IACvB,MAAM,SAAS;QAAE,GAAG,KAAK,CAAC,IAAI;QAAE,GAAG,KAAK;QAAE,WAAW,KAAK,GAAG;IAAG;IAChE,KAAK,CAAC,IAAI,GAAG;IACb,WAAW;IACX,OAAO;AACT;AAEO,SAAS,WAAW,EAAU,EAAE,WAAmB;IACxD;;IACA,MAAM,SAAS,MAAM,MAAM;IAC3B,QAAQ,MAAM,MAAM,CAAC,CAAC,IAAM,CAAC,CAAC,EAAE,EAAE,KAAK,MAAM,EAAE,WAAW,KAAK,WAAW;IAC1E,IAAI,MAAM,MAAM,KAAK,QAAQ,WAAW;IACxC,OAAO;QAAE,IAAI;IAAK;AACpB"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/notes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createNote, deleteNote, listNotes, updateNote } from '@/services/notes';\n\nfunction getAgencyEmail(req: NextRequest, bodyAgency?: string) {\n  return req.headers.get('x-agency-email') || bodyAgency || '';\n}\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const athleteId = searchParams.get('athleteId') || '';\n  const agencyEmail = getAgencyEmail(req, searchParams.get('agencyEmail') || undefined);\n  if (!athleteId || !agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'athleteId and agencyEmail are required' }, { status: 400 });\n  }\n  const data = listNotes(athleteId, agencyEmail).sort((a, b) => b.createdAt - a.createdAt);\n  return NextResponse.json({ ok: true, data });\n}\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json();\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  const { athleteId, body: noteBody, title, type, author } = body || {};\n  if (!agencyEmail || !athleteId || !noteBody?.trim()) {\n    return NextResponse.json({ ok: false, error: 'athleteId, agencyEmail, and body are required' }, { status: 400 });\n  }\n  const created = createNote({ athleteId, agencyEmail, body: noteBody.trim(), title, type, author });\n  return NextResponse.json({ ok: true, data: created });\n}\n\nexport async function PATCH(req: NextRequest) {\n  const body = await req.json();\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  const { id, ...patch } = body || {};\n  if (!id || !agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'id and agencyEmail are required' }, { status: 400 });\n  }\n  const updated = updateNote(id, patch, agencyEmail);\n  if (!updated) return NextResponse.json({ ok: false, error: 'Note not found' }, { status: 404 });\n  return NextResponse.json({ ok: true, data: updated });\n}\n\nexport async function DELETE(req: NextRequest) {\n  const body = await req.json().catch(() => ({}));\n  const id = body?.id;\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  if (!id || !agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'id and agencyEmail are required' }, { status: 400 });\n  }\n  deleteNote(id, agencyEmail);\n  return NextResponse.json({ ok: true });\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,SAAS,eAAe,GAAgB,EAAE,UAAmB;IAC3D,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,qBAAqB,cAAc;AAC5D;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;IACnD,MAAM,cAAc,eAAe,KAAK,aAAa,GAAG,CAAC,kBAAkB;IAC3E,IAAI,CAAC,aAAa,CAAC,aAAa;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAyC,GAAG;YAAE,QAAQ;QAAI;IACzG;IACA,MAAM,OAAO,IAAA,gIAAS,EAAC,WAAW,aAAa,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;IACvF,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM;IAAK;AAC5C;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,MAAM,EAAE,SAAS,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC;IACpE,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,UAAU,QAAQ;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAgD,GAAG;YAAE,QAAQ;QAAI;IAChH;IACA,MAAM,UAAU,IAAA,iIAAU,EAAC;QAAE;QAAW;QAAa,MAAM,SAAS,IAAI;QAAI;QAAO;QAAM;IAAO;IAChG,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,MAAM;IAAQ;AACrD;AAEO,eAAe,MAAM,GAAgB;IAC1C,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,MAAM,EAAE,EAAE,EAAE,GAAG,OAAO,GAAG,QAAQ,CAAC;IAClC,IAAI,CAAC,MAAM,CAAC,aAAa;QACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IAClG;IACA,MAAM,UAAU,IAAA,iIAAU,EAAC,IAAI,OAAO;IACtC,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAO,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;IAC7F,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,MAAM;IAAQ;AACrD;AAEO,eAAe,OAAO,GAAgB;IAC3C,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,MAAM,KAAK,MAAM;IACjB,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,IAAI,CAAC,MAAM,CAAC,aAAa;QACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IAClG;IACA,IAAA,iIAAU,EAAC,IAAI;IACf,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC"}}]
}