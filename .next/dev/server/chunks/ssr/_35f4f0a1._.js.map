{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/clients.ts"],"sourcesContent":["import { getAgencyById } from '@/services/agencies';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || process.env.API_BASE_URL;\n\nfunction requireApiBase() {\n  if (!API_BASE_URL) throw new Error('API_BASE_URL is not configured');\n  return API_BASE_URL;\n}\n\nasync function apiFetch(path: string, init?: RequestInit) {\n  const base = requireApiBase();\n  if (typeof fetch === 'undefined') {\n    throw new Error('fetch is not available');\n  }\n  const headers: Record<string, string> = { 'Content-Type': 'application/json', ...(init?.headers as any) };\n  const res = await fetch(`${base}${path}`, { ...init, headers });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`API ${path} failed: ${res.status} ${text}`);\n  }\n  return res.json();\n}\n\ntype Client = {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n  agencyEmail: string;\n  agencyId?: string;\n  password?: string;\n  radar?: any;\n  gmailTokens?: any;\n  gmailConnected?: boolean;\n  createdAt?: string;\n};\n\nexport async function listClientsByAgencyEmail(agencyEmail: string) {\n  const data = await apiFetch('/clients');\n  return data?.clients ?? [];\n}\n\nexport async function listClientsByAgency(agencyId: string) {\n  const agency = await getAgencyById(agencyId);\n  if (!agency) return [];\n  return listClientsByAgencyEmail(agency.email);\n}\nexport async function upsertClient(input: any) {\n  const data = await apiFetch('/clients', { method: 'POST', body: JSON.stringify(input) });\n  return data?.client;\n}\nexport async function getClient(id: string) {\n  const data = await apiFetch(`/clients/${id}`);\n  return data?.client ?? null;\n}\nexport async function deleteClient(id: string) {\n  await apiFetch(`/clients/${id}`, { method: 'DELETE' });\n  return { ok: true };\n}\nexport async function getClients() {\n  const data = await apiFetch('/clients');\n  return data?.clients ?? [];\n}\n\nexport function setClientGmailTokens(clientId: string, tokens: any) {\n  // No-op; tokens are stored server-side via API.\n}\n\nexport function getClientGmailTokens(clientId: string): any | null {\n  // No-op on client; tokens handled server-side.\n  return null;\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,eAAe,8FAAwC,QAAQ,GAAG,CAAC,YAAY;AAErF,SAAS;IACP;;IACA,OAAO;AACT;AAEA,eAAe,SAAS,IAAY,EAAE,IAAkB;IACtD,MAAM,OAAO;IACb,IAAI,OAAO,UAAU,aAAa;QAChC,MAAM,IAAI,MAAM;IAClB;IACA,MAAM,UAAkC;QAAE,gBAAgB;QAAoB,GAAI,MAAM,OAAO;IAAS;IACxG,MAAM,MAAM,MAAM,MAAM,GAAG,OAAO,MAAM,EAAE;QAAE,GAAG,IAAI;QAAE;IAAQ;IAC7D,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,KAAK,SAAS,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,MAAM;IAC7D;IACA,OAAO,IAAI,IAAI;AACjB;AAiBO,eAAe,yBAAyB,WAAmB;IAChE,MAAM,OAAO,MAAM,SAAS;IAC5B,OAAO,MAAM,WAAW,EAAE;AAC5B;AAEO,eAAe,oBAAoB,QAAgB;IACxD,MAAM,SAAS,MAAM,IAAA,qIAAa,EAAC;IACnC,IAAI,CAAC,QAAQ,OAAO,EAAE;IACtB,OAAO,yBAAyB,OAAO,KAAK;AAC9C;AACO,eAAe,aAAa,KAAU;IAC3C,MAAM,OAAO,MAAM,SAAS,YAAY;QAAE,QAAQ;QAAQ,MAAM,KAAK,SAAS,CAAC;IAAO;IACtF,OAAO,MAAM;AACf;AACO,eAAe,UAAU,EAAU;IACxC,MAAM,OAAO,MAAM,SAAS,CAAC,SAAS,EAAE,IAAI;IAC5C,OAAO,MAAM,UAAU;AACzB;AACO,eAAe,aAAa,EAAU;IAC3C,MAAM,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE;QAAE,QAAQ;IAAS;IACpD,OAAO;QAAE,IAAI;IAAK;AACpB;AACO,eAAe;IACpB,MAAM,OAAO,MAAM,SAAS;IAC5B,OAAO,MAAM,WAAW,EAAE;AAC5B;AAEO,SAAS,qBAAqB,QAAgB,EAAE,MAAW;AAChE,gDAAgD;AAClD;AAEO,SAAS,qBAAqB,QAAgB;IACnD,+CAA+C;IAC/C,OAAO;AACT"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/features/clients/ClientsList.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { listClientsByAgencyEmail, deleteClient } from '@/services/clients';\nimport { DataGrid, GridColDef } from '@mui/x-data-grid';\nimport { Button, Stack, Box, Typography, Avatar, Paper } from '@mui/material';\nimport { useSession } from '@/features/auth/session';\n\nexport function ClientsList() {\n  const { session } = useSession();\n  const agencyEmail = session?.email || '';\n  const { data = [], refetch } = useQuery({\n    queryKey: ['clients', agencyEmail],\n    queryFn: () => agencyEmail ? listClientsByAgencyEmail(agencyEmail) : [],\n    enabled: Boolean(agencyEmail),\n  });\n  const cols: GridColDef[] = [\n    {\n      field: 'athlete',\n      headerName: 'Athlete',\n      flex: 1.0,\n      sortable: false,\n      renderCell: (params) => {\n        const row = params.row as any;\n        const name = `${row.firstName ?? ''} ${row.lastName ?? ''}`.trim() || 'Unknown';\n        const description = row?.description || row?.radar?.description || 'No description provided';\n        const photo = row?.photoUrl || row?.profileImageUrl || '/marketing/an-logo.png';\n        return (\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, minWidth: 0, height: '100%' }}>\n            <Avatar\n              src={photo}\n              alt={name}\n              sx={{ width: 40, height: 40, borderRadius: '50%' }}\n            />\n            <Box sx={{ minWidth: 0, display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\n              <Typography variant=\"subtitle2\" sx={{ fontWeight: 700, lineHeight: 1.1 }} noWrap>\n                {name}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\" noWrap>\n                {description}\n              </Typography>\n            </Box>\n          </Box>\n        );\n      },\n    },\n    { field: 'email', headerName: 'Email', flex: 0.5 },\n    { field: 'sport', headerName: 'Sport', width: 120 },\n    {\n      field: 'actions',\n      headerName: 'Actions',\n      width: 200,\n      sortable: false,\n      renderCell: (p) => (\n        <Stack direction=\"row\" spacing={1}>\n          <Button size=\"small\" href={`/clients/${p.row.id}`}>View</Button>\n          <Button size=\"small\" href={`/clients/${p.row.id}/edit`}>Edit</Button>\n          <Button size=\"small\" color=\"error\" onClick={async ()=>{ await deleteClient(p.row.id); refetch(); }}>Delete</Button>\n        </Stack>\n      )\n    }\n  ];\n  return (\n    <Paper sx={{ height: 520, width: '100%', borderRadius: 2.5, overflow: 'auto' }}>\n      <DataGrid\n        rows={data as any[]}\n        columns={cols}\n        getRowId={(r)=>r.id}\n        disableRowSelectionOnClick\n        sx={{\n          minWidth: 900,\n          '& .MuiDataGrid-columnHeaders': {\n            backgroundColor: '#f9fafb',\n            borderBottom: 'none',\n          },\n          '& .MuiDataGrid-columnHeader': {\n            borderRight: 'none',\n          },\n        }}\n      />\n    </Paper>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AANA;;;;;;;AAQO,SAAS;IACd,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAU;IAC9B,MAAM,cAAc,SAAS,SAAS;IACtC,MAAM,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,GAAG,IAAA,uLAAQ,EAAC;QACtC,UAAU;YAAC;YAAW;SAAY;QAClC,SAAS,IAAM,cAAc,IAAA,+IAAwB,EAAC,eAAe,EAAE;QACvE,SAAS,QAAQ;IACnB;IACA,MAAM,OAAqB;QACzB;YACE,OAAO;YACP,YAAY;YACZ,MAAM;YACN,UAAU;YACV,YAAY,CAAC;gBACX,MAAM,MAAM,OAAO,GAAG;gBACtB,MAAM,OAAO,GAAG,IAAI,SAAS,IAAI,GAAG,CAAC,EAAE,IAAI,QAAQ,IAAI,IAAI,CAAC,IAAI,MAAM;gBACtE,MAAM,cAAc,KAAK,eAAe,KAAK,OAAO,eAAe;gBACnE,MAAM,QAAQ,KAAK,YAAY,KAAK,mBAAmB;gBACvD,qBACE,8OAAC,+LAAG;oBAAC,IAAI;wBAAE,SAAS;wBAAQ,YAAY;wBAAU,KAAK;wBAAK,UAAU;wBAAG,QAAQ;oBAAO;;sCACtF,8OAAC,2MAAM;4BACL,KAAK;4BACL,KAAK;4BACL,IAAI;gCAAE,OAAO;gCAAI,QAAQ;gCAAI,cAAc;4BAAM;;;;;;sCAEnD,8OAAC,+LAAG;4BAAC,IAAI;gCAAE,UAAU;gCAAG,SAAS;gCAAQ,eAAe;gCAAU,gBAAgB;4BAAS;;8CACzF,8OAAC,2NAAU;oCAAC,SAAQ;oCAAY,IAAI;wCAAE,YAAY;wCAAK,YAAY;oCAAI;oCAAG,MAAM;8CAC7E;;;;;;8CAEH,8OAAC,2NAAU;oCAAC,SAAQ;oCAAQ,OAAM;oCAAiB,MAAM;8CACtD;;;;;;;;;;;;;;;;;;YAKX;QACF;QACA;YAAE,OAAO;YAAS,YAAY;YAAS,MAAM;QAAI;QACjD;YAAE,OAAO;YAAS,YAAY;YAAS,OAAO;QAAI;QAClD;YACE,OAAO;YACP,YAAY;YACZ,OAAO;YACP,UAAU;YACV,YAAY,CAAC,kBACX,8OAAC,uMAAK;oBAAC,WAAU;oBAAM,SAAS;;sCAC9B,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,MAAM,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE;sCAAE;;;;;;sCACnD,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,MAAM,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC;sCAAE;;;;;;sCACxD,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,OAAM;4BAAQ,SAAS;gCAAY,MAAM,IAAA,mIAAY,EAAC,EAAE,GAAG,CAAC,EAAE;gCAAG;4BAAW;sCAAG;;;;;;;;;;;;QAG1G;KACD;IACD,qBACE,8OAAC,uMAAK;QAAC,IAAI;YAAE,QAAQ;YAAK,OAAO;YAAQ,cAAc;YAAK,UAAU;QAAO;kBAC3E,cAAA,8OAAC,qLAAQ;YACP,MAAM;YACN,SAAS;YACT,UAAU,CAAC,IAAI,EAAE,EAAE;YACnB,0BAA0B;YAC1B,IAAI;gBACF,UAAU;gBACV,gCAAgC;oBAC9B,iBAAiB;oBACjB,cAAc;gBAChB;gBACA,+BAA+B;oBAC7B,aAAa;gBACf;YACF;;;;;;;;;;;AAIR"}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/clients/page.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { ClientsList } from '@/features/clients/ClientsList';\nimport { Typography, Button, Stack, TextField } from '@mui/material';\nimport Link from 'next/link';\nimport { useSession } from '@/features/auth/session';\nimport { upsertClient } from '@/services/clients';\nimport { useQueryClient } from '@tanstack/react-query';\n\nconst API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || process.env.API_BASE_URL || '';\nconst resolvedApiBase = API_BASE_URL || (typeof window !== 'undefined' ? `${window.location.origin}/api` : '');\n\nexport default function ClientsPage() {\n  const { session } = useSession();\n  const queryClient = useQueryClient();\n  const [inviteUrl, setInviteUrl] = React.useState<string>('');\n  const [issuing, setIssuing] = React.useState<boolean>(false);\n  const [copied, setCopied] = React.useState<boolean>(false);\n  React.useEffect(() => {\n    (async () => {\n      if (!session?.email) return;\n      if (!resolvedApiBase) {\n        console.error('[clients:forms:error]', { error: 'API_BASE_URL missing' });\n        return;\n      }\n      try {\n        const res = await fetch(`${resolvedApiBase}/forms/submissions?agencyEmail=${encodeURIComponent(session.email)}`, {\n          credentials: 'include',\n        });\n        const data = await res.json();\n        if (!data?.ok) return;\n        const items = Array.isArray(data.items) ? data.items : [];\n        const idsToConsume: string[] = [];\n        for (const s of items) {\n          const v = s?.data || {};\n          const client = {\n            id: s.id,\n            email: v.email || '',\n            phone: v.phone || '',\n            password: v.password || '',\n            firstName: v.firstName || '',\n            lastName: v.lastName || '',\n            sport: v.sport || '',\n            division: v.division || '',\n            agencyEmail: session.email,\n            photoUrl: v.profileImageUrl || '',\n            radar: v.radar || {},\n          };\n          await upsertClient(client as any);\n          idsToConsume.push(s.id);\n        }\n        if (idsToConsume.length) {\n          await fetch(`${resolvedApiBase}/forms/consume`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            credentials: 'include',\n            body: JSON.stringify({ agencyEmail: session.email, ids: idsToConsume }),\n          });\n          queryClient.invalidateQueries({ queryKey: ['clients', session.email] });\n        }\n      } catch {}\n    })();\n  }, [session?.email]);\n  async function handleGenerateLink() {\n    try {\n      if (!session?.email) return;\n      if (!resolvedApiBase) throw new Error('API_BASE_URL is not configured');\n      setIssuing(true);\n      const res = await fetch(`${resolvedApiBase}/forms/issue`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ agencyEmail: session.email }),\n      });\n      const data = await res.json();\n      if (!res.ok || !data?.ok) throw new Error(data?.error || 'Failed to create link');\n      setInviteUrl(data.url);\n    } catch {\n      setInviteUrl('');\n    } finally {\n      setIssuing(false);\n    }\n  }\n  async function handleCopy() {\n    if (!inviteUrl) return;\n    try {\n      await navigator.clipboard.writeText(inviteUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 1500);\n    } catch {}\n  }\n  return (\n    <Stack spacing={2}>\n      <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n        <Typography variant=\"h4\">Athletes</Typography>\n        <Stack direction=\"row\" spacing={1}>\n          <Button LinkComponent={Link} href=\"/clients/new\" variant=\"contained\">New</Button>\n          <Button variant=\"outlined\" onClick={handleGenerateLink} disabled={issuing}>\n            {issuing ? 'Generatingâ€¦' : 'Generate Form Link'}\n          </Button>\n        </Stack>\n      </Stack>\n      {inviteUrl ? (\n        <Stack direction={{ xs: 'column', md: 'row' }} spacing={1} alignItems=\"center\">\n          <TextField label=\"Intake Link\" value={inviteUrl} fullWidth InputProps={{ readOnly: true }} />\n          <Button variant=\"outlined\" onClick={handleCopy}>{copied ? 'Copied' : 'Copy'}</Button>\n          <Button variant=\"text\" LinkComponent={Link} href={inviteUrl} target=\"_blank\">Open</Button>\n        </Stack>\n      ) : null}\n      <ClientsList />\n    </Stack>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}