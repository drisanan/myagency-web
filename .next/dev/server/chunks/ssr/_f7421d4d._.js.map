{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/agencies.ts"],"sourcesContent":["const STORAGE_KEY = 'agencies_data';\n\nfunction readStore(): Agency[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    return JSON.parse(raw) as Agency[];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeStore(items: Agency[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nexport type AgencySettings = {\n  primaryColor?: string;\n  secondaryColor?: string;\n  logoDataUrl?: string;\n};\nexport type Agency = {\n  id: string;\n  name: string;\n  email: string;\n  password?: string;\n  ownerFirstName?: string;\n  ownerLastName?: string;\n  ownerEmail?: string;\n  ownerPhone?: string;\n  active?: boolean;\n  settings?: AgencySettings;\n};\n\nconst SEED_AGENCIES: Agency[] = [\n  { id: 'agency-001', name: 'Prime Sports', email: 'agency1@an.test', settings: { primaryColor: '#1976d2' } },\n  { id: 'agency-002', name: 'NextGen', email: 'agency2@an.test', settings: { primaryColor: '#9c27b0' } },\n  { id: 'agency-003', name: 'Elite Edge', email: 'agency3@an.test', settings: { primaryColor: '#2e7d32' } },\n];\n\nlet AGENCIES: Agency[] = (() => {\n  const fromStore = readStore();\n  if (fromStore.length > 0) return fromStore;\n  writeStore(SEED_AGENCIES);\n  return [...SEED_AGENCIES];\n})();\n\nexport { AGENCIES };\n\nexport async function listAgencies() {\n  return AGENCIES.map(a => ({ id: a.id, name: a.name }));\n}\n\nexport async function getAgencies() {\n  return [...AGENCIES];\n}\n\nexport async function getAgencyByEmail(email: string) {\n  return AGENCIES.find(a => a.email === email) ?? null;\n}\n\nexport async function getAgencyById(id: string) {\n  return AGENCIES.find(a => a.id === id) ?? null;\n}\n\nexport async function getAgencySettings(email: string) {\n  const a = AGENCIES.find(x => x.email === email);\n  return a?.settings ?? {};\n}\n\nexport async function updateAgencySettings(email: string, settings: AgencySettings) {\n  const a = AGENCIES.find(x => x.email === email);\n  if (!a) return { ok: false };\n  a.settings = { ...(a.settings ?? {}), ...settings };\n  writeStore(AGENCIES);\n  return { ok: true, settings: a.settings };\n}\n\ntype UpsertInput = Omit<Agency, 'id'> & { id?: string };\nexport async function upsertAgency(input: UpsertInput) {\n  if (input.id) {\n    const idx = AGENCIES.findIndex(a => a.id === input.id);\n    if (idx >= 0) {\n      AGENCIES[idx] = { ...AGENCIES[idx], ...input, id: input.id };\n      writeStore(AGENCIES);\n      return { id: input.id };\n    }\n  }\n  const id = `agency-${(Math.random() * 1e6).toFixed(0)}`;\n  AGENCIES.push({\n    id,\n    name: input.name,\n    email: input.email,\n    password: input.password,\n    ownerFirstName: input.ownerFirstName,\n    ownerLastName: input.ownerLastName,\n    ownerEmail: input.ownerEmail,\n    ownerPhone: input.ownerPhone,\n    active: input.active ?? true,\n    settings: input.settings ?? {},\n  });\n  writeStore(AGENCIES);\n  return { id };\n}\n\nexport async function deleteAgency(id: string) {\n  const idx = AGENCIES.findIndex(a => a.id === id);\n  if (idx >= 0) {\n    AGENCIES.splice(idx, 1);\n    writeStore(AGENCIES);\n    return { ok: true };\n  }\n  return { ok: false };\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;IAC5C,MAAM;AAOR;AAEA,SAAS,WAAW,KAAe;IACjC,wCAAmC;;;AAErC;AAoBA,MAAM,gBAA0B;IAC9B;QAAE,IAAI;QAAc,MAAM;QAAgB,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;IAC1G;QAAE,IAAI;QAAc,MAAM;QAAW,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;IACrG;QAAE,IAAI;QAAc,MAAM;QAAc,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;CACzG;AAED,IAAI,WAAqB,CAAC;IACxB,MAAM,YAAY;IAClB,IAAI,UAAU,MAAM,GAAG,GAAG,OAAO;IACjC,WAAW;IACX,OAAO;WAAI;KAAc;AAC3B,CAAC;;AAIM,eAAe;IACpB,OAAO,SAAS,GAAG,CAAC,CAAA,IAAK,CAAC;YAAE,IAAI,EAAE,EAAE;YAAE,MAAM,EAAE,IAAI;QAAC,CAAC;AACtD;AAEO,eAAe;IACpB,OAAO;WAAI;KAAS;AACtB;AAEO,eAAe,iBAAiB,KAAa;IAClD,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK,UAAU;AAClD;AAEO,eAAe,cAAc,EAAU;IAC5C,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO;AAC5C;AAEO,eAAe,kBAAkB,KAAa;IACnD,MAAM,IAAI,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;IACzC,OAAO,GAAG,YAAY,CAAC;AACzB;AAEO,eAAe,qBAAqB,KAAa,EAAE,QAAwB;IAChF,MAAM,IAAI,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;IACzC,IAAI,CAAC,GAAG,OAAO;QAAE,IAAI;IAAM;IAC3B,EAAE,QAAQ,GAAG;QAAE,GAAI,EAAE,QAAQ,IAAI,CAAC,CAAC;QAAG,GAAG,QAAQ;IAAC;IAClD,WAAW;IACX,OAAO;QAAE,IAAI;QAAM,UAAU,EAAE,QAAQ;IAAC;AAC1C;AAGO,eAAe,aAAa,KAAkB;IACnD,IAAI,MAAM,EAAE,EAAE;QACZ,MAAM,MAAM,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,MAAM,EAAE;QACrD,IAAI,OAAO,GAAG;YACZ,QAAQ,CAAC,IAAI,GAAG;gBAAE,GAAG,QAAQ,CAAC,IAAI;gBAAE,GAAG,KAAK;gBAAE,IAAI,MAAM,EAAE;YAAC;YAC3D,WAAW;YACX,OAAO;gBAAE,IAAI,MAAM,EAAE;YAAC;QACxB;IACF;IACA,MAAM,KAAK,CAAC,OAAO,EAAE,CAAC,KAAK,MAAM,KAAK,GAAG,EAAE,OAAO,CAAC,IAAI;IACvD,SAAS,IAAI,CAAC;QACZ;QACA,MAAM,MAAM,IAAI;QAChB,OAAO,MAAM,KAAK;QAClB,UAAU,MAAM,QAAQ;QACxB,gBAAgB,MAAM,cAAc;QACpC,eAAe,MAAM,aAAa;QAClC,YAAY,MAAM,UAAU;QAC5B,YAAY,MAAM,UAAU;QAC5B,QAAQ,MAAM,MAAM,IAAI;QACxB,UAAU,MAAM,QAAQ,IAAI,CAAC;IAC/B;IACA,WAAW;IACX,OAAO;QAAE;IAAG;AACd;AAEO,eAAe,aAAa,EAAU;IAC3C,MAAM,MAAM,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC7C,IAAI,OAAO,GAAG;QACZ,SAAS,MAAM,CAAC,KAAK;QACrB,WAAW;QACX,OAAO;YAAE,IAAI;QAAK;IACpB;IACA,OAAO;QAAE,IAAI;IAAM;AACrB"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/clients.ts"],"sourcesContent":["import { getAgencyById } from '@/services/agencies';\n\ntype Client = {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n  agencyEmail: string;\n  agencyId?: string;\n  password?: string;\n  radar?: any;\n  gmailTokens?: any;\n  gmailConnected?: boolean;\n};\n\nconst STORAGE_KEY = 'clients_data';\n\nconst SEED_CLIENTS: Client[] = [\n  { id: 'ag1-c1', email: 'a1@athletes.test', firstName: 'Ava', lastName: 'Smith', sport: 'Football', agencyEmail: 'agency1@an.test' },\n  { id: 'ag1-c2', email: 'a2@athletes.test', firstName: 'Ben', lastName: 'Jones', sport: 'Basketball', agencyEmail: 'agency1@an.test' },\n  { id: 'ag2-c1', email: 'b1@athletes.test', firstName: 'Cara', lastName: 'Lee', sport: 'Baseball', agencyEmail: 'agency2@an.test' },\n  { id: 'ag3-c1', email: 'c1@athletes.test', firstName: 'Dan', lastName: 'Kim', sport: 'Soccer', agencyEmail: 'agency3@an.test' },\n];\n\nfunction readStore(): Client[] {\n  if (typeof window === 'undefined') return [...SEED_CLIENTS];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [...SEED_CLIENTS];\n  try {\n    const parsed = JSON.parse(raw) as Client[];\n    return parsed.length ? parsed : [...SEED_CLIENTS];\n  } catch {\n    return [...SEED_CLIENTS];\n  }\n}\n\nfunction writeStore(items: Client[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nlet CLIENTS: Client[] = readStore();\n\nexport async function listClientsByAgencyEmail(agencyEmail: string) {\n  return CLIENTS.filter(c => c.agencyEmail === agencyEmail);\n}\n\nexport async function listClientsByAgency(agencyId: string) {\n  const agency = await getAgencyById(agencyId);\n  if (!agency) return [];\n  return listClientsByAgencyEmail(agency.email);\n}\nexport async function upsertClient(input: any) {\n  const id = input.id ?? `c-${(Math.random() * 1e6).toFixed(0)}`;\n  const idx = CLIENTS.findIndex(c => c.id === id);\n  const next: Client = { ...CLIENTS[idx] , ...input, id };\n  if (idx >= 0) {\n    CLIENTS[idx] = next;\n  } else {\n    CLIENTS.push(next);\n  }\n  writeStore(CLIENTS);\n  return next;\n}\nexport async function getClient(id: string) {\n  const found = CLIENTS.find(c => c.id === id);\n  return found ?? { id, email: 'athlete1@example.com', firstName: 'A1', lastName: 'L1', sport: 'Football', agencyEmail: '' };\n}\nexport async function deleteClient(id: string) {\n  const idx = CLIENTS.findIndex(c => c.id === id);\n  if (idx >= 0) {\n    CLIENTS.splice(idx, 1);\n    writeStore(CLIENTS);\n  }\n  return { ok: true };\n}\nexport async function getClients() {\n  // Determine current session from localStorage to enforce tenancy\n  const raw = typeof window !== 'undefined' ? window.localStorage.getItem('session') : null;\n  if (raw) {\n    try {\n      const s = JSON.parse(raw) as { role: 'parent' | 'agency'; email: string };\n      if (s.role === 'agency') {\n        return listClientsByAgencyEmail(s.email);\n      }\n    } catch {\n      // fall through\n    }\n  }\n  return [];\n}\n\nexport function setClientGmailTokens(clientId: string, tokens: any) {\n  const idx = CLIENTS.findIndex(c => c.id === clientId);\n  if (idx >= 0) {\n    CLIENTS[idx] = { ...CLIENTS[idx], gmailTokens: tokens, gmailConnected: true };\n    writeStore(CLIENTS);\n  }\n}\n\nexport function getClientGmailTokens(clientId: string): any | null {\n  const found = CLIENTS.find(c => c.id === clientId);\n  return found?.gmailTokens ?? null;\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAgBA,MAAM,cAAc;AAEpB,MAAM,eAAyB;IAC7B;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAS,OAAO;QAAY,aAAa;IAAkB;IAClI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAS,OAAO;QAAc,aAAa;IAAkB;IACpI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAQ,UAAU;QAAO,OAAO;QAAY,aAAa;IAAkB;IACjI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAO,OAAO;QAAU,aAAa;IAAkB;CAC/H;AAED,SAAS;IACP,wCAAmC,OAAO;WAAI;KAAa;;;IAC3D,MAAM;AAQR;AAEA,SAAS,WAAW,KAAe;IACjC,wCAAmC;;;AAErC;AAEA,IAAI,UAAoB;AAEjB,eAAe,yBAAyB,WAAmB;IAChE,OAAO,QAAQ,MAAM,CAAC,CAAA,IAAK,EAAE,WAAW,KAAK;AAC/C;AAEO,eAAe,oBAAoB,QAAgB;IACxD,MAAM,SAAS,MAAM,IAAA,qIAAa,EAAC;IACnC,IAAI,CAAC,QAAQ,OAAO,EAAE;IACtB,OAAO,yBAAyB,OAAO,KAAK;AAC9C;AACO,eAAe,aAAa,KAAU;IAC3C,MAAM,KAAK,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,KAAK,MAAM,KAAK,GAAG,EAAE,OAAO,CAAC,IAAI;IAC9D,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,MAAM,OAAe;QAAE,GAAG,OAAO,CAAC,IAAI;QAAG,GAAG,KAAK;QAAE;IAAG;IACtD,IAAI,OAAO,GAAG;QACZ,OAAO,CAAC,IAAI,GAAG;IACjB,OAAO;QACL,QAAQ,IAAI,CAAC;IACf;IACA,WAAW;IACX,OAAO;AACT;AACO,eAAe,UAAU,EAAU;IACxC,MAAM,QAAQ,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACzC,OAAO,SAAS;QAAE;QAAI,OAAO;QAAwB,WAAW;QAAM,UAAU;QAAM,OAAO;QAAY,aAAa;IAAG;AAC3H;AACO,eAAe,aAAa,EAAU;IAC3C,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,IAAI,OAAO,GAAG;QACZ,QAAQ,MAAM,CAAC,KAAK;QACpB,WAAW;IACb;IACA,OAAO;QAAE,IAAI;IAAK;AACpB;AACO,eAAe;IACpB,iEAAiE;IACjE,MAAM,MAAM,sCAAgC,0BAAyC;IACrF;;IAUA,OAAO,EAAE;AACX;AAEO,SAAS,qBAAqB,QAAgB,EAAE,MAAW;IAChE,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,IAAI,OAAO,GAAG;QACZ,OAAO,CAAC,IAAI,GAAG;YAAE,GAAG,OAAO,CAAC,IAAI;YAAE,aAAa;YAAQ,gBAAgB;QAAK;QAC5E,WAAW;IACb;AACF;AAEO,SAAS,qBAAqB,QAAgB;IACnD,MAAM,QAAQ,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACzC,OAAO,OAAO,eAAe;AAC/B"}},
    {"offset": {"line": 297, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/mailStatus.ts"],"sourcesContent":["const STORAGE_KEY = 'mail_log_v1';\n\ntype MailEntry = { clientId: string; email: string; mailedAt: number };\n\nfunction read(): MailEntry[] {\n  if (typeof window === 'undefined') return [];\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    return raw ? (JSON.parse(raw) as MailEntry[]) : [];\n  } catch {\n    return [];\n  }\n}\n\nfunction write(items: MailEntry[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nexport function hasMailed(clientId: string, email: string): boolean {\n  const all = read();\n  return all.some((e) => e.clientId === clientId && e.email === email);\n}\n\nexport function markMailed(clientId: string, emails: string[]) {\n  const now = Date.now();\n  const all = read();\n  const next = [...all];\n  emails.forEach((e) => {\n    const email = (e || '').trim();\n    if (!email) return;\n    if (!next.some((x) => x.clientId === clientId && x.email === email)) {\n      next.push({ clientId, email, mailedAt: now });\n    }\n  });\n  write(next);\n}\n\nexport function getMailEntries() {\n  return read();\n}\n\n\n"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,cAAc;AAIpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;AAO9C;AAEA,SAAS,MAAM,KAAkB;IAC/B,wCAAmC;;;AAErC;AAEO,SAAS,UAAU,QAAgB,EAAE,KAAa;IACvD,MAAM,MAAM;IACZ,OAAO,IAAI,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK,YAAY,EAAE,KAAK,KAAK;AAChE;AAEO,SAAS,WAAW,QAAgB,EAAE,MAAgB;IAC3D,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,MAAM;IACZ,MAAM,OAAO;WAAI;KAAI;IACrB,OAAO,OAAO,CAAC,CAAC;QACd,MAAM,QAAQ,CAAC,KAAK,EAAE,EAAE,IAAI;QAC5B,IAAI,CAAC,OAAO;QACZ,IAAI,CAAC,KAAK,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK,YAAY,EAAE,KAAK,KAAK,QAAQ;YACnE,KAAK,IAAI,CAAC;gBAAE;gBAAU;gBAAO,UAAU;YAAI;QAC7C;IACF;IACA,MAAM;AACR;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 346, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/scholarships.ts"],"sourcesContent":["const KEY = 'dashboard_scholarships_v1';\n\ntype Store = { [agencyEmail: string]: number };\n\nexport function getScholarships(agencyEmail: string): number {\n  if (typeof window === 'undefined') return 0;\n  try {\n    const raw = localStorage.getItem(KEY);\n    const obj = raw ? (JSON.parse(raw) as Store) : {};\n    return obj[agencyEmail] ?? 0;\n  } catch {\n    return 0;\n  }\n}\n\nexport function setScholarships(agencyEmail: string, n: number) {\n  if (typeof window === 'undefined') return;\n  try {\n    const raw = localStorage.getItem(KEY);\n    const obj = raw ? (JSON.parse(raw) as Store) : {};\n    obj[agencyEmail] = Math.max(0, Number(n) || 0);\n    localStorage.setItem(KEY, JSON.stringify(obj));\n  } catch {}\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,MAAM;AAIL,SAAS,gBAAgB,WAAmB;IACjD,wCAAmC,OAAO;;;AAQ5C;AAEO,SAAS,gBAAgB,WAAmB,EAAE,CAAS;IAC5D,wCAAmC;;;AAOrC"}},
    {"offset": {"line": 367, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/analytics.ts"],"sourcesContent":["const KEY = 'dashboard_open_clicks_v1';\n\ntype DayMetrics = { opens: number; clicks: number };\ntype Store = { [agencyEmail: string]: { [dateISO: string]: DayMetrics } };\n\nfunction todayISO(d = new Date()) {\n  return d.toISOString().slice(0, 10);\n}\n\nexport function getOpensClicksByDate(agencyEmail: string, days = 14): Array<{ date: string; opens: number; clicks: number }> {\n  if (typeof window === 'undefined') return [];\n  try {\n    const raw = localStorage.getItem(KEY);\n    const obj = raw ? (JSON.parse(raw) as Store) : {};\n    const map = obj[agencyEmail] || {};\n    const out: Array<{ date: string; opens: number; clicks: number }> = [];\n    const base = new Date();\n    for (let i = days - 1; i >= 0; i--) {\n      const d = new Date(base);\n      d.setDate(base.getDate() - i);\n      const k = todayISO(d);\n      const row = map[k] || { opens: 0, clicks: 0 };\n      out.push({ date: k, opens: row.opens || 0, clicks: row.clicks || 0 });\n    }\n    return out;\n  } catch {\n    return [];\n  }\n}\n\nexport function setOpensClicks(agencyEmail: string, dateISO: string, metrics: Partial<DayMetrics>) {\n  if (typeof window === 'undefined') return;\n  try {\n    const raw = localStorage.getItem(KEY);\n    const obj = raw ? (JSON.parse(raw) as Store) : {};\n    const perAgency = obj[agencyEmail] || {};\n    const prev = perAgency[dateISO] || { opens: 0, clicks: 0 };\n    perAgency[dateISO] = { opens: Math.max(0, Number(metrics.opens ?? prev.opens)), clicks: Math.max(0, Number(metrics.clicks ?? prev.clicks)) };\n    obj[agencyEmail] = perAgency;\n    localStorage.setItem(KEY, JSON.stringify(obj));\n  } catch {}\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,MAAM;AAKZ,SAAS,SAAS,IAAI,IAAI,MAAM;IAC9B,OAAO,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG;AAClC;AAEO,SAAS,qBAAqB,WAAmB,EAAE,OAAO,EAAE;IACjE,wCAAmC,OAAO,EAAE;;;AAkB9C;AAEO,SAAS,eAAe,WAAmB,EAAE,OAAe,EAAE,OAA4B;IAC/F,wCAAmC;;;AAUrC"}},
    {"offset": {"line": 391, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/dashboard/page.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { useSession } from '@/features/auth/session';\nimport { useQuery } from '@tanstack/react-query';\nimport { listAgencies } from '@/services/agencies';\nimport { listClientsByAgencyEmail } from '@/services/clients';\nimport { Typography, Box, Card, CardContent, TextField, Button, Divider } from '@mui/material';\nimport { DataGrid, GridColDef } from '@mui/x-data-grid';\nimport { getMailEntries } from '@/services/mailStatus';\nimport { getScholarships, setScholarships } from '@/services/scholarships';\nimport { getOpensClicksByDate, setOpensClicks } from '@/services/analytics';\n\nexport default function DashboardPage() {\n  const { session } = useSession();\n  const isParent = session?.role === 'parent';\n  const q = useQuery<any[]>({\n    queryKey: ['dashboard', session?.role, session?.agencyId],\n    queryFn: () => isParent ? listAgencies() : listClientsByAgencyEmail(session!.email),\n  });\n  const [schInput, setSchInput] = React.useState<string>('');\n  const [trend, setTrend] = React.useState<Array<{ date: string; opens: number; clicks: number }>>([]);\n\n  React.useEffect(() => {\n    if (!session?.email || isParent) return;\n    setTrend(getOpensClicksByDate(session.email, 14));\n    setSchInput(String(getScholarships(session.email)));\n  }, [session?.email, isParent]);\n  if (!session) return null;\n  if (!q.data) return null;\n\n  if (isParent) {\n    const rows = q.data;\n    const columns: GridColDef[] = [{ field: 'name', headerName: 'Agency', flex: 1 }];\n    return (\n      <>\n        <Typography variant=\"h4\" gutterBottom>Dashboard</Typography>\n        <div style={{ height: 520 }}>\n          <DataGrid rows={rows as any[]} columns={columns} getRowId={(r)=>r.id} />\n        </div>\n      </>\n    );\n  }\n\n  // Agency dashboard\n  const clients = q.data as any[];\n  const clientIds = new Set<string>(clients.map(c => c.id));\n  const totalClients = clients.length;\n\n  // Emails sent (count mail logs whose clientId belongs to this agency)\n  const mail = getMailEntries().filter(m => clientIds.has(m.clientId));\n  const emailsSent = mail.length;\n\n  // Grad year breakdown: current year..current+3 (inclusive)\n  const thisYear = new Date().getFullYear();\n  const years = [thisYear, thisYear + 1, thisYear + 2, thisYear + 3];\n  const byYear: Record<number, number> = { [years[0]]: 0, [years[1]]: 0, [years[2]]: 0, [years[3]]: 0 };\n  clients.forEach(c => {\n    const gy = Number(c?.radar?.graduationYear || c?.graduationYear || 0);\n    if (years.includes(gy)) byYear[gy] = (byYear[gy] || 0) + 1;\n  });\n\n  function saveScholarships() {\n    if (!session?.email) return;\n    setScholarships(session.email, Number(schInput) || 0);\n    setSchInput(String(getScholarships(session.email)));\n  }\n\n  function updateTrend(date: string, key: 'opens'|'clicks', val: string) {\n    if (!session?.email) return;\n    setOpensClicks(session.email, date, { [key]: Number(val) || 0 });\n    setTrend(getOpensClicksByDate(session.email, 14));\n  }\n\n  return (\n    <>\n      <Typography variant=\"h4\" gutterBottom>Dashboard</Typography>\n\n      <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: 'repeat(4, 1fr)' }, gap: 2, mb: 3 }}>\n        <Card><CardContent>\n          <Typography variant=\"subtitle2\" color=\"text.secondary\">Emails Sent</Typography>\n          <Typography variant=\"h5\">{emailsSent}</Typography>\n        </CardContent></Card>\n        <Card><CardContent>\n          <Typography variant=\"subtitle2\" color=\"text.secondary\">Total Clients</Typography>\n          <Typography variant=\"h5\">{totalClients}</Typography>\n        </CardContent></Card>\n        <Card><CardContent>\n          <Typography variant=\"subtitle2\" color=\"text.secondary\">Scholarships Awarded</Typography>\n          <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', mt: 1 }}>\n            <TextField size=\"small\" type=\"number\" value={schInput} onChange={(e)=>setSchInput(e.target.value)} sx={{ width: 100 }} />\n            <Button size=\"small\" variant=\"outlined\" onClick={saveScholarships}>Save</Button>\n          </Box>\n        </CardContent></Card>\n        <Card><CardContent>\n          <Typography variant=\"subtitle2\" color=\"text.secondary\">Window</Typography>\n          <Typography variant=\"body2\">Last 14 days</Typography>\n        </CardContent></Card>\n      </Box>\n\n      <Box sx={{ display: 'grid', gridTemplateColumns: { xs: '1fr', md: '1.2fr 1fr' }, gap: 3, mb: 3 }}>\n        <Card>\n          <CardContent>\n            <Typography variant=\"h6\" gutterBottom>Open & Click Trends (manual)</Typography>\n            <Box sx={{ display: 'grid', gridTemplateColumns: '140px 1fr 1fr', gap: 1, alignItems: 'center' }}>\n              <Typography variant=\"subtitle2\" color=\"text.secondary\">Date</Typography>\n              <Typography variant=\"subtitle2\" color=\"text.secondary\">Opens</Typography>\n              <Typography variant=\"subtitle2\" color=\"text.secondary\">Clicks</Typography>\n              {trend.map(row => (\n                <React.Fragment key={row.date}>\n                  <Typography variant=\"body2\">{row.date}</Typography>\n                  <TextField size=\"small\" type=\"number\" value={row.opens} onChange={(e)=>updateTrend(row.date, 'opens', e.target.value)} />\n                  <TextField size=\"small\" type=\"number\" value={row.clicks} onChange={(e)=>updateTrend(row.date, 'clicks', e.target.value)} />\n                </React.Fragment>\n              ))}\n            </Box>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent>\n            <Typography variant=\"h6\" gutterBottom>Graduation Year Breakdown</Typography>\n            <Box sx={{ display: 'grid', gridTemplateColumns: '1fr 80px', gap: 1 }}>\n              <Typography variant=\"subtitle2\" color=\"text.secondary\">Year</Typography>\n              <Typography variant=\"subtitle2\" color=\"text.secondary\" align=\"right\">Count</Typography>\n              {years.map(y => (\n                <React.Fragment key={y}>\n                  <Typography variant=\"body2\">Class of {y}</Typography>\n                  <Typography variant=\"body2\" align=\"right\">{byYear[y] || 0}</Typography>\n                </React.Fragment>\n              ))}\n            </Box>\n          </CardContent>\n        </Card>\n      </Box>\n\n      <Divider sx={{ my: 2 }} />\n\n      <Typography variant=\"h6\" gutterBottom>Clients</Typography>\n      <div style={{ height: 520 }}>\n        <DataGrid\n          rows={clients as any[]}\n          columns={[\n            { field: 'email', headerName: 'Email', flex: 1 },\n            { field: 'firstName', headerName: 'First', width: 120 },\n            { field: 'lastName', headerName: 'Last', width: 120 },\n            { field: 'sport', headerName: 'Sport', width: 120 },\n            { field: 'graduationYear', headerName: 'Grad Year', width: 120, valueGetter: (p: any)=> (p && p.row ? (p.row?.radar?.graduationYear || p.row.graduationYear || '') : '') },\n          ]}\n          getRowId={(r)=>r.id}\n        />\n      </div>\n    </>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}