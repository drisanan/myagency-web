{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/agencies/page.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { Box, Button, Typography } from '@mui/material';\nimport { DataGrid, GridColDef } from '@mui/x-data-grid';\nimport Link from 'next/link';\nimport { getAgencies } from '@/services/agencies';\ntype AgencyRow = { id: string; name: string; email: string; active?: boolean };\nimport { useSession } from '@/features/auth/session';\nimport { useRouter } from 'next/navigation';\nimport { logImpersonationStart } from '@/services/audit';\n\nexport default function AgenciesPage() {\n  const { session, setSession } = useSession();\n  const router = useRouter();\n  const [rows, setRows] = React.useState<any[]>([]);\n\n  React.useEffect(() => {\n    if (session?.role !== 'parent') {\n      router.push('/dashboard');\n      return;\n    }\n    getAgencies().then(list => {\n      setRows(list.map((a: AgencyRow) => ({ id: a.id, name: a.name, email: a.email, active: a.active ?? true })));\n    });\n  }, [session, router]);\n\n  const columns: GridColDef[] = [\n    { field: 'name', headerName: 'Name', flex: 1 },\n    { field: 'email', headerName: 'Email', flex: 1 },\n    { field: 'active', headerName: 'Active', width: 120 },\n    {\n      field: 'actions',\n      headerName: 'Actions',\n      width: 180,\n      renderCell: (params) => {\n        const impersonate = () => {\n          if (!session) return;\n          const parent = session;\n          // save base session to restore later\n          if (typeof window !== 'undefined') {\n            window.localStorage.setItem('session_impersonation_base', JSON.stringify(parent));\n          }\n          logImpersonationStart(parent.email, params.row.email);\n          setSession({ role: 'agency', email: params.row.email, agencyId: params.row.id, impersonatedBy: { email: parent.email, role: 'parent' } } as any);\n          router.push('/dashboard');\n        };\n        return (\n          <Button size=\"small\" onClick={impersonate}>Impersonate</Button>\n        );\n      }\n    },\n  ];\n\n  return (\n    <Box>\n      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\n        <Typography variant=\"h5\">Agencies</Typography>\n        <Button data-testid=\"agencies-new\" LinkComponent={Link} href=\"/agencies/new\" variant=\"contained\">New Agency</Button>\n      </Box>\n      <div style={{ height: 440, width: 800 }}>\n        <DataGrid rows={rows} columns={columns} disableRowSelectionOnClick />\n      </div>\n    </Box>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AATA;;;;;;;;;;AAWe,SAAS;IACtB,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,IAAA,0IAAU;IAC1C,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,gNAAK,CAAC,QAAQ,CAAQ,EAAE;IAEhD,gNAAK,CAAC,SAAS,CAAC;QACd,IAAI,SAAS,SAAS,UAAU;YAC9B,OAAO,IAAI,CAAC;YACZ;QACF;QACA,IAAA,mIAAW,IAAG,IAAI,CAAC,CAAA;YACjB,QAAQ,KAAK,GAAG,CAAC,CAAC,IAAiB,CAAC;oBAAE,IAAI,EAAE,EAAE;oBAAE,MAAM,EAAE,IAAI;oBAAE,OAAO,EAAE,KAAK;oBAAE,QAAQ,EAAE,MAAM,IAAI;gBAAK,CAAC;QAC1G;IACF,GAAG;QAAC;QAAS;KAAO;IAEpB,MAAM,UAAwB;QAC5B;YAAE,OAAO;YAAQ,YAAY;YAAQ,MAAM;QAAE;QAC7C;YAAE,OAAO;YAAS,YAAY;YAAS,MAAM;QAAE;QAC/C;YAAE,OAAO;YAAU,YAAY;YAAU,OAAO;QAAI;QACpD;YACE,OAAO;YACP,YAAY;YACZ,OAAO;YACP,YAAY,CAAC;gBACX,MAAM,cAAc;oBAClB,IAAI,CAAC,SAAS;oBACd,MAAM,SAAS;oBACf,qCAAqC;oBACrC;;oBAGA,IAAA,0IAAqB,EAAC,OAAO,KAAK,EAAE,OAAO,GAAG,CAAC,KAAK;oBACpD,WAAW;wBAAE,MAAM;wBAAU,OAAO,OAAO,GAAG,CAAC,KAAK;wBAAE,UAAU,OAAO,GAAG,CAAC,EAAE;wBAAE,gBAAgB;4BAAE,OAAO,OAAO,KAAK;4BAAE,MAAM;wBAAS;oBAAE;oBACvI,OAAO,IAAI,CAAC;gBACd;gBACA,qBACE,8OAAC,2MAAM;oBAAC,MAAK;oBAAQ,SAAS;8BAAa;;;;;;YAE/C;QACF;KACD;IAED,qBACE,8OAAC,+LAAG;;0BACF,8OAAC,+LAAG;gBAAC,IAAI;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,YAAY;oBAAU,IAAI;gBAAE;;kCACvF,8OAAC,2NAAU;wBAAC,SAAQ;kCAAK;;;;;;kCACzB,8OAAC,2MAAM;wBAAC,eAAY;wBAAe,eAAe,uKAAI;wBAAE,MAAK;wBAAgB,SAAQ;kCAAY;;;;;;;;;;;;0BAEnG,8OAAC;gBAAI,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAI;0BACpC,cAAA,8OAAC,qLAAQ;oBAAC,MAAM;oBAAM,SAAS;oBAAS,0BAA0B;;;;;;;;;;;;;;;;;AAI1E"}}]
}