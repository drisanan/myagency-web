{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/agencies.ts"],"sourcesContent":["const STORAGE_KEY = 'agencies_data';\n\nfunction readStore(): Agency[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    return JSON.parse(raw) as Agency[];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeStore(items: Agency[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nexport type AgencySettings = {\n  primaryColor?: string;\n  secondaryColor?: string;\n  logoDataUrl?: string;\n};\nexport type Agency = {\n  id: string;\n  name: string;\n  email: string;\n  password?: string;\n  ownerFirstName?: string;\n  ownerLastName?: string;\n  ownerEmail?: string;\n  ownerPhone?: string;\n  active?: boolean;\n  settings?: AgencySettings;\n};\n\nconst SEED_AGENCIES: Agency[] = [\n  { id: 'agency-001', name: 'Prime Sports', email: 'agency1@an.test', settings: { primaryColor: '#1976d2' } },\n  { id: 'agency-002', name: 'NextGen', email: 'agency2@an.test', settings: { primaryColor: '#9c27b0' } },\n  { id: 'agency-003', name: 'Elite Edge', email: 'agency3@an.test', settings: { primaryColor: '#2e7d32' } },\n];\n\nlet AGENCIES: Agency[] = (() => {\n  const fromStore = readStore();\n  if (fromStore.length > 0) return fromStore;\n  writeStore(SEED_AGENCIES);\n  return [...SEED_AGENCIES];\n})();\n\nexport { AGENCIES };\n\nexport async function listAgencies() {\n  return AGENCIES.map(a => ({ id: a.id, name: a.name }));\n}\n\nexport async function getAgencies() {\n  return [...AGENCIES];\n}\n\nexport async function getAgencyByEmail(email: string) {\n  return AGENCIES.find(a => a.email === email) ?? null;\n}\n\nexport async function getAgencyById(id: string) {\n  return AGENCIES.find(a => a.id === id) ?? null;\n}\n\nexport async function getAgencySettings(email: string) {\n  const a = AGENCIES.find(x => x.email === email);\n  return a?.settings ?? {};\n}\n\nexport async function updateAgencySettings(email: string, settings: AgencySettings) {\n  const a = AGENCIES.find(x => x.email === email);\n  if (!a) return { ok: false };\n  a.settings = { ...(a.settings ?? {}), ...settings };\n  writeStore(AGENCIES);\n  return { ok: true, settings: a.settings };\n}\n\ntype UpsertInput = Omit<Agency, 'id'> & { id?: string };\nexport async function upsertAgency(input: UpsertInput) {\n  if (input.id) {\n    const idx = AGENCIES.findIndex(a => a.id === input.id);\n    if (idx >= 0) {\n      AGENCIES[idx] = { ...AGENCIES[idx], ...input, id: input.id };\n      writeStore(AGENCIES);\n      return { id: input.id };\n    }\n  }\n  const id = `agency-${(Math.random() * 1e6).toFixed(0)}`;\n  AGENCIES.push({\n    id,\n    name: input.name,\n    email: input.email,\n    password: input.password,\n    ownerFirstName: input.ownerFirstName,\n    ownerLastName: input.ownerLastName,\n    ownerEmail: input.ownerEmail,\n    ownerPhone: input.ownerPhone,\n    active: input.active ?? true,\n    settings: input.settings ?? {},\n  });\n  writeStore(AGENCIES);\n  return { id };\n}\n\nexport async function deleteAgency(id: string) {\n  const idx = AGENCIES.findIndex(a => a.id === id);\n  if (idx >= 0) {\n    AGENCIES.splice(idx, 1);\n    writeStore(AGENCIES);\n    return { ok: true };\n  }\n  return { ok: false };\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;IAC5C,MAAM;AAOR;AAEA,SAAS,WAAW,KAAe;IACjC,wCAAmC;;;AAErC;AAoBA,MAAM,gBAA0B;IAC9B;QAAE,IAAI;QAAc,MAAM;QAAgB,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;IAC1G;QAAE,IAAI;QAAc,MAAM;QAAW,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;IACrG;QAAE,IAAI;QAAc,MAAM;QAAc,OAAO;QAAmB,UAAU;YAAE,cAAc;QAAU;IAAE;CACzG;AAED,IAAI,WAAqB,CAAC;IACxB,MAAM,YAAY;IAClB,IAAI,UAAU,MAAM,GAAG,GAAG,OAAO;IACjC,WAAW;IACX,OAAO;WAAI;KAAc;AAC3B,CAAC;;AAIM,eAAe;IACpB,OAAO,SAAS,GAAG,CAAC,CAAA,IAAK,CAAC;YAAE,IAAI,EAAE,EAAE;YAAE,MAAM,EAAE,IAAI;QAAC,CAAC;AACtD;AAEO,eAAe;IACpB,OAAO;WAAI;KAAS;AACtB;AAEO,eAAe,iBAAiB,KAAa;IAClD,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK,UAAU;AAClD;AAEO,eAAe,cAAc,EAAU;IAC5C,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO;AAC5C;AAEO,eAAe,kBAAkB,KAAa;IACnD,MAAM,IAAI,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;IACzC,OAAO,GAAG,YAAY,CAAC;AACzB;AAEO,eAAe,qBAAqB,KAAa,EAAE,QAAwB;IAChF,MAAM,IAAI,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;IACzC,IAAI,CAAC,GAAG,OAAO;QAAE,IAAI;IAAM;IAC3B,EAAE,QAAQ,GAAG;QAAE,GAAI,EAAE,QAAQ,IAAI,CAAC,CAAC;QAAG,GAAG,QAAQ;IAAC;IAClD,WAAW;IACX,OAAO;QAAE,IAAI;QAAM,UAAU,EAAE,QAAQ;IAAC;AAC1C;AAGO,eAAe,aAAa,KAAkB;IACnD,IAAI,MAAM,EAAE,EAAE;QACZ,MAAM,MAAM,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,MAAM,EAAE;QACrD,IAAI,OAAO,GAAG;YACZ,QAAQ,CAAC,IAAI,GAAG;gBAAE,GAAG,QAAQ,CAAC,IAAI;gBAAE,GAAG,KAAK;gBAAE,IAAI,MAAM,EAAE;YAAC;YAC3D,WAAW;YACX,OAAO;gBAAE,IAAI,MAAM,EAAE;YAAC;QACxB;IACF;IACA,MAAM,KAAK,CAAC,OAAO,EAAE,CAAC,KAAK,MAAM,KAAK,GAAG,EAAE,OAAO,CAAC,IAAI;IACvD,SAAS,IAAI,CAAC;QACZ;QACA,MAAM,MAAM,IAAI;QAChB,OAAO,MAAM,KAAK;QAClB,UAAU,MAAM,QAAQ;QACxB,gBAAgB,MAAM,cAAc;QACpC,eAAe,MAAM,aAAa;QAClC,YAAY,MAAM,UAAU;QAC5B,YAAY,MAAM,UAAU;QAC5B,QAAQ,MAAM,MAAM,IAAI;QACxB,UAAU,MAAM,QAAQ,IAAI,CAAC;IAC/B;IACA,WAAW;IACX,OAAO;QAAE;IAAG;AACd;AAEO,eAAe,aAAa,EAAU;IAC3C,MAAM,MAAM,SAAS,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC7C,IAAI,OAAO,GAAG;QACZ,SAAS,MAAM,CAAC,KAAK;QACrB,WAAW;QACX,OAAO;YAAE,IAAI;QAAK;IACpB;IACA,OAAO;QAAE,IAAI;IAAM;AACrB"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/clients.ts"],"sourcesContent":["import { getAgencyById } from '@/services/agencies';\n\ntype Client = {\n  id: string;\n  email: string;\n  firstName: string;\n  lastName: string;\n  sport: string;\n  agencyEmail: string;\n  agencyId?: string;\n  password?: string;\n  radar?: any;\n  gmailTokens?: any;\n  gmailConnected?: boolean;\n};\n\nconst STORAGE_KEY = 'clients_data';\n\nconst SEED_CLIENTS: Client[] = [\n  { id: 'ag1-c1', email: 'a1@athletes.test', firstName: 'Ava', lastName: 'Smith', sport: 'Football', agencyEmail: 'agency1@an.test' },\n  { id: 'ag1-c2', email: 'a2@athletes.test', firstName: 'Ben', lastName: 'Jones', sport: 'Basketball', agencyEmail: 'agency1@an.test' },\n  { id: 'ag2-c1', email: 'b1@athletes.test', firstName: 'Cara', lastName: 'Lee', sport: 'Baseball', agencyEmail: 'agency2@an.test' },\n  { id: 'ag3-c1', email: 'c1@athletes.test', firstName: 'Dan', lastName: 'Kim', sport: 'Soccer', agencyEmail: 'agency3@an.test' },\n];\n\nfunction readStore(): Client[] {\n  if (typeof window === 'undefined') return [...SEED_CLIENTS];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [...SEED_CLIENTS];\n  try {\n    const parsed = JSON.parse(raw) as Client[];\n    return parsed.length ? parsed : [...SEED_CLIENTS];\n  } catch {\n    return [...SEED_CLIENTS];\n  }\n}\n\nfunction writeStore(items: Client[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nlet CLIENTS: Client[] = readStore();\n\nexport async function listClientsByAgencyEmail(agencyEmail: string) {\n  if (typeof window !== 'undefined') {\n    CLIENTS = readStore();\n  }\n  return CLIENTS.filter(c => c.agencyEmail === agencyEmail);\n}\n\nexport async function listClientsByAgency(agencyId: string) {\n  const agency = await getAgencyById(agencyId);\n  if (!agency) return [];\n  return listClientsByAgencyEmail(agency.email);\n}\nexport async function upsertClient(input: any) {\n  const id = input.id ?? `c-${(Math.random() * 1e6).toFixed(0)}`;\n  const idx = CLIENTS.findIndex(c => c.id === id);\n  if (typeof window !== 'undefined') {\n    // helpful for e2e debugging\n    // eslint-disable-next-line no-console\n    console.debug('[clients] upsertClient payload', input);\n  }\n  const next: Client = { ...CLIENTS[idx] , ...input, id };\n  if (idx >= 0) {\n    CLIENTS[idx] = next;\n  } else {\n    CLIENTS.push(next);\n  }\n  writeStore(CLIENTS);\n  return next;\n}\nexport async function getClient(id: string) {\n  if (typeof window !== 'undefined') {\n    CLIENTS = readStore();\n  }\n  if (typeof window !== 'undefined') {\n    try {\n      const raw = window.localStorage.getItem(STORAGE_KEY);\n      if (raw) {\n        const list = JSON.parse(raw) as Client[];\n        const hit = list.find((c) => c.id === id);\n        if (hit) {\n          CLIENTS = list;\n          return hit;\n        }\n      }\n    } catch {\n      // ignore\n    }\n  }\n  let found = CLIENTS.find(c => c.id === id);\n  if (!found) {\n    CLIENTS = readStore();\n    found = CLIENTS.find(c => c.id === id);\n  }\n  return found ?? { id, email: 'athlete1@example.com', firstName: 'A1', lastName: 'L1', sport: 'Football', agencyEmail: '' };\n}\nexport async function deleteClient(id: string) {\n  const idx = CLIENTS.findIndex(c => c.id === id);\n  if (idx >= 0) {\n    CLIENTS.splice(idx, 1);\n    writeStore(CLIENTS);\n  }\n  return { ok: true };\n}\nexport async function getClients() {\n  // Determine current session from localStorage to enforce tenancy\n  const raw = typeof window !== 'undefined' ? window.localStorage.getItem('session') : null;\n  if (raw) {\n    try {\n      const s = JSON.parse(raw) as { role: 'parent' | 'agency'; email: string };\n      if (s.role === 'agency') {\n        const list = await listClientsByAgencyEmail(s.email);\n        if (typeof window !== 'undefined') {\n          // eslint-disable-next-line no-console\n          console.debug('[clients] getClients list size', list.length);\n        }\n        return list;\n      }\n    } catch {\n      // fall through\n    }\n  }\n  return [];\n}\n\nexport function setClientGmailTokens(clientId: string, tokens: any) {\n  const idx = CLIENTS.findIndex(c => c.id === clientId);\n  if (idx >= 0) {\n    CLIENTS[idx] = { ...CLIENTS[idx], gmailTokens: tokens, gmailConnected: true };\n    writeStore(CLIENTS);\n  }\n}\n\nexport function getClientGmailTokens(clientId: string): any | null {\n  const found = CLIENTS.find(c => c.id === clientId);\n  return found?.gmailTokens ?? null;\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAgBA,MAAM,cAAc;AAEpB,MAAM,eAAyB;IAC7B;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAS,OAAO;QAAY,aAAa;IAAkB;IAClI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAS,OAAO;QAAc,aAAa;IAAkB;IACpI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAQ,UAAU;QAAO,OAAO;QAAY,aAAa;IAAkB;IACjI;QAAE,IAAI;QAAU,OAAO;QAAoB,WAAW;QAAO,UAAU;QAAO,OAAO;QAAU,aAAa;IAAkB;CAC/H;AAED,SAAS;IACP,wCAAmC,OAAO;WAAI;KAAa;;;IAC3D,MAAM;AAQR;AAEA,SAAS,WAAW,KAAe;IACjC,wCAAmC;;;AAErC;AAEA,IAAI,UAAoB;AAEjB,eAAe,yBAAyB,WAAmB;IAChE;;IAGA,OAAO,QAAQ,MAAM,CAAC,CAAA,IAAK,EAAE,WAAW,KAAK;AAC/C;AAEO,eAAe,oBAAoB,QAAgB;IACxD,MAAM,SAAS,MAAM,IAAA,qIAAa,EAAC;IACnC,IAAI,CAAC,QAAQ,OAAO,EAAE;IACtB,OAAO,yBAAyB,OAAO,KAAK;AAC9C;AACO,eAAe,aAAa,KAAU;IAC3C,MAAM,KAAK,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,KAAK,MAAM,KAAK,GAAG,EAAE,OAAO,CAAC,IAAI;IAC9D,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C;;IAKA,MAAM,OAAe;QAAE,GAAG,OAAO,CAAC,IAAI;QAAG,GAAG,KAAK;QAAE;IAAG;IACtD,IAAI,OAAO,GAAG;QACZ,OAAO,CAAC,IAAI,GAAG;IACjB,OAAO;QACL,QAAQ,IAAI,CAAC;IACf;IACA,WAAW;IACX,OAAO;AACT;AACO,eAAe,UAAU,EAAU;IACxC;;IAGA;;IAeA,IAAI,QAAQ,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACvC,IAAI,CAAC,OAAO;QACV,UAAU;QACV,QAAQ,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACrC;IACA,OAAO,SAAS;QAAE;QAAI,OAAO;QAAwB,WAAW;QAAM,UAAU;QAAM,OAAO;QAAY,aAAa;IAAG;AAC3H;AACO,eAAe,aAAa,EAAU;IAC3C,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,IAAI,OAAO,GAAG;QACZ,QAAQ,MAAM,CAAC,KAAK;QACpB,WAAW;IACb;IACA,OAAO;QAAE,IAAI;IAAK;AACpB;AACO,eAAe;IACpB,iEAAiE;IACjE,MAAM,MAAM,sCAAgC,0BAAyC;IACrF;;IAeA,OAAO,EAAE;AACX;AAEO,SAAS,qBAAqB,QAAgB,EAAE,MAAW;IAChE,MAAM,MAAM,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC5C,IAAI,OAAO,GAAG;QACZ,OAAO,CAAC,IAAI,GAAG;YAAE,GAAG,OAAO,CAAC,IAAI;YAAE,aAAa;YAAQ,gBAAgB;QAAK;QAC5E,WAAW;IACb;AACF;AAEO,SAAS,qBAAqB,QAAgB;IACnD,MAAM,QAAQ,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACzC,OAAO,OAAO,eAAe;AAC/B"}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/features/clients/ClientsList.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { listClientsByAgencyEmail, deleteClient } from '@/services/clients';\nimport { DataGrid, GridColDef } from '@mui/x-data-grid';\nimport { Button, Stack, Box, Typography, Avatar, Paper } from '@mui/material';\nimport { useSession } from '@/features/auth/session';\n\nexport function ClientsList() {\n  const { session } = useSession();\n  const agencyEmail = session?.email || '';\n  const { data = [], refetch } = useQuery({\n    queryKey: ['clients', agencyEmail],\n    queryFn: () => agencyEmail ? listClientsByAgencyEmail(agencyEmail) : [],\n    enabled: Boolean(agencyEmail),\n  });\n  const cols: GridColDef[] = [\n    {\n      field: 'athlete',\n      headerName: 'Athlete',\n      flex: 1.4,\n      sortable: false,\n      renderCell: (params) => {\n        const row = params.row as any;\n        const name = `${row.firstName ?? ''} ${row.lastName ?? ''}`.trim() || 'Unknown';\n        const description = row?.description || row?.radar?.description || 'No description provided';\n        const photo = row?.photoUrl || row?.profileImageUrl || '/marketing/an-logo.png';\n        return (\n          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5, minWidth: 0, height: '100%' }}>\n            <Avatar\n              src={photo}\n              alt={name}\n              sx={{ width: 40, height: 40, borderRadius: '50%' }}\n            />\n            <Box sx={{ minWidth: 0, display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\n              <Typography variant=\"subtitle2\" sx={{ fontWeight: 700, lineHeight: 1.1 }} noWrap>\n                {name}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\" noWrap>\n                {description}\n              </Typography>\n            </Box>\n          </Box>\n        );\n      },\n    },\n    { field: 'email', headerName: 'Email', flex: 1 },\n    { field: 'sport', headerName: 'Sport', width: 120 },\n    {\n      field: 'actions',\n      headerName: 'Actions',\n      width: 200,\n      sortable: false,\n      renderCell: (p) => (\n        <Stack direction=\"row\" spacing={1}>\n          <Button size=\"small\" href={`/clients/${p.row.id}`}>View</Button>\n          <Button size=\"small\" href={`/clients/${p.row.id}/edit`}>Edit</Button>\n          <Button size=\"small\" color=\"error\" onClick={async ()=>{ await deleteClient(p.row.id); refetch(); }}>Delete</Button>\n        </Stack>\n      )\n    }\n  ];\n  return (\n    <Paper sx={{ height: 520, width: '100%', borderRadius: 2.5, overflow: 'hidden' }}>\n      <DataGrid\n        rows={data as any[]}\n        columns={cols}\n        getRowId={(r)=>r.id}\n        disableRowSelectionOnClick\n        sx={{\n          '& .MuiDataGrid-columnHeaders': {\n            backgroundColor: '#f9fafb',\n            borderBottom: 'none',\n          },\n          '& .MuiDataGrid-columnHeader': {\n            borderRight: 'none',\n          },\n        }}\n      />\n    </Paper>\n  );\n}\n\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AANA;;;;;;;AAQO,SAAS;IACd,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAU;IAC9B,MAAM,cAAc,SAAS,SAAS;IACtC,MAAM,EAAE,OAAO,EAAE,EAAE,OAAO,EAAE,GAAG,IAAA,uLAAQ,EAAC;QACtC,UAAU;YAAC;YAAW;SAAY;QAClC,SAAS,IAAM,cAAc,IAAA,+IAAwB,EAAC,eAAe,EAAE;QACvE,SAAS,QAAQ;IACnB;IACA,MAAM,OAAqB;QACzB;YACE,OAAO;YACP,YAAY;YACZ,MAAM;YACN,UAAU;YACV,YAAY,CAAC;gBACX,MAAM,MAAM,OAAO,GAAG;gBACtB,MAAM,OAAO,GAAG,IAAI,SAAS,IAAI,GAAG,CAAC,EAAE,IAAI,QAAQ,IAAI,IAAI,CAAC,IAAI,MAAM;gBACtE,MAAM,cAAc,KAAK,eAAe,KAAK,OAAO,eAAe;gBACnE,MAAM,QAAQ,KAAK,YAAY,KAAK,mBAAmB;gBACvD,qBACE,8OAAC,+LAAG;oBAAC,IAAI;wBAAE,SAAS;wBAAQ,YAAY;wBAAU,KAAK;wBAAK,UAAU;wBAAG,QAAQ;oBAAO;;sCACtF,8OAAC,2MAAM;4BACL,KAAK;4BACL,KAAK;4BACL,IAAI;gCAAE,OAAO;gCAAI,QAAQ;gCAAI,cAAc;4BAAM;;;;;;sCAEnD,8OAAC,+LAAG;4BAAC,IAAI;gCAAE,UAAU;gCAAG,SAAS;gCAAQ,eAAe;gCAAU,gBAAgB;4BAAS;;8CACzF,8OAAC,2NAAU;oCAAC,SAAQ;oCAAY,IAAI;wCAAE,YAAY;wCAAK,YAAY;oCAAI;oCAAG,MAAM;8CAC7E;;;;;;8CAEH,8OAAC,2NAAU;oCAAC,SAAQ;oCAAQ,OAAM;oCAAiB,MAAM;8CACtD;;;;;;;;;;;;;;;;;;YAKX;QACF;QACA;YAAE,OAAO;YAAS,YAAY;YAAS,MAAM;QAAE;QAC/C;YAAE,OAAO;YAAS,YAAY;YAAS,OAAO;QAAI;QAClD;YACE,OAAO;YACP,YAAY;YACZ,OAAO;YACP,UAAU;YACV,YAAY,CAAC,kBACX,8OAAC,uMAAK;oBAAC,WAAU;oBAAM,SAAS;;sCAC9B,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,MAAM,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE;sCAAE;;;;;;sCACnD,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,MAAM,CAAC,SAAS,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC;sCAAE;;;;;;sCACxD,8OAAC,2MAAM;4BAAC,MAAK;4BAAQ,OAAM;4BAAQ,SAAS;gCAAY,MAAM,IAAA,mIAAY,EAAC,EAAE,GAAG,CAAC,EAAE;gCAAG;4BAAW;sCAAG;;;;;;;;;;;;QAG1G;KACD;IACD,qBACE,8OAAC,uMAAK;QAAC,IAAI;YAAE,QAAQ;YAAK,OAAO;YAAQ,cAAc;YAAK,UAAU;QAAS;kBAC7E,cAAA,8OAAC,qLAAQ;YACP,MAAM;YACN,SAAS;YACT,UAAU,CAAC,IAAI,EAAE,EAAE;YACnB,0BAA0B;YAC1B,IAAI;gBACF,gCAAgC;oBAC9B,iBAAiB;oBACjB,cAAc;gBAChB;gBACA,+BAA+B;oBAC7B,aAAa;gBACf;YACF;;;;;;;;;;;AAIR"}},
    {"offset": {"line": 514, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/clients/page.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { ClientsList } from '@/features/clients/ClientsList';\nimport { Typography, Button, Stack, TextField } from '@mui/material';\nimport Link from 'next/link';\nimport { useSession } from '@/features/auth/session';\nimport { upsertClient } from '@/services/clients';\nimport { useQueryClient } from '@tanstack/react-query';\n\nexport default function ClientsPage() {\n  const { session } = useSession();\n  const queryClient = useQueryClient();\n  const [inviteUrl, setInviteUrl] = React.useState<string>('');\n  const [issuing, setIssuing] = React.useState<boolean>(false);\n  const [copied, setCopied] = React.useState<boolean>(false);\n  React.useEffect(() => {\n    (async () => {\n      if (!session?.email) return;\n      try {\n        const res = await fetch(`/api/forms/submissions?agencyEmail=${encodeURIComponent(session.email)}`);\n        const data = await res.json();\n        if (!data?.ok) return;\n        const items = Array.isArray(data.items) ? data.items : [];\n        const idsToConsume: string[] = [];\n        for (const s of items) {\n          const v = s?.data || {};\n          const client = {\n            id: s.id,\n            email: v.email || '',\n            phone: v.phone || '',\n            password: v.password || '',\n            firstName: v.firstName || '',\n            lastName: v.lastName || '',\n            sport: v.sport || '',\n            division: v.division || '',\n            agencyEmail: session.email,\n            photoUrl: v.profileImageUrl || '',\n            radar: v.radar || {},\n          };\n          await upsertClient(client as any);\n          idsToConsume.push(s.id);\n        }\n        if (idsToConsume.length) {\n          await fetch('/api/forms/consume', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ agencyEmail: session.email, ids: idsToConsume }),\n          });\n          queryClient.invalidateQueries({ queryKey: ['clients', session.email] });\n        }\n      } catch {}\n    })();\n  }, [session?.email]);\n  async function handleGenerateLink() {\n    try {\n      if (!session?.email) return;\n      setIssuing(true);\n      const res = await fetch('/api/forms/issue', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ agencyEmail: session.email }),\n      });\n      const data = await res.json();\n      if (!res.ok || !data?.ok) throw new Error(data?.error || 'Failed to create link');\n      setInviteUrl(data.url);\n    } catch {\n      setInviteUrl('');\n    } finally {\n      setIssuing(false);\n    }\n  }\n  async function handleCopy() {\n    if (!inviteUrl) return;\n    try {\n      await navigator.clipboard.writeText(inviteUrl);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 1500);\n    } catch {}\n  }\n  return (\n    <Stack spacing={2}>\n      <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n        <Typography variant=\"h4\">Athletes</Typography>\n        <Stack direction=\"row\" spacing={1}>\n          <Button LinkComponent={Link} href=\"/clients/new\" variant=\"contained\">New</Button>\n          <Button variant=\"outlined\" onClick={handleGenerateLink} disabled={issuing}>\n            {issuing ? 'Generatingâ€¦' : 'Generate Form Link'}\n          </Button>\n        </Stack>\n      </Stack>\n      {inviteUrl ? (\n        <Stack direction={{ xs: 'column', md: 'row' }} spacing={1} alignItems=\"center\">\n          <TextField label=\"Intake Link\" value={inviteUrl} fullWidth InputProps={{ readOnly: true }} />\n          <Button variant=\"outlined\" onClick={handleCopy}>{copied ? 'Copied' : 'Copy'}</Button>\n          <Button variant=\"text\" LinkComponent={Link} href={inviteUrl} target=\"_blank\">Open</Button>\n        </Stack>\n      ) : null}\n      <ClientsList />\n    </Stack>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}}]
}