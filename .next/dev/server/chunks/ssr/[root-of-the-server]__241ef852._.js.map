{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/audit.ts"],"sourcesContent":["export type AuditEventType = 'impersonation_start' | 'impersonation_end' | 'navigation' | 'action';\nexport type AuditEvent = {\n  id: string;\n  type: AuditEventType;\n  timestamp: number;\n  actorEmail: string;\n  actorRole: string;\n  targetAgencyEmail?: string;\n  details?: Record<string, any>;\n};\n\nconst STORAGE_KEY = 'audit_log';\n\nfunction readLog(): AuditEvent[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    return JSON.parse(raw) as AuditEvent[];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeLog(events: AuditEvent[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(events));\n}\n\nexport function logEvent(event: Omit<AuditEvent, 'id' | 'timestamp'>) {\n  const ev: AuditEvent = {\n    ...event,\n    id: `${Date.now()}-${Math.random().toString(36).slice(2)}`,\n    timestamp: Date.now(),\n  };\n  const current = readLog();\n  current.push(ev);\n  writeLog(current);\n  return ev.id;\n}\n\nexport function logImpersonationStart(parentEmail: string, agencyEmail: string) {\n  return logEvent({\n    type: 'impersonation_start',\n    actorEmail: parentEmail,\n    actorRole: 'parent',\n    targetAgencyEmail: agencyEmail,\n  });\n}\n\nexport function logImpersonationEnd(parentEmail: string, agencyEmail: string) {\n  return logEvent({\n    type: 'impersonation_end',\n    actorEmail: parentEmail,\n    actorRole: 'parent',\n    targetAgencyEmail: agencyEmail,\n  });\n}\n\nexport function listAuditLog(): AuditEvent[] {\n  return readLog();\n}\n\nexport function clearAuditLog() {\n  writeLog([]);\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;AAWA,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;IAC5C,MAAM;AAOR;AAEA,SAAS,SAAS,MAAoB;IACpC,wCAAmC;;;AAErC;AAEO,SAAS,SAAS,KAA2C;IAClE,MAAM,KAAiB;QACrB,GAAG,KAAK;QACR,IAAI,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI;QAC1D,WAAW,KAAK,GAAG;IACrB;IACA,MAAM,UAAU;IAChB,QAAQ,IAAI,CAAC;IACb,SAAS;IACT,OAAO,GAAG,EAAE;AACd;AAEO,SAAS,sBAAsB,WAAmB,EAAE,WAAmB;IAC5E,OAAO,SAAS;QACd,MAAM;QACN,YAAY;QACZ,WAAW;QACX,mBAAmB;IACrB;AACF;AAEO,SAAS,oBAAoB,WAAmB,EAAE,WAAmB;IAC1E,OAAO,SAAS;QACd,MAAM;QACN,YAAY;QACZ,WAAW;QACX,mBAAmB;IACrB;AACF;AAEO,SAAS;IACd,OAAO;AACT;AAEO,SAAS;IACd,SAAS,EAAE;AACb"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/app-shell.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { Box, CssBaseline, AppBar, Toolbar, Typography, Drawer, List, ListItemButton, ListItemText, Button, Alert } from '@mui/material';\nimport Link from 'next/link';\nimport { useSession } from '@/features/auth/session';\nimport { logImpersonationEnd } from '@/services/audit';\nimport { colors } from '@/theme/colors';\nconst drawerWidth = 240;\n\nexport function AppShell({ children }: { children: React.ReactNode }) {\n  const { session, setSession } = useSession();\n\n  const stopImpersonation = React.useCallback(() => {\n    if (typeof window === 'undefined') return;\n    const baseRaw = window.localStorage.getItem('session_impersonation_base');\n    if (session?.impersonatedBy && baseRaw) {\n      const base = JSON.parse(baseRaw);\n      logImpersonationEnd(base.email, session.email);\n      setSession(base);\n      window.localStorage.removeItem('session_impersonation_base');\n    }\n  }, [session, setSession]);\n\n  return (\n    <Box sx={{ display: 'flex' }}>\n      <CssBaseline />\n      <AppBar\n        position=\"fixed\"\n        sx={{\n          zIndex: (t) => t.zIndex.drawer + 1,\n          bgcolor: (t) => (session?.impersonatedBy ? t.palette.error.main : undefined),\n          color: (t) => (session?.impersonatedBy ? t.palette.error.contrastText : undefined),\n        }}\n      >\n        <Toolbar>\n          <Typography variant=\"h6\" noWrap sx={{ flex: 1 }}>AthleteNarrative Back Office</Typography>\n          {session?.impersonatedBy && (\n            <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\n              <Typography variant=\"body2\">\n                Impersonating {session.email} as {session.impersonatedBy.email}\n              </Typography>\n              <Button color=\"inherit\" variant=\"outlined\" onClick={stopImpersonation}>Stop Impersonating</Button>\n            </Box>\n          )}\n        </Toolbar>\n      </AppBar>\n      <Drawer\n        variant=\"permanent\"\n        sx={{\n          width: drawerWidth,\n          '& .MuiDrawer-paper': {\n            width: drawerWidth,\n            boxSizing: 'border-box',\n            bgcolor: colors.sidebarBg,\n            color: colors.sidebarText,\n          },\n        }}\n      >\n        <Toolbar />\n        <List>\n          <ListItemButton\n            LinkComponent={Link}\n            href=\"/dashboard\"\n            sx={{\n              color: colors.sidebarText,\n              '&.Mui-selected, &.Mui-selected:hover': {\n                bgcolor: colors.navActiveBg,\n                color: colors.navActiveText,\n                borderRadius: '5px',\n              },\n            }}\n          >\n            <ListItemText primary=\"Dashboard\" />\n          </ListItemButton>\n          {session?.role === 'parent' && !session?.impersonatedBy && (\n            <ListItemButton\n              LinkComponent={Link}\n              href=\"/agencies\"\n              sx={{\n                color: colors.sidebarText,\n                '&.Mui-selected, &.Mui-selected:hover': {\n                  bgcolor: colors.navActiveBg,\n                  color: colors.navActiveText,\n                  borderRadius: '5px',\n                },\n              }}\n            >\n              <ListItemText primary=\"Agencies\" />\n            </ListItemButton>\n          )}\n          <ListItemButton\n            LinkComponent={Link}\n            href=\"/clients\"\n            sx={{\n              color: colors.sidebarText,\n              '&.Mui-selected, &.Mui-selected:hover': {\n                bgcolor: colors.navActiveBg,\n                color: colors.navActiveText,\n                borderRadius: '5px',\n              },\n            }}\n          >\n            <ListItemText primary=\"Clients\" />\n          </ListItemButton>\n          <ListItemButton\n            LinkComponent={Link}\n            href=\"/ai/prompts\"\n            sx={{\n              color: colors.sidebarText,\n              '&.Mui-selected, &.Mui-selected:hover': {\n                bgcolor: colors.navActiveBg,\n                color: colors.navActiveText,\n                borderRadius: '5px',\n              },\n            }}\n          >\n            <ListItemText primary=\"AI Prompts\" />\n          </ListItemButton>\n          <ListItemButton\n            LinkComponent={Link}\n            href=\"/lists\"\n            sx={{\n              color: colors.sidebarText,\n              '&.Mui-selected, &.Mui-selected:hover': {\n                bgcolor: colors.navActiveBg,\n                color: colors.navActiveText,\n                borderRadius: '5px',\n              },\n            }}\n          >\n            <ListItemText primary=\"Lists\" />\n          </ListItemButton>\n          <ListItemButton\n            LinkComponent={Link}\n            href=\"/recruiter\"\n            sx={{\n              color: colors.sidebarText,\n              '&.Mui-selected, &.Mui-selected:hover': {\n                bgcolor: colors.navActiveBg,\n                color: colors.navActiveText,\n                borderRadius: '5px',\n              },\n            }}\n          >\n            <ListItemText primary=\"Recruiter\" />\n          </ListItemButton>\n        </List>\n      </Drawer>\n      <Box component=\"main\" sx={{ flexGrow: 1, p: 3 }}>\n        <Toolbar />\n        {session?.impersonatedBy && (\n          <Alert severity=\"error\" sx={{ mb: 2 }}>\n            You are impersonating agency account: {session.email}. Actions will be logged.\n          </Alert>\n        )}\n        {children}\n      </Box>\n    </Box>\n  );\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 420, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/%28app%29/guard.tsx"],"sourcesContent":["'use client';\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useSession } from '@/features/auth/session';\n\nexport function AuthGuard({ children }: { children: React.ReactNode }) {\n  const { session, loading } = useSession();\n  const router = useRouter();\n  React.useEffect(() => { if (!loading && !session) router.replace('/auth/login'); }, [loading, session, router]);\n  if (loading) return null;\n  return <>{children}</>;\n}\n\n\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAHA;;;;;AAKO,SAAS,UAAU,EAAE,QAAQ,EAAiC;IACnE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAU;IACvC,MAAM,SAAS,IAAA,+IAAS;IACxB,gNAAK,CAAC,SAAS,CAAC;QAAQ,IAAI,CAAC,WAAW,CAAC,SAAS,OAAO,OAAO,CAAC;IAAgB,GAAG;QAAC;QAAS;QAAS;KAAO;IAC9G,IAAI,SAAS,OAAO;IACpB,qBAAO;kBAAG;;AACZ"}}]
}