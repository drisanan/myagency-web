{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/commitsScraper.ts"],"sourcesContent":["import fetch from 'node-fetch';\n// lightweight cheerio import (installed in dev deps)\nimport * as cheerio from 'cheerio';\n\nexport type ScrapedCommit = {\n  id: string;\n  rank?: number;\n  name: string;\n  position?: string;\n  university?: string;\n  logo?: string;\n  commitDate?: string;\n  classYear?: string;\n  hometown?: string;\n  highSchool?: string;\n};\n\nfunction cleanName(raw: string) {\n  return raw\n    .replace(/video/gi, '')\n    .replace(/scouts? report/gi, '')\n    .replace(/\\|/g, '')\n    .replace(/\\s{2,}/g, ' ')\n    .trim();\n}\n\nfunction parseSchoolFromHref(href?: string) {\n  if (!href) return '';\n  const parts = href.split('/').filter(Boolean);\n  const last = parts[parts.length - 1] || '';\n  return last\n    .replace(/-/g, ' ')\n    .replace(/\\b\\w/g, (m) => m.toUpperCase())\n    .trim();\n}\n\nfunction extractImgParam(src?: string) {\n  if (!src) return '';\n  const idx = src.indexOf('img=');\n  if (idx === -1) return src || '';\n  const val = src.slice(idx + 4);\n  return val ? `https://a.espncdn.com/combiner/i?img=${val}` : src || '';\n}\n\nfunction splitSchoolCell(raw: string) {\n  const parts = raw.split('(');\n  const cityState = parts[0]?.trim();\n  const hs = parts[1]?.replace(')', '').trim();\n  let hometown: string | undefined;\n  let highSchool: string | undefined;\n  if (cityState) hometown = cityState;\n  if (hs) highSchool = hs;\n  return { hometown, highSchool };\n}\n\nasync function scrapeESPNClass(year: string): Promise<ScrapedCommit[]> {\n  const url = `https://www.espn.com/college-sports/football/recruiting/rankings/scnext300boys/_/view/rn300?class=${year}`;\n  const res = await fetch(url);\n  if (!res.ok) throw new Error(`Failed to fetch ESPN ${year}: ${res.status}`);\n  const html = await res.text();\n  const $ = cheerio.load(html);\n  const rows: ScrapedCommit[] = [];\n\n  $('tbody tr').each((_: any, el: any) => {\n    const cols = $(el).find('td');\n    const rank = parseInt($(cols[0]).text().trim(), 10);\n    const nameRaw = $(cols[1]).text().trim();\n    const name = cleanName(nameRaw);\n    const position = $(cols[2]).text().trim();\n\n    // SCHOOL column: committed school + logo\n    const schoolTd = $(cols[cols.length - 1]);\n    const schoolAnchor = schoolTd.find('a').first();\n    const schoolHref = schoolAnchor.attr('href') || '';\n    const universityText = schoolTd.find('.school-name').text().replace(/\\s+/g, ' ').trim();\n    const university = (universityText || parseSchoolFromHref(schoolHref) || '').trim() || undefined;\n\n    const schoolImg = schoolTd.find('img').attr('src') || '';\n    const logo = extractImgParam(schoolImg) || undefined;\n    if (!logo) return; // skip entries without a committed school/logo\n\n    const { hometown, highSchool } = splitSchoolCell($(cols[3]).text().trim());\n    if (name) {\n      rows.push({\n        id: `fb-top-${year}-${rank || rows.length + 1}`,\n        rank: isNaN(rank) ? undefined : rank,\n        name,\n        position,\n        university,\n        logo,\n        classYear: year,\n        hometown,\n        highSchool,\n      });\n    }\n  });\n  return rows;\n}\n\nexport async function scrapeFootballTop(): Promise<ScrapedCommit[]> {\n  const classes = ['2026', '2027'];\n  const all: ScrapedCommit[] = [];\n  for (const yr of classes) {\n    try {\n      const rows = await scrapeESPNClass(yr);\n      all.push(...rows);\n    } catch (e) {\n      // continue\n    }\n  }\n  const sorted = all.sort((a, b) => (a.rank ?? 9999) - (b.rank ?? 9999));\n  return sorted.slice(0, 50);\n}\n\nasync function scrapeESPNBasketballClass(year: string): Promise<ScrapedCommit[]> {\n  const url = `https://www.espn.com/college-sports/basketball/recruiting/rankings/scnext300boys?class=${year}`;\n  const res = await fetch(url);\n  if (!res.ok) throw new Error(`Failed to fetch ESPN basketball ${year}: ${res.status}`);\n  const html = await res.text();\n  const $ = cheerio.load(html);\n  const rows: ScrapedCommit[] = [];\n\n  $('tbody tr').each((_: any, el: any) => {\n    const cols = $(el).find('td');\n    const rank = parseInt($(cols[0]).text().trim(), 10);\n    const nameRaw = $(cols[1]).text().trim();\n    const name = cleanName(nameRaw);\n    const position = $(cols[2]).text().trim();\n    const schoolTd = $(cols[cols.length - 1]);\n    const schoolAnchor = schoolTd.find('a').first();\n    const schoolHref = schoolAnchor.attr('href') || '';\n    const universityText = schoolTd.find('.school-name').text().replace(/\\s+/g, ' ').trim();\n    const university = (universityText || parseSchoolFromHref(schoolHref) || '').trim() || undefined;\n\n    const schoolImg = schoolTd.find('img').attr('src') || '';\n    const logo = extractImgParam(schoolImg) || undefined;\n    if (!logo) return; // skip entries without a committed school/logo\n\n    const { hometown, highSchool } = splitSchoolCell($(cols[3]).text().trim());\n    if (name) {\n      rows.push({\n        id: `bb-top-${year}-${rank || rows.length + 1}`,\n        rank: isNaN(rank) ? undefined : rank,\n        name,\n        position,\n        university,\n        logo,\n        classYear: year,\n        hometown,\n        highSchool,\n      });\n    }\n  });\n  return rows;\n}\n\nexport async function scrapeBasketballTop(): Promise<ScrapedCommit[]> {\n  const classes = ['2026', '2027'];\n  const all: ScrapedCommit[] = [];\n  for (const yr of classes) {\n    try {\n      const rows = await scrapeESPNBasketballClass(yr);\n      all.push(...rows);\n    } catch (e) {\n      // continue\n    }\n  }\n  const sorted = all.sort((a, b) => (a.rank ?? 9999) - (b.rank ?? 9999));\n  return sorted.slice(0, 50);\n}\n\n\n"],"names":[],"mappings":"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"}}]
}