{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/metrics/store.ts"],"sourcesContent":["type ByDayCount = { [dateISO: string]: number };\ntype ByDayTidSet = { [dateISO: string]: Set<string> };\n\ntype AgencyMapCount = { [agencyEmail: string]: ByDayCount };\ntype AgencyMapTidSet = { [agencyEmail: string]: ByDayTidSet };\n\nconst sends: AgencyMapCount = {};\nconst opens: AgencyMapTidSet = {};\nconst clicks: AgencyMapTidSet = {};\n\nexport function todayISO(d = new Date()) {\n  return d.toISOString().slice(0, 10);\n}\n\nfunction ensureCount(map: AgencyMapCount, agency: string, day: string) {\n  if (!map[agency]) map[agency] = {};\n  if (!map[agency][day]) map[agency][day] = 0;\n}\nfunction ensureSet(map: AgencyMapTidSet, agency: string, day: string) {\n  if (!map[agency]) map[agency] = {};\n  if (!map[agency][day]) map[agency][day] = new Set<string>();\n}\n\nexport function recordSend(agencyEmail: string, day: string, count: number) {\n  if (!agencyEmail || !day || !Number.isFinite(count)) return;\n  ensureCount(sends, agencyEmail, day);\n  sends[agencyEmail][day] += Math.max(0, count);\n}\nexport function recordOpen(agencyEmail: string, day: string, tid: string) {\n  if (!agencyEmail || !day || !tid) return;\n  ensureSet(opens, agencyEmail, day);\n  opens[agencyEmail][day].add(tid);\n}\nexport function recordClick(agencyEmail: string, day: string, tid: string) {\n  if (!agencyEmail || !day || !tid) return;\n  ensureSet(clicks, agencyEmail, day);\n  clicks[agencyEmail][day].add(tid);\n}\n\nexport function getStats(agencyEmail: string, days: number) {\n  const out: Array<{ date: string; sends: number; opens: number; clicks: number }> = [];\n  const base = new Date();\n  let totalSends = 0;\n  let totalOpens = 0;\n  for (let i = days - 1; i >= 0; i--) {\n    const d = new Date(base);\n    d.setDate(base.getDate() - i);\n    const k = todayISO(d);\n    const s = sends[agencyEmail]?.[k] || 0;\n    const o = opens[agencyEmail]?.[k]?.size || 0;\n    const c = clicks[agencyEmail]?.[k]?.size || 0;\n    totalSends += s;\n    totalOpens += o;\n    out.push({ date: k, sends: s, opens: o, clicks: c });\n  }\n  const openRate = totalSends > 0 ? totalOpens / totalSends : 0;\n  return { days: out, totals: { sends: totalSends, opens: totalOpens }, openRate };\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;AAMA,MAAM,QAAwB,CAAC;AAC/B,MAAM,QAAyB,CAAC;AAChC,MAAM,SAA0B,CAAC;AAE1B,SAAS,SAAS,IAAI,IAAI,MAAM;IACrC,OAAO,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG;AAClC;AAEA,SAAS,YAAY,GAAmB,EAAE,MAAc,EAAE,GAAW;IACnE,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,OAAO,GAAG,CAAC;IACjC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG;AAC5C;AACA,SAAS,UAAU,GAAoB,EAAE,MAAc,EAAE,GAAW;IAClE,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,OAAO,GAAG,CAAC;IACjC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI;AAChD;AAEO,SAAS,WAAW,WAAmB,EAAE,GAAW,EAAE,KAAa;IACxE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,OAAO,QAAQ,CAAC,QAAQ;IACrD,YAAY,OAAO,aAAa;IAChC,KAAK,CAAC,YAAY,CAAC,IAAI,IAAI,KAAK,GAAG,CAAC,GAAG;AACzC;AACO,SAAS,WAAW,WAAmB,EAAE,GAAW,EAAE,GAAW;IACtE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK;IAClC,UAAU,OAAO,aAAa;IAC9B,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC;AAC9B;AACO,SAAS,YAAY,WAAmB,EAAE,GAAW,EAAE,GAAW;IACvE,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK;IAClC,UAAU,QAAQ,aAAa;IAC/B,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC;AAC/B;AAEO,SAAS,SAAS,WAAmB,EAAE,IAAY;IACxD,MAAM,MAA6E,EAAE;IACrF,MAAM,OAAO,IAAI;IACjB,IAAI,aAAa;IACjB,IAAI,aAAa;IACjB,IAAK,IAAI,IAAI,OAAO,GAAG,KAAK,GAAG,IAAK;QAClC,MAAM,IAAI,IAAI,KAAK;QACnB,EAAE,OAAO,CAAC,KAAK,OAAO,KAAK;QAC3B,MAAM,IAAI,SAAS;QACnB,MAAM,IAAI,KAAK,CAAC,YAAY,EAAE,CAAC,EAAE,IAAI;QACrC,MAAM,IAAI,KAAK,CAAC,YAAY,EAAE,CAAC,EAAE,EAAE,QAAQ;QAC3C,MAAM,IAAI,MAAM,CAAC,YAAY,EAAE,CAAC,EAAE,EAAE,QAAQ;QAC5C,cAAc;QACd,cAAc;QACd,IAAI,IAAI,CAAC;YAAE,MAAM;YAAG,OAAO;YAAG,OAAO;YAAG,QAAQ;QAAE;IACpD;IACA,MAAM,WAAW,aAAa,IAAI,aAAa,aAAa;IAC5D,OAAO;QAAE,MAAM;QAAK,QAAQ;YAAE,OAAO;YAAY,OAAO;QAAW;QAAG;IAAS;AACjF"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/metrics/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getStats } from '../store';\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const agencyEmail = (searchParams.get('agencyEmail') || '').trim();\n  const days = Math.max(1, Math.min(60, Number(searchParams.get('days') || 14)));\n  if (!agencyEmail) return NextResponse.json({ ok: false, error: 'Missing agencyEmail' }, { status: 400 });\n  const stats = getStats(agencyEmail, days);\n  return NextResponse.json({ ok: true, ...stats });\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,cAAc,CAAC,aAAa,GAAG,CAAC,kBAAkB,EAAE,EAAE,IAAI;IAChE,MAAM,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,OAAO,aAAa,GAAG,CAAC,WAAW;IACzE,IAAI,CAAC,aAAa,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAO,OAAO;IAAsB,GAAG;QAAE,QAAQ;IAAI;IACtG,MAAM,QAAQ,IAAA,4IAAQ,EAAC,aAAa;IACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,GAAG,KAAK;IAAC;AAChD"}}]
}