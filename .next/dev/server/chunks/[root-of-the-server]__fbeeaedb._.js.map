{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/on3Scraper.ts"],"sourcesContent":["import fetch from 'node-fetch';\n\nexport type On3Recruit = {\n  id: string;\n  name: string;\n  position?: string;\n  classYear?: string;\n  hometown?: string;\n  highSchool?: string;\n  rating?: string;\n  ranking?: string;\n  committedTo?: string;\n};\n\n// Multiple slugs per sport to improve hit rate; first non-empty wins\nconst SPORT_SLUGS: Record<string, string[]> = {\n  'Womens Basketball': ['womens-basketball', 'wbk', 'wbb'],\n  'Mens Soccer': ['mens-soccer', 'soccer', 'msoc'],\n  'Womens Soccer': ['womens-soccer', 'wsoc'],\n  Softball: ['softball', 'sb'],\n  Volleyball: ['volleyball', 'vb'],\n  Lacrosse: ['lacrosse', 'mens-lacrosse', 'ml'],\n};\n\nfunction normalizeText(v?: string) {\n  return (v || '').replace(/\\s+/g, ' ').trim();\n}\n\nfunction extractNextData(html: string) {\n  const match = html.match(/<script id=\"__NEXT_DATA__\" type=\"application\\/json\">([^<]+)<\\/script>/);\n  if (!match) return null;\n  try {\n    return JSON.parse(match[1]);\n  } catch {\n    return null;\n  }\n}\n\nfunction parseFromNextData(obj: any, sportSlug: string): On3Recruit[] {\n  const resultsArr = findResultsArray(obj);\n  if (!resultsArr) return [];\n  return resultsArr\n    .slice(0, 20)\n    .map((r: any, idx: number) => ({\n      id: `on3-${sportSlug}-${idx}-${(r?.name || '').toLowerCase().replace(/\\s+/g, '-')}`,\n      name: asText(r?.name),\n      position: asText(r?.position),\n      classYear: r?.classYear ? String(r.classYear) : '',\n      hometown: asText(r?.hometown),\n      highSchool: asText(r?.highSchool),\n      rating: asText(r?.rating),\n      ranking: asText(r?.ranking),\n      committedTo: asText(r?.commit || r?.committedTo),\n    }))\n    .filter((r: On3Recruit) => normalizeText(r.name));\n}\n\nfunction findResultsArray(obj: any): any[] | null {\n  if (!obj) return null;\n  if (Array.isArray(obj)) {\n    if (obj.length && typeof obj[0] === 'object' && obj[0] && ('name' in obj[0])) return obj;\n  }\n  if (typeof obj === 'object') {\n    for (const key of Object.keys(obj)) {\n      const found = findResultsArray(obj[key]);\n      if (found) return found;\n    }\n  }\n  return null;\n}\n\nfunction asText(v: any): string {\n  if (v == null) return '';\n  if (Array.isArray(v)) {\n    const parts = v.map((item) => asText(item)).filter(Boolean);\n    return normalizeText(parts.join(' / '));\n  }\n  if (typeof v === 'string') return v;\n  if (typeof v === 'number') return String(v);\n  if (typeof v === 'object') {\n    if ('name' in v) return normalizeText((v as any).name);\n    if ('abbreviation' in v) return normalizeText((v as any).abbreviation);\n  }\n  return normalizeText(String(v));\n}\n\nexport async function scrapeOn3Top20(sport: string): Promise<On3Recruit[]> {\n  const slugCandidates = SPORT_SLUGS[sport] || [sport.toLowerCase()];\n  for (const sportSlug of slugCandidates) {\n    const url = `https://www.on3.com/rivals/search/?sport=${encodeURIComponent(sportSlug)}&num=20&page=1`;\n    const res = await fetch(url);\n    if (!res.ok) continue;\n    const html = await res.text();\n    const json = extractNextData(html);\n    if (!json) continue;\n    const rows = parseFromNextData(json, sportSlug);\n    if (rows.length) return rows.slice(0, 20);\n  }\n  return [];\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/recruits/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { scrapeOn3Top20 } from '@/services/on3Scraper';\n\nconst cache = new Map<string, { ts: number; data: any }>();\nconst TTL_MS = 5 * 60 * 1000;\n\nexport async function GET(req: Request) {\n  const { searchParams } = new URL(req.url);\n  const sport = searchParams.get('sport') || 'Football';\n  const now = Date.now();\n  const cached = cache.get(sport);\n  if (cached && now - cached.ts < TTL_MS) {\n    return NextResponse.json({ ok: true, data: cached.data, cached: true });\n  }\n  try {\n    const data = await scrapeOn3Top20(sport);\n    cache.set(sport, { ts: now, data });\n    return NextResponse.json({ ok: true, data });\n  } catch (e: any) {\n    return NextResponse.json({ ok: false, error: e?.message || 'scrape failed' }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,QAAQ,IAAI;AAClB,MAAM,SAAS,IAAI,KAAK;AAEjB,eAAe,IAAI,GAAY;IACpC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY;IAC3C,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,SAAS,MAAM,GAAG,CAAC;IACzB,IAAI,UAAU,MAAM,OAAO,EAAE,GAAG,QAAQ;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM,MAAM,OAAO,IAAI;YAAE,QAAQ;QAAK;IACvE;IACA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,0IAAc,EAAC;QAClC,MAAM,GAAG,CAAC,OAAO;YAAE,IAAI;YAAK;QAAK;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;QAAK;IAC5C,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAgB,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF"}}]
}