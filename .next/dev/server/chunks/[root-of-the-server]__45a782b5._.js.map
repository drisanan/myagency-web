{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/services/tasks.ts"],"sourcesContent":["export type TaskStatus = 'todo' | 'in-progress' | 'done';\n\nexport type Task = {\n  id: string;\n  agencyEmail: string;\n  athleteId?: string | null;\n  title: string;\n  description?: string;\n  status: TaskStatus;\n  dueAt?: number; // ms epoch\n  createdAt: number;\n  updatedAt: number;\n};\n\nconst STORAGE_KEY = 'tasks_data';\n\nfunction readStore(): Task[] {\n  if (typeof window === 'undefined') return [];\n  const raw = window.localStorage.getItem(STORAGE_KEY);\n  if (!raw) return [];\n  try {\n    const parsed = JSON.parse(raw) as Task[];\n    return Array.isArray(parsed) ? parsed : [];\n  } catch {\n    return [];\n  }\n}\n\nfunction writeStore(items: Task[]) {\n  if (typeof window === 'undefined') return;\n  window.localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n}\n\nlet TASKS: Task[] = readStore();\n\nexport function listTasks(input: { agencyEmail: string; athleteId?: string | null; status?: TaskStatus }) {\n  const { agencyEmail, athleteId, status } = input;\n  if (typeof window !== 'undefined') TASKS = readStore();\n  return TASKS.filter((t) => {\n    if (t.agencyEmail !== agencyEmail) return false;\n    if (athleteId && t.athleteId !== athleteId) return false;\n    if (status && t.status !== status) return false;\n    return true;\n  });\n}\n\nexport function createTask(input: {\n  agencyEmail: string;\n  athleteId?: string | null;\n  title: string;\n  description?: string;\n  status?: TaskStatus;\n  dueAt?: number;\n}) {\n  const now = Date.now();\n  const task: Task = {\n    id: `task-${now}-${Math.random().toString(36).slice(2, 8)}`,\n    agencyEmail: input.agencyEmail,\n    athleteId: input.athleteId || null,\n    title: input.title,\n    description: input.description,\n    status: input.status ?? 'todo',\n    dueAt: input.dueAt,\n    createdAt: now,\n    updatedAt: now,\n  };\n  TASKS.unshift(task);\n  writeStore(TASKS);\n  return task;\n}\n\nexport function updateTask(id: string, patch: Partial<Omit<Task, 'id' | 'agencyEmail' | 'createdAt'>>) {\n  const idx = TASKS.findIndex((t) => t.id === id);\n  if (idx < 0) return null;\n  const next: Task = { ...TASKS[idx], ...patch, updatedAt: Date.now() };\n  TASKS[idx] = next;\n  writeStore(TASKS);\n  return next;\n}\n\nexport function deleteTask(id: string) {\n  const idx = TASKS.findIndex((t) => t.id === id);\n  if (idx >= 0) {\n    TASKS.splice(idx, 1);\n    writeStore(TASKS);\n  }\n}\n\nexport function tasksDueSoon(tasks: Task[], withinMs = 24 * 60 * 60 * 1000) {\n  const now = Date.now();\n  return tasks.filter((t) => t.dueAt && t.status !== 'done' && t.dueAt - now <= withinMs && t.dueAt >= now);\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;AAcA,MAAM,cAAc;AAEpB,SAAS;IACP,wCAAmC,OAAO,EAAE;;;IAC5C,MAAM;AAQR;AAEA,SAAS,WAAW,KAAa;IAC/B,wCAAmC;;;AAErC;AAEA,IAAI,QAAgB;AAEb,SAAS,UAAU,KAA8E;IACtG,MAAM,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG;IAC3C;;IACA,OAAO,MAAM,MAAM,CAAC,CAAC;QACnB,IAAI,EAAE,WAAW,KAAK,aAAa,OAAO;QAC1C,IAAI,aAAa,EAAE,SAAS,KAAK,WAAW,OAAO;QACnD,IAAI,UAAU,EAAE,MAAM,KAAK,QAAQ,OAAO;QAC1C,OAAO;IACT;AACF;AAEO,SAAS,WAAW,KAO1B;IACC,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,OAAa;QACjB,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;QAC3D,aAAa,MAAM,WAAW;QAC9B,WAAW,MAAM,SAAS,IAAI;QAC9B,OAAO,MAAM,KAAK;QAClB,aAAa,MAAM,WAAW;QAC9B,QAAQ,MAAM,MAAM,IAAI;QACxB,OAAO,MAAM,KAAK;QAClB,WAAW;QACX,WAAW;IACb;IACA,MAAM,OAAO,CAAC;IACd,WAAW;IACX,OAAO;AACT;AAEO,SAAS,WAAW,EAAU,EAAE,KAA8D;IACnG,MAAM,MAAM,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAC5C,IAAI,MAAM,GAAG,OAAO;IACpB,MAAM,OAAa;QAAE,GAAG,KAAK,CAAC,IAAI;QAAE,GAAG,KAAK;QAAE,WAAW,KAAK,GAAG;IAAG;IACpE,KAAK,CAAC,IAAI,GAAG;IACb,WAAW;IACX,OAAO;AACT;AAEO,SAAS,WAAW,EAAU;IACnC,MAAM,MAAM,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAC5C,IAAI,OAAO,GAAG;QACZ,MAAM,MAAM,CAAC,KAAK;QAClB,WAAW;IACb;AACF;AAEO,SAAS,aAAa,KAAa,EAAE,WAAW,KAAK,KAAK,KAAK,IAAI;IACxE,MAAM,MAAM,KAAK,GAAG;IACpB,OAAO,MAAM,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,IAAI,EAAE,MAAM,KAAK,UAAU,EAAE,KAAK,GAAG,OAAO,YAAY,EAAE,KAAK,IAAI;AACvG"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/tasks/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createTask, deleteTask, listTasks, updateTask } from '@/services/tasks';\n\nfunction getAgencyEmail(req: NextRequest, bodyAgency?: string) {\n  return req.headers.get('x-agency-email') || bodyAgency || '';\n}\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const agencyEmail = getAgencyEmail(req, searchParams.get('agencyEmail') || undefined);\n  if (!agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'agencyEmail is required' }, { status: 400 });\n  }\n  const athleteId = searchParams.get('athleteId') || undefined;\n  const status = (searchParams.get('status') || undefined) as any;\n  const data = listTasks({ agencyEmail, athleteId, status });\n  return NextResponse.json({ ok: true, data });\n}\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json();\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  const { title, description, status, dueAt, athleteId } = body || {};\n  if (!agencyEmail || !title?.trim()) {\n    return NextResponse.json({ ok: false, error: 'agencyEmail and title are required' }, { status: 400 });\n  }\n  const created = createTask({\n    agencyEmail,\n    title: title.trim(),\n    description: description?.trim(),\n    status,\n    dueAt: Number.isFinite(dueAt) ? Number(dueAt) : undefined,\n    athleteId: athleteId || null,\n  });\n  return NextResponse.json({ ok: true, data: created });\n}\n\nexport async function PATCH(req: NextRequest) {\n  const body = await req.json();\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  const { id, ...patch } = body || {};\n  if (!id || !agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'id and agencyEmail are required' }, { status: 400 });\n  }\n  const updated = updateTask(id, patch);\n  if (!updated) return NextResponse.json({ ok: false, error: 'Task not found' }, { status: 404 });\n  return NextResponse.json({ ok: true, data: updated });\n}\n\nexport async function DELETE(req: NextRequest) {\n  const body = await req.json().catch(() => ({}));\n  const id = body?.id;\n  const agencyEmail = getAgencyEmail(req, body?.agencyEmail);\n  if (!id || !agencyEmail) {\n    return NextResponse.json({ ok: false, error: 'id and agencyEmail are required' }, { status: 400 });\n  }\n  deleteTask(id);\n  return NextResponse.json({ ok: true });\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,SAAS,eAAe,GAAgB,EAAE,UAAmB;IAC3D,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,qBAAqB,cAAc;AAC5D;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,cAAc,eAAe,KAAK,aAAa,GAAG,CAAC,kBAAkB;IAC3E,IAAI,CAAC,aAAa;QAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC1F;IACA,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB;IACnD,MAAM,SAAU,aAAa,GAAG,CAAC,aAAa;IAC9C,MAAM,OAAO,IAAA,gIAAS,EAAC;QAAE;QAAa;QAAW;IAAO;IACxD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM;IAAK;AAC5C;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,QAAQ,CAAC;IAClE,IAAI,CAAC,eAAe,CAAC,OAAO,QAAQ;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAqC,GAAG;YAAE,QAAQ;QAAI;IACrG;IACA,MAAM,UAAU,IAAA,iIAAU,EAAC;QACzB;QACA,OAAO,MAAM,IAAI;QACjB,aAAa,aAAa;QAC1B;QACA,OAAO,OAAO,QAAQ,CAAC,SAAS,OAAO,SAAS;QAChD,WAAW,aAAa;IAC1B;IACA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,MAAM;IAAQ;AACrD;AAEO,eAAe,MAAM,GAAgB;IAC1C,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,MAAM,EAAE,EAAE,EAAE,GAAG,OAAO,GAAG,QAAQ,CAAC;IAClC,IAAI,CAAC,MAAM,CAAC,aAAa;QACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IAClG;IACA,MAAM,UAAU,IAAA,iIAAU,EAAC,IAAI;IAC/B,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAO,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;IAC7F,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,MAAM;IAAQ;AACrD;AAEO,eAAe,OAAO,GAAgB;IAC3C,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,MAAM,KAAK,MAAM;IACjB,MAAM,cAAc,eAAe,KAAK,MAAM;IAC9C,IAAI,CAAC,MAAM,CAAC,aAAa;QACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IAClG;IACA,IAAA,iIAAU,EAAC;IACX,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACtC"}}]
}