{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/token.ts"],"sourcesContent":["import crypto from 'crypto';\n\nconst ALG = 'sha256';\nconst SECRET = process.env.FORMS_SECRET || 'dev-forms-secret-change-me';\n\nexport function sign(payload: object): string {\n  const header = { alg: 'HS256', typ: 'JWT' };\n  const enc = (o: any) => Buffer.from(JSON.stringify(o)).toString('base64url');\n  const head = enc(header);\n  const body = enc(payload);\n  const hmac = crypto.createHmac(ALG, SECRET).update(`${head}.${body}`).digest('base64url');\n  return `${head}.${body}.${hmac}`;\n}\n\nexport function verify<T = any>(token: string): T | null {\n  const parts = token.split('.');\n  if (parts.length !== 3) return null;\n  const [head, body, sig] = parts;\n  const hmac = crypto.createHmac(ALG, SECRET).update(`${head}.${body}`).digest('base64url');\n  if (hmac !== sig) return null;\n  try {\n    const json = JSON.parse(Buffer.from(body, 'base64url').toString('utf-8'));\n    if (json.exp && Date.now() > Number(json.exp)) return null;\n    return json as T;\n  } catch {\n    return null;\n  }\n}\n\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM;AACZ,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY,IAAI;AAEpC,SAAS,KAAK,OAAe;IAClC,MAAM,SAAS;QAAE,KAAK;QAAS,KAAK;IAAM;IAC1C,MAAM,MAAM,CAAC,IAAW,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC,IAAI,QAAQ,CAAC;IAChE,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,KAAK,QAAQ,MAAM,CAAC,GAAG,KAAK,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7E,OAAO,GAAG,KAAK,CAAC,EAAE,KAAK,CAAC,EAAE,MAAM;AAClC;AAEO,SAAS,OAAgB,KAAa;IAC3C,MAAM,QAAQ,MAAM,KAAK,CAAC;IAC1B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAC/B,MAAM,CAAC,MAAM,MAAM,IAAI,GAAG;IAC1B,MAAM,OAAO,gHAAM,CAAC,UAAU,CAAC,KAAK,QAAQ,MAAM,CAAC,GAAG,KAAK,CAAC,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7E,IAAI,SAAS,KAAK,OAAO;IACzB,IAAI;QACF,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,MAAM,aAAa,QAAQ,CAAC;QAChE,IAAI,KAAK,GAAG,IAAI,KAAK,GAAG,KAAK,OAAO,KAAK,GAAG,GAAG,OAAO;QACtD,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/forms/issue/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { sign } from '../../forms/token';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { agencyEmail } = (await req.json()) as { agencyEmail: string };\n    if (!agencyEmail) return NextResponse.json({ ok: false, error: 'Missing agencyEmail' }, { status: 400 });\n    const payload = {\n      agencyEmail,\n      iat: Date.now(),\n      exp: Date.now() + 1000 * 60 * 60 * 24 * 30,\n    };\n    const token = sign(payload);\n    const origin = new URL(req.url).origin;\n    const url = `${origin}/forms/${token}`;\n    return NextResponse.json({ ok: true, token, url });\n  } catch (e: any) {\n    return NextResponse.json({ ok: false, error: e?.message || 'Failed to issue form link' }, { status: 500 });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,GAAI,MAAM,IAAI,IAAI;QACvC,IAAI,CAAC,aAAa,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;QACtG,MAAM,UAAU;YACd;YACA,KAAK,KAAK,GAAG;YACb,KAAK,KAAK,GAAG,KAAK,OAAO,KAAK,KAAK,KAAK;QAC1C;QACA,MAAM,QAAQ,IAAA,sIAAI,EAAC;QACnB,MAAM,SAAS,IAAI,IAAI,IAAI,GAAG,EAAE,MAAM;QACtC,MAAM,MAAM,GAAG,OAAO,OAAO,EAAE,OAAO;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAM;YAAO;QAAI;IAClD,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAA4B,GAAG;YAAE,QAAQ;QAAI;IAC1G;AACF"}}]
}