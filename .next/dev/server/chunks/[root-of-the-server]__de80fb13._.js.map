{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/mrjames/Desktop/athletenarrative/web/web-app/app/api/auth/ghl-login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nconst bearerToken =\n  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2NhdGlvbl9pZCI6InNreFdlMVVIV29URXJURHBienFVIiwiY29tcGFueV9pZCI6IlFEQUxhVGNVQWNpNTdVT2hwaUVxIiwidmVyc2lvbiI6MSwiaWF0IjoxNjk0NzEyNDAzMDYzLCJzdWIiOiJ1c2VyX2lkIn0.N_UmYQr-Ls_THm8iYDBBEZI1_RKqZGlOUPI2t0ncfRE';\n\nconst accessCodeFieldId = 't6VuS58tw4n5DEfHTAmp';\n\nexport async function POST(req: Request) {\n  try {\n    const { email, phone, accessCode } = await req.json();\n    if (!email || !phone || !accessCode) {\n      return NextResponse.json({ ok: false, error: 'Missing credentials' }, { status: 400 });\n    }\n    const emailTrim = String(email).trim();\n    const phoneTrim = String(phone).trim();\n    const accessCodeInput = String(accessCode).trim();\n    if (!/^\\+?\\d+$/.test(phoneTrim)) {\n      return NextResponse.json({ ok: false, error: 'Invalid phone' }, { status: 400 });\n    }\n    if (!/^\\d+$/.test(accessCodeInput)) {\n      return NextResponse.json({ ok: false, error: 'Invalid access code format' }, { status: 400 });\n    }\n\n    const encodedEmail = encodeURIComponent(emailTrim);\n    const encodedPhone = encodeURIComponent(phoneTrim);\n    const apiUrl = `https://rest.gohighlevel.com/v1/contacts/lookup?email=${encodedEmail}&phone=${encodedPhone}`;\n\n    const res = await fetch(apiUrl, {\n      headers: {\n        Authorization: `Bearer ${bearerToken}`,\n        'Content-Type': 'application/json',\n      },\n      cache: 'no-store',\n    });\n\n    const data = await res.json();\n    if (!res.ok) {\n      const errMsg = data?.message || 'Lookup failed';\n      return NextResponse.json({ ok: false, error: errMsg }, { status: res.status });\n    }\n    const contact = data?.contacts?.[0];\n    if (!contact) return NextResponse.json({ ok: false, error: 'Contact not found' }, { status: 404 });\n\n    const accessField = (contact.customField || []).find((f: any) => f.id === accessCodeFieldId);\n    const storedAccessCode = accessField?.value;\n    const storedAccessCodeStr = storedAccessCode === undefined || storedAccessCode === null ? '' : String(storedAccessCode).trim();\n    if (!storedAccessCodeStr || storedAccessCodeStr !== accessCodeInput) {\n      return NextResponse.json({ ok: false, error: 'Invalid access code' }, { status: 401 });\n    }\n\n    return NextResponse.json({\n      ok: true,\n      contact: {\n        id: contact.id,\n        email: contact.email,\n        firstName: contact.firstName,\n        lastName: contact.lastName,\n        phone: contact.phone,\n        accessCode: storedAccessCode,\n      },\n    });\n  } catch (e: any) {\n    return NextResponse.json({ ok: false, error: e?.message || 'Server error' }, { status: 500 });\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ;AAEF,MAAM,oBAAoB;AAEnB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;QACnD,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,YAAY;YACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QACtF;QACA,MAAM,YAAY,OAAO,OAAO,IAAI;QACpC,MAAM,YAAY,OAAO,OAAO,IAAI;QACpC,MAAM,kBAAkB,OAAO,YAAY,IAAI;QAC/C,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QACA,IAAI,CAAC,QAAQ,IAAI,CAAC,kBAAkB;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,MAAM,eAAe,mBAAmB;QACxC,MAAM,eAAe,mBAAmB;QACxC,MAAM,SAAS,CAAC,sDAAsD,EAAE,aAAa,OAAO,EAAE,cAAc;QAE5G,MAAM,MAAM,MAAM,MAAM,QAAQ;YAC9B,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,aAAa;gBACtC,gBAAgB;YAClB;YACA,OAAO;QACT;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,SAAS,MAAM,WAAW;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAO,GAAG;gBAAE,QAAQ,IAAI,MAAM;YAAC;QAC9E;QACA,MAAM,UAAU,MAAM,UAAU,CAAC,EAAE;QACnC,IAAI,CAAC,SAAS,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;QAEhG,MAAM,cAAc,CAAC,QAAQ,WAAW,IAAI,EAAE,EAAE,IAAI,CAAC,CAAC,IAAW,EAAE,EAAE,KAAK;QAC1E,MAAM,mBAAmB,aAAa;QACtC,MAAM,sBAAsB,qBAAqB,aAAa,qBAAqB,OAAO,KAAK,OAAO,kBAAkB,IAAI;QAC5H,IAAI,CAAC,uBAAuB,wBAAwB,iBAAiB;YACnE,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,IAAI;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI;YACJ,SAAS;gBACP,IAAI,QAAQ,EAAE;gBACd,OAAO,QAAQ,KAAK;gBACpB,WAAW,QAAQ,SAAS;gBAC5B,UAAU,QAAQ,QAAQ;gBAC1B,OAAO,QAAQ,KAAK;gBACpB,YAAY;YACd;QACF;IACF,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,GAAG,WAAW;QAAe,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}