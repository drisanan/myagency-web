(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65964,e=>{"use strict";var t=e.i(43476),a=e.i(66796),i=e.i(71645),l=e.i(76552),o=e.i(34251),n=e.i(99917),r=e.i(71447),s=e.i(87708),c=e.i(69437),d=e.i(13607),h=e.i(68238),u=e.i(82472),m=e.i(25376),p=e.i(11458),f=e.i(63745);e.i(47167);var g=e.i(7670),x=e.i(19130),y=e.i(40799),b=e.i(75149),v=e.i(94425),$=e.i(12401),j=e.i(67719);let T=i.createContext({});var w=e.i(88088),C=e.i(48106),S=e.i(40672),N=e.i(19727);function k(e){return(0,N.default)("MuiAccordion",e)}let I=(0,S.default)("MuiAccordion",["root","heading","rounded","expanded","disabled","gutters","region"]),P=(0,y.styled)(j.default,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[{[`& .${I.region}`]:t.region},t.root,!a.square&&t.rounded,!a.disableGutters&&t.gutters]}})((0,b.default)(({theme:e})=>{let t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${I.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${I.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}}),(0,b.default)(({theme:e})=>({variants:[{props:e=>!e.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:e=>!e.disableGutters,style:{[`&.${I.expanded}`]:{margin:"16px 0"}}}]}))),M=(0,y.styled)("h3",{name:"MuiAccordion",slot:"Heading"})({all:"unset"}),B=(0,y.styled)("div",{name:"MuiAccordion",slot:"Region"})({}),A=i.forwardRef(function(e,a){let l=(0,v.useDefaultProps)({props:e,name:"MuiAccordion"}),{children:o,className:n,defaultExpanded:r=!1,disabled:s=!1,disableGutters:c=!1,expanded:d,onChange:h,square:u=!1,slots:m={},slotProps:p={},TransitionComponent:f,TransitionProps:y,...b}=l,[j,S]=(0,w.default)({controlled:d,default:r,name:"Accordion",state:"expanded"}),N=i.useCallback(e=>{S(!j),h&&h(e,!j)},[j,h,S]),[I,...A]=i.Children.toArray(o),L=i.useMemo(()=>({expanded:j,disabled:s,disableGutters:c,toggle:N}),[j,s,c,N]),E={...l,square:u,disabled:s,disableGutters:c,expanded:j},R=(e=>{let{classes:t,square:a,expanded:i,disabled:l,disableGutters:o}=e;return(0,x.default)({root:["root",!a&&"rounded",i&&"expanded",l&&"disabled",!o&&"gutters"],heading:["heading"],region:["region"]},k,t)})(E),O={slots:{transition:f,...m},slotProps:{transition:y,...p}},[F,U]=(0,C.default)("root",{elementType:P,externalForwardedProps:{...O,...b},className:(0,g.default)(R.root,n),shouldForwardComponentProp:!0,ownerState:E,ref:a,additionalProps:{square:u}}),[H,V]=(0,C.default)("heading",{elementType:M,externalForwardedProps:O,className:R.heading,ownerState:E}),[G,D]=(0,C.default)("transition",{elementType:$.default,externalForwardedProps:O,ownerState:E}),[_,W]=(0,C.default)("region",{elementType:B,externalForwardedProps:O,ownerState:E,className:R.region,additionalProps:{"aria-labelledby":I.props.id,id:I.props["aria-controls"],role:"region"}});return(0,t.jsxs)(F,{...U,children:[(0,t.jsx)(H,{...V,children:(0,t.jsx)(T.Provider,{value:L,children:I})}),(0,t.jsx)(G,{in:j,timeout:"auto",...D,children:(0,t.jsx)(_,{...W,children:A})})]})});var L=e.i(54033);function E(e){return(0,N.default)("MuiAccordionSummary",e)}let R=(0,S.default)("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),O=(0,y.styled)(L.default,{name:"MuiAccordionSummary",slot:"Root"})((0,b.default)(({theme:e})=>{let t={duration:e.transitions.duration.shortest};return{display:"flex",width:"100%",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${R.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${R.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${R.disabled})`]:{cursor:"pointer"},variants:[{props:e=>!e.disableGutters,style:{[`&.${R.expanded}`]:{minHeight:64}}}]}})),F=(0,y.styled)("span",{name:"MuiAccordionSummary",slot:"Content"})((0,b.default)(({theme:e})=>({display:"flex",textAlign:"start",flexGrow:1,margin:"12px 0",variants:[{props:e=>!e.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${R.expanded}`]:{margin:"20px 0"}}}]}))),U=(0,y.styled)("span",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper"})((0,b.default)(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${R.expanded}`]:{transform:"rotate(180deg)"}}))),H=i.forwardRef(function(e,a){let l=(0,v.useDefaultProps)({props:e,name:"MuiAccordionSummary"}),{children:o,className:n,expandIcon:r,focusVisibleClassName:s,onClick:c,slots:d,slotProps:h,...u}=l,{disabled:m=!1,disableGutters:p,expanded:f,toggle:y}=i.useContext(T),b={...l,expanded:f,disabled:m,disableGutters:p},$=(e=>{let{classes:t,expanded:a,disabled:i,disableGutters:l}=e;return(0,x.default)({root:["root",a&&"expanded",i&&"disabled",!l&&"gutters"],focusVisible:["focusVisible"],content:["content",a&&"expanded",!l&&"contentGutters"],expandIconWrapper:["expandIconWrapper",a&&"expanded"]},E,t)})(b),j={slots:d,slotProps:h},[w,S]=(0,C.default)("root",{ref:a,shouldForwardComponentProp:!0,className:(0,g.default)($.root,n),elementType:O,externalForwardedProps:{...j,...u},ownerState:b,additionalProps:{focusRipple:!1,disableRipple:!0,disabled:m,"aria-expanded":f,focusVisibleClassName:(0,g.default)($.focusVisible,s)},getSlotProps:e=>({...e,onClick:t=>{e.onClick?.(t),y&&y(t),c&&c(t)}})}),[N,k]=(0,C.default)("content",{className:$.content,elementType:F,externalForwardedProps:j,ownerState:b}),[I,P]=(0,C.default)("expandIconWrapper",{className:$.expandIconWrapper,elementType:U,externalForwardedProps:j,ownerState:b});return(0,t.jsxs)(w,{...S,children:[(0,t.jsx)(N,{...k,children:o}),r&&(0,t.jsx)(I,{...P,children:r})]})});function V(e){return(0,N.default)("MuiAccordionDetails",e)}(0,S.default)("MuiAccordionDetails",["root"]);let G=(0,y.styled)("div",{name:"MuiAccordionDetails",slot:"Root"})((0,b.default)(({theme:e})=>({padding:e.spacing(1,2,2)}))),D=i.forwardRef(function(e,a){let i=(0,v.useDefaultProps)({props:e,name:"MuiAccordionDetails"}),{className:l,...o}=i,n=(e=>{let{classes:t}=e;return(0,x.default)({root:["root"]},V,t)})(i);return(0,t.jsx)(G,{className:(0,g.default)(n.root,l),ref:a,ownerState:i,...o})});var _=e.i(33460);let W=(0,e.i(54624).default)((0,t.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var z=e.i(51481),Q=e.i(33906),q=e.i(90349),J=e.i(17158),Y=e.i(57136);let K="email_templates_v1";function X(){try{let e=localStorage.getItem(K);return e?JSON.parse(e):[]}catch{return[]}}function Z(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var ee=e.i(93043),et=e.i(88331);function ea(){let{session:e}=(0,Q.useSession)(),[g,x]=i.default.useState(0),[y,b]=i.default.useState([]),[v,$]=i.default.useState(""),[j,T]=i.default.useState([]),[w,C]=i.default.useState(""),[S,N]=i.default.useState([]),[k,I]=i.default.useState(""),[P,M]=i.default.useState([]),[B,L]=i.default.useState([]),[E,R]=i.default.useState(""),[O,F]=i.default.useState(null),[U,V]=i.default.useState(!1),[G,ea]=i.default.useState(""),[ei,el]=i.default.useState(null),[eo,en]=i.default.useState({}),[er,es]=i.default.useState(""),[ec,ed]=i.default.useState(null),[eh,eu]=i.default.useState({accomplishments:!0,motivation:!0,academic:!0,athletic:!0,highlights:!0,contact:!0,coach:!0,references:!0,profilePicture:!1,radarPage:!0}),[em,ep]=i.default.useState({}),[ef,eg]=i.default.useState([]),[ex,ey]=i.default.useState(""),[eb,ev]=i.default.useState(""),[e$,ej]=i.default.useState(!1),[eT,ew]=i.default.useState(!1),eC=i.default.useRef(null),eS=i.default.useRef(""),eN=i.default.useMemo(()=>y.find(e=>e.id===v)||null,[y,v]),ek=i.default.useMemo(()=>{let e=eN?.radar??{};return{email:eN?.email??"",phone:eN?.phone??"",firstName:eN?.firstName??"",lastName:eN?.lastName??"",school:e.school??"",accomplishments:e.accomplishments??[],motivationalQuotes:e.motivationalQuotes??(e.athleteAdvice?[e.athleteAdvice]:[]),gpa:e.gpa??"",preferredAreaOfStudy:e.preferredAreaOfStudy??"",athleteMetricsTitleOne:e.athleteMetricsTitleOne??"",athleteMetricsValueOne:e.athleteMetricsValueOne??"",athleteMetricsTitleTwo:e.athleteMetricsTitleTwo??"",athleteMetricsValueTwo:e.athleteMetricsValueTwo??"",athleteMetricsTitleThree:e.athleteMetricsTitleThree??"",athleteMetricsValueThree:e.athleteMetricsValueThree??"",athleteMetricsTitleFour:e.athleteMetricsTitleFour??"",athleteMetricsValueFour:e.athleteMetricsValueFour??"",youtubeHighlightUrl:e.youtubeHighlightUrl??"",hudlLink:e.hudlLink??"",instagramProfileUrl:e.instagramProfileUrl??"",newsArticleLinks:e.newsArticleLinks??[],headCoachName:e.headCoachName??"",headCoachEmail:e.headCoachEmail??"",headCoachPhone:e.headCoachPhone??"",referenceOneName:e.referenceOneName??"",referenceOneEmail:e.referenceOneEmail??"",referenceOnePhone:e.referenceOnePhone??"",referenceTwoName:e.referenceTwoName??"",referenceTwoEmail:e.referenceTwoEmail??"",referenceTwoPhone:e.referenceTwoPhone??"",profileImage:e.profileImage??""}},[eN]),eI=i.default.useMemo(()=>{let e=eo||{};return U&&O?(O.items||[]).map((e,t)=>({id:String(e.id||`List::${e.school||""}::${e.email||""}::${e.firstName||""}-${e.lastName||""}::${e.title||""}::${t}`),firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",title:e.title||""})).filter(t=>e[t.id]):(ei?.coaches??[]).filter(t=>e[t.id])},[eo,ei,U,O]),eP=ei?.schoolInfo?.School||ei?.name||"";function eM(e,t){eu(a=>({...a,[e]:t}))}function eB(e,t,a){ep(i=>({...i,[e]:{...i[e]??{},[t]:a}}))}function eA(){let e=eI[0]?.lastName||eI[0]?.LastName||"Coach",t=Object.keys(eh).filter(e=>eh[e]),a="",i=`${ek.firstName||""} ${ek.lastName||""} - ${ek.school||""}`.trim();if(a+=`<p>Hello Coach ${e||""},</p><p>${i}</p>`,t.includes("accomplishments")){let e=(ek.accomplishments||[]).filter(e=>e&&""!==e.trim()&&"undefined"!==e&&"null"!==e);e.length&&(a+=`<p><strong>Accomplishments:</strong></p><ul>${e.map((t,a)=>{let i=e.length>1?`${a+1}. `:"";return`<li>${i}${t.trim()}</li>`}).join("")}</ul>

`)}if(t.includes("motivation")&&ek.motivationalQuotes?.[0]){let e=ek.motivationalQuotes[0];a+=`<p><strong>Why I'm Ready For The Next Level:</strong></p><p>"${e}"</p>

`}if(t.includes("academic")&&(ek.gpa||ek.preferredAreaOfStudy)&&(a+=`<p><strong>Academic Information:</strong></p><ul>${[ek.gpa?`<li>GPA: ${ek.gpa}</li>`:"",ek.preferredAreaOfStudy?`<li>Preferred Area of Study: ${ek.preferredAreaOfStudy}</li>`:""].filter(Boolean).join("")}</ul>
`),t.includes("athletic")){let e=[{title:ek.athleteMetricsTitleOne,value:ek.athleteMetricsValueOne},{title:ek.athleteMetricsTitleTwo,value:ek.athleteMetricsValueTwo},{title:ek.athleteMetricsTitleThree,value:ek.athleteMetricsValueThree},{title:ek.athleteMetricsTitleFour,value:ek.athleteMetricsValueFour}].filter(e=>e.title&&e.value);e.length?a+=`<p><strong>Athletic Metrics:</strong></p><ul>${e.map((t,a)=>{let i=e.length>1?`${a+1}. `:"";return`<li>${i}${t.title}: ${t.value}</li>`}).join("")}</ul>
`:a+=`<p><strong>Athletic Metrics:</strong></p><p>No athletic metrics available.</p>
`}if(t.includes("highlights")){let e=[ek.youtubeHighlightUrl?{type:"YouTube Highlight",url:`https://www.youtube.com/watch?v=${ek.youtubeHighlightUrl}`}:null,ek.hudlLink?{type:"Hudl Profile",url:`https://www.hudl.com/profile/${ek.hudlLink}`}:null,ek.instagramProfileUrl?{type:"Instagram",url:`https://www.instagram.com/${ek.instagramProfileUrl}`}:null,...(ek.newsArticleLinks||[]).map(e=>({type:"Article",url:e}))||[]].filter(Boolean);e.length?a+=`<p><strong>View My Highlights:</strong></p><ul>${e.map((t,a)=>{let i=e.length>1?`${a+1}. `:"";return`<li>${i}<a href="${t.url}" target="_blank">${t.type}</a></li>`}).join("")}</ul>
`:a+=`<p><strong>View My Highlights:</strong></p><p>No highlights available.</p>
`}return t.includes("contact")&&(ek.email||ek.phone)&&(a+=`<p><strong>Contact Info:</strong></p><ul>${[ek.email?`<li>Email: <a href="mailto:${ek.email}">${ek.email}</a></li>`:"",ek.phone?`<li>Phone: <a href="tel:${ek.phone}">${ek.phone}</a></li>`:""].filter(Boolean).join("")}</ul>
`),t.includes("coach")&&(ek.headCoachName||ek.headCoachEmail||ek.headCoachPhone)&&(a+=`<p><strong>Head Coach Info:</strong></p><ul>${[ek.headCoachName?`<li>Name: ${ek.headCoachName}</li>`:"",ek.headCoachEmail?`<li>Email: <a href="mailto:${ek.headCoachEmail}">${ek.headCoachEmail}</a></li>`:"",ek.headCoachPhone?`<li>Phone: <a href="tel:${ek.headCoachPhone}">${ek.headCoachPhone}</a></li>`:""].filter(Boolean).join("")}</ul>
`),t.includes("references")&&(ek.referenceOneName||ek.referenceTwoName)&&(a+=`<p><strong>References:</strong></p><ul>${[ek.referenceOneName?`<li>${ek.referenceOneName}<br>${ek.referenceOnePhone?`Phone: <a href="tel:${ek.referenceOnePhone}">${ek.referenceOnePhone}</a>`:""} <br>${ek.referenceOneEmail?`Email: <a href="mailto:${ek.referenceOneEmail}">${ek.referenceOneEmail}</a>`:""}</li>`:"",ek.referenceTwoName?`<li>${ek.referenceTwoName}<br>${ek.referenceTwoPhone?`Phone: <a href="tel:${ek.referenceTwoPhone}">${ek.referenceTwoPhone}</a>`:""} <br>${ek.referenceTwoEmail?`Email: <a href="mailto:${ek.referenceTwoEmail}">${ek.referenceTwoEmail}</a>`:""}</li>`:""].filter(Boolean).join("")}</ul>
`),t.includes("profilePicture")&&ek.profileImage&&(a+=`<p><img src="${ek.profileImage}" alt="Profile Picture" width="250px" height="250px" style="max-width: 250px; height: auto; display: block;"></p>`),a+=`<p>Thank you for your time!</p><p>${ek.firstName||""} ${ek.lastName||""} - ${ek.school||""}</p>`,t.includes("radarPage")&&ek.email&&(a+=`
Follow My Radar Page: <a href="https://radar.athletenarrative.com/?username=${encodeURIComponent(ek.email)}" target="_blank">HERE</a>`),a}async function eL(){try{if(!eN?.id)return void ed("Select a client first");ej(!0);let e=await fetch(`/api/google/oauth/url?clientId=${encodeURIComponent(eN.id)}`),t=await e.json();if(!t?.url)throw Error("Failed to start Gmail connection flow");let a=window.top?.outerHeight?Math.max(0,(window.top.outerHeight-700)/2):100,i=window.top?.outerWidth?Math.max(0,(window.top.outerWidth-500)/2):100;if(eC.current=window.open(t.url,"an-google-oauth",`toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,height=700,top=${a},left=${i}`),!eC.current)throw Error("Popup blocked. Allow popups and retry.")}catch(e){ej(!1),ed(e?.message||"Failed to start Gmail connection")}}async function eE(){try{let t=eN?.id||eS.current||v||"";if(!t)return void ed("Select a client first");console.info("[gmail-ui:draft:start]",{clientId:t});try{let e=await fetch(`/api/google/status?clientId=${encodeURIComponent(t)}`),a=await e.json();if(console.info("[gmail-ui:status]",{clientId:t,connected:!!a?.connected}),!a?.connected){let e=(0,q.getClientGmailTokens)(t);console.info("[gmail-ui:rehydrate:attempt]",{clientId:t,hasSavedTokens:!!e,hasAccess:!!e?.access_token,hasRefresh:!!e?.refresh_token}),e&&(await fetch("/api/google/tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:t,tokens:e})}),ew(!0),console.info("[gmail-ui:rehydrate:result]",{clientId:t,ok:!0}))}}catch{}let a=eI.map(e=>e.email||e.Email).filter(Boolean);if(!a.length)return void ed("Select at least one coach with an email");let i=`Intro: ${ek.firstName||""} ${ek.lastName||""} → ${eP||""}`.trim(),l=eF||eA(),o=(0,q.getClientGmailTokens)(t),n=await fetch("/api/gmail/create-draft",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clientId:t,to:a,subject:i,html:l,tokens:o||void 0,agencyEmail:e?.email||""})}),r=await n.json();if(!n.ok||!r?.ok)throw Error(r?.error||"Draft creation failed");r.openUrl&&window.open(r.openUrl,"_blank");try{if(eN?.id){let e=eI.map(e=>e.email).filter(Boolean);(0,et.markMailed)(eN.id,e)}}catch{}}catch(e){console.error(e),ed(e?.message||"Failed to create Gmail draft")}}i.default.useEffect(()=>{function e(e){if(e.origin===window.location.origin){if(e.data?.type==="google-oauth-success"){let t=e.data?.clientId||eN?.id||v||"";console.info("[gmail-ui:oauth-success]",{clientId:t}),ej(!1),ew(!!t);try{eC.current?.close()}catch{}t&&(eS.current=t),(async()=>{try{if(!t)return;let e=await fetch(`/api/google/tokens?clientId=${encodeURIComponent(t)}`),a=await e.json();console.info("[gmail-ui:tokens:fetched]",{clientId:t,ok:a?.ok,exists:!!a?.tokens,hasAccess:!!a?.tokens?.access_token,hasRefresh:!!a?.tokens?.refresh_token}),a?.ok&&a?.tokens&&((0,q.setClientGmailTokens)(t,a.tokens),console.info("[gmail-ui:tokens:stored]",{clientId:t}))}catch{}})()}if(e.data?.type==="google-oauth-error"){ej(!1);try{eC.current?.close()}catch{}ed("Gmail connection failed. Please try again.")}}}return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]),i.default.useEffect(()=>{eN?.id&&"undefined"!=typeof fetch?fetch(`/api/google/status?clientId=${encodeURIComponent(eN.id)}`).then(e=>e.json()).then(e=>ew(!!e?.connected)).catch(()=>ew(!1)):ew(!1)},[eN?.id]);let[eR,eO]=i.default.useState(!1),[eF,eU]=i.default.useState(""),[eH,eV]=i.default.useState(!1);async function eG(){try{eO(!0),ed(null);let e=eN?.sport||"",t=eP||"",a=eI[0]?.lastName||eI[0]?.LastName||"Coach",i=`${ek.firstName||""} ${ek.lastName||""}`.trim(),l=[];eh.accomplishments&&ek.accomplishments?.length&&l.push("notable accomplishments"),eh.academic&&(ek.gpa||ek.preferredAreaOfStudy)&&l.push("key academic details"),eh.athletic&&l.push("athletic metrics and performance"),eh.highlights&&l.push("highlight links for review");let o=`This is an introduction email for ${i}. The student-athlete is introducing themselves with ${l.join(", ")||"basic profile details"}. Please use the student's actual name; do not use placeholders.`,n=await (0,z.generateIntro)({sport:e,collegeName:t,coachMessage:o,tone:"A highschool kid who loves sports",qualities:["Passionate","Hardworking","Determined"],additionalInsights:`Student full name: ${i}. Use this exact name; do not output placeholders like [StudentName].`}),r=String(n).replace(/\[StudentName\]/gi,i),s=eA(),c=s.replace(/^<p>Hello Coach[\s\S]*?<\/p>\s*<p>[\s\S]*?<\/p>/,"")||s,d=`<p>Hello Coach ${a},</p><p>${r}</p>${c}`;eU(d)}catch(e){ed(e?.message||"AI generation failed")}finally{eO(!1)}}async function eD(){let e=eI[0]?.lastName||eI[0]?.LastName||"Coach",t=`${ek.firstName||""} ${ek.lastName||""}`.trim(),a=eN?.sport||"",i=eP||"",l=[];eh.accomplishments&&ek.accomplishments?.length&&l.push("notable accomplishments"),eh.academic&&(ek.gpa||ek.preferredAreaOfStudy)&&l.push("academic information"),eh.athletic&&l.push("athletic metrics"),eh.highlights&&l.push("highlights");let o=`This is an introduction email for ${t}. The student-athlete is introducing themselves with ${l.join(", ")||"basic profile details"}. Please use the student's actual name; do not use placeholders.`,n=String(await (0,z.generateIntro)({sport:a,collegeName:i,coachMessage:o,tone:"A highschool kid who loves sports",qualities:["Passionate","Hardworking","Determined"],additionalInsights:`Student full name: ${t}. Use this exact name; do not output placeholders like [StudentName].`})).replace(/\[StudentName\]/gi,t),r=eA(),s=r.replace(/^<[^>]*>Hello\s+Coach[\s\S]*?<\/p>\s*<p>[\s\S]*?<\/p>/i,"")||r;return`<p>Hello Coach ${e},</p><p>${n}</p>${s}`}i.default.useEffect(()=>{e&&"agency"===e.role&&((0,q.listClientsByAgencyEmail)(e.email).then(b),(0,J.getDivisions)().then(T),L((0,ee.listLists)(e.email)))},[e]),i.default.useEffect(()=>{if(!w){N([]),I(""),M([]);return}(0,J.getStates)(w).then(N),I(""),M([])},[w]),i.default.useEffect(()=>{if(w&&k&&v){let e=y.find(e=>e.id===v)||null,t=e?.sport||"";if(!t)return void M([]);let a=Y.DIVISION_API_MAPPING[w]||w;(0,Y.listUniversities)({sport:t,division:a,state:k}).then(M).catch(e=>{M([]),ed(e?.message||"Failed to load universities")})}else M([])},[w,k,v,y]),i.default.useEffect(()=>{if(!G){el(null),en({});return}let e=y.find(e=>e.id===v)||null,t=e?.sport||"";if(!t||!w||!k)return void el(null);let a=Y.DIVISION_API_MAPPING[w]||w;(0,Y.getUniversityDetails)({sport:t,division:a,state:k,school:G}).then(e=>{el(e),en({})}).catch(e=>{el(null),en({}),ed(e?.message||"Failed to load university")})},[G,v,w,k,y]),i.default.useEffect(()=>{ed(null)},[w,k,G,v]),i.default.useEffect(()=>{if(e?.email){var t;eg((t={agencyEmail:e.email,clientId:v},X().filter(e=>e.agencyEmail===t.agencyEmail&&(!t.clientId||e.clientId===t.clientId)).sort((e,t)=>t.createdAt-e.createdAt)))}},[e,v]);let e_=3===g,eW=0===g&&!!v||1===g&&(!!E||!!w&&!!k&&P.length>0)||2===g&&(U?eI.length>0:!!G)||3===g,ez=async()=>{if(e_){try{eV(!0),ed(null);let e=await eD();eU(e),es(e)}catch(e){ed(e?.message||"Failed to generate email")}finally{eV(!1)}return}x(e=>e+1)};function eQ(){let e=ek.firstName||"",t=ek.lastName||"",a=`${e} ${t}`.trim(),i=eP||ei?.schoolInfo?.School||ei?.name||"";return{studentFirstName:e,studentLastName:t,studentFullName:a,universityName:i,primaryCoachLastName:eI[0]?.lastName||eI[0]?.LastName||"",coachList:(eI||[]).map(e=>`${e.firstName||e.FirstName||""} ${e.lastName||e.LastName||""}`.trim()).filter(Boolean).join(", ")}}return(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(s.Stepper,{activeStep:g,alternativeLabel:!0,sx:{mb:3},children:["Select Client","Universities","Details & Coaches","Draft"].map(e=>(0,t.jsx)(n.Step,{children:(0,t.jsx)(r.StepLabel,{children:e})},e))}),(0,t.jsxs)(l.Box,{sx:{mb:2},children:[ec&&(0,t.jsx)(a.Typography,{color:"error",sx:{mb:2},children:ec}),0===g&&(0,t.jsx)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2,maxWidth:700},children:(0,t.jsx)(c.TextField,{select:!0,label:"Client",value:v,onChange:e=>$(e.target.value),SelectProps:{MenuProps:{disablePortal:!0}},inputProps:{"data-testid":"recruiter-client-select"},children:y.map(e=>(0,t.jsxs)(p.MenuItem,{value:e.id,children:[e.email," ",e.firstName?`- ${e.firstName} ${e.lastName}`:""]},e.id))})}),1===g&&(0,t.jsxs)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2,maxWidth:800},children:[(0,t.jsx)(c.TextField,{select:!0,label:"Division",value:w,onChange:e=>C(e.target.value),SelectProps:{MenuProps:{disablePortal:!0}},inputProps:{"data-testid":"recruiter-division"},children:j.map(e=>(0,t.jsx)(p.MenuItem,{value:e,children:e},e))}),(0,t.jsx)(c.TextField,{select:!0,label:"State",value:k,onChange:e=>I(e.target.value),disabled:!w,SelectProps:{MenuProps:{disablePortal:!0}},inputProps:{"data-testid":"recruiter-state"},children:S.map(e=>(0,t.jsx)(p.MenuItem,{value:e.code,children:e.name},e.code))}),(0,t.jsxs)(c.TextField,{select:!0,label:"List",value:E,onChange:e=>{let t=String(e.target.value);R(t);let a=B.find(e=>e.id===t)||null;if(F(a),a){V(!0);let e={};(a.items||[]).forEach((t,a)=>{e[String(t.id||`List::${t.school||""}::${t.email||""}::${t.firstName||""}-${t.lastName||""}::${t.title||""}::${a}`)]=!0}),en(e),ea(""),el(null),x(2)}else V(!1),en({})},SelectProps:{MenuProps:{disablePortal:!0}},children:[(0,t.jsx)(p.MenuItem,{value:"",children:"(Select a list)"}),B.map(e=>(0,t.jsx)(p.MenuItem,{value:e.id,children:e.name},e.id))]}),(0,t.jsxs)(l.Box,{sx:{gridColumn:"1 / -1"},children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Universities"}),(0,t.jsx)(f.Stack,{direction:"row",spacing:2,sx:{flexWrap:"wrap"},children:P.map(e=>(0,t.jsx)(d.Card,{onClick:()=>ea(e.name),sx:{width:260,cursor:"pointer",outline:G===e.name?"2px solid #1976d2":"none"},children:(0,t.jsx)(h.CardContent,{children:(0,t.jsx)(a.Typography,{children:e.name})})},e.name))})]})]}),2===g&&U&&O&&(0,t.jsxs)(l.Box,{sx:{maxWidth:1e3},children:[(0,t.jsx)(a.Typography,{variant:"h6",gutterBottom:!0,children:O.name}),(0,t.jsxs)(f.Stack,{direction:"row",spacing:1,sx:{mb:1},children:[(0,t.jsx)(o.Button,{size:"small",variant:"outlined",onClick:()=>{let e={};(O.items||[]).forEach((t,a)=>{e[String(t.id||`List::${t.school||""}::${t.email||""}::${t.firstName||""}-${t.lastName||""}::${t.title||""}::${a}`)]=!0}),en(e)},children:"Select All"}),(0,t.jsx)(o.Button,{size:"small",onClick:()=>en({}),children:"Deselect All"})]}),(0,t.jsx)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:1},children:(O.items||[]).map((e,a)=>{let i=String(e.id||`List::${e.school||""}::${e.email||""}::${e.firstName||""}-${e.lastName||""}::${e.title||""}::${a}`),l=!!eN?.id&&!!e.email&&(0,et.hasMailed)(eN.id,e.email),o=`${e.firstName||""} ${e.lastName||""}`.trim()||e.email||"";return(0,t.jsx)(m.FormControlLabel,{control:(0,t.jsx)(u.Checkbox,{checked:!!eo[i],onChange:()=>en(e=>({...e,[i]:!e[i]}))}),label:`${o}${e.title?` — ${e.title}`:""}${e.email?` (${e.email})`:""}${l?" — Mailed":""}`},i)})})]}),2===g&&!U&&ei&&(0,t.jsxs)(l.Box,{sx:{maxWidth:1e3},children:[(0,t.jsx)(a.Typography,{variant:"h6",gutterBottom:!0,children:ei?.schoolInfo?.School||ei?.name||"—"}),(0,t.jsxs)(l.Box,{sx:{mb:2},children:[(0,t.jsxs)(a.Typography,{variant:"body2",color:"text.secondary",children:["Location: ",ei?.schoolInfo?.City||"—",", ",ei?.schoolInfo?.State||"—"]}),(0,t.jsxs)(a.Typography,{variant:"body2",color:"text.secondary",children:["Division: ",ei?.division||"—"]}),(0,t.jsxs)(a.Typography,{variant:"body2",color:"text.secondary",children:["Conference: ",ei?.schoolInfo?.Conference||ei?.conference||"—"]}),(0,t.jsxs)(a.Typography,{variant:"body2",color:"text.secondary",children:["Type: ",ei?.schoolInfo?.PrivatePublic||ei?.privatePublic||"—"]})]}),(0,t.jsxs)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(4, 1fr)"},gap:2,mb:2},children:[(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"GPA"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.AverageGPA||"—"})]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"SAT Math"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.SATMath||"—"})]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"SAT Reading"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.SATReading||"—"})]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"ACT"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.ACTComposite||"—"})]})]}),(0,t.jsxs)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:2,mb:2},children:[(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"Acceptance Rate"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.AcceptanceRate||"—"})]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"Yearly Cost"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.YearlyCost||"—"})]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"subtitle2",color:"text.secondary",children:"US News Ranking"}),(0,t.jsx)(a.Typography,{children:ei?.schoolInfo?.USNewsRanking?`#${ei.schoolInfo.USNewsRanking}`:"—"})]})]}),(0,t.jsxs)(l.Box,{sx:{display:"flex",gap:2,flexWrap:"wrap",mb:3},children:[ei?.schoolInfo?.MajorsOfferedLink&&(0,t.jsx)(o.Button,{size:"small",variant:"outlined",onClick:()=>window.open(ei.schoolInfo.MajorsOfferedLink,"_blank"),children:"View Majors"}),ei?.schoolInfo?.Questionnaire&&(0,t.jsx)(o.Button,{size:"small",variant:"outlined",onClick:()=>window.open(ei.schoolInfo.Questionnaire,"_blank"),children:"Recruiting Questionnaire"}),ei?.schoolInfo?.LandingPage&&(0,t.jsx)(o.Button,{size:"small",variant:"outlined",onClick:()=>window.open(ei.schoolInfo.LandingPage,"_blank"),children:"Team Website"}),ei?.schoolInfo?.SchoolTwitter&&"-"!==ei.schoolInfo.SchoolTwitter&&(0,t.jsx)(o.Button,{size:"small",variant:"text",onClick:()=>window.open(ei.schoolInfo.SchoolTwitter,"_blank"),children:"Twitter"}),ei?.schoolInfo?.SchoolInstagram&&"-"!==ei.schoolInfo.SchoolInstagram&&(0,t.jsx)(o.Button,{size:"small",variant:"text",onClick:()=>window.open(ei.schoolInfo.SchoolInstagram,"_blank"),children:"Instagram"})]}),(0,t.jsx)(a.Typography,{variant:"subtitle1",sx:{mb:1},children:"Coaches"}),(0,t.jsx)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:1},children:(ei.coaches??[]).map(e=>{let a=e.id,i=e.firstName||e.FirstName||"",l=e.lastName||e.LastName||"",o=e.title||e.Position||"",n=e.email||e.Email;return(0,t.jsx)(m.FormControlLabel,{control:(0,t.jsx)(u.Checkbox,{checked:!!eo[a],onChange:()=>en(e=>({...e,[a]:!e[a]}))}),label:`${i} ${l} — ${o}${n?` (${n})`:""}`},a)})})]}),3===g&&(0,t.jsxs)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1.2fr 1fr"},gap:3},children:[(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"h6",gutterBottom:!0,children:"Selected Targets"}),(0,t.jsx)(a.Typography,{variant:"body2",children:U&&O?(0,t.jsxs)(t.Fragment,{children:["List: ",O.name]}):(0,t.jsxs)(t.Fragment,{children:["University: ",eP||"—"]})}),(0,t.jsx)(a.Typography,{variant:"body2",sx:{mt:1,mb:2},children:`Coaches: ${eI.length?eI.map(e=>`${e.firstName||e.FirstName||""} ${e.lastName||e.LastName||""}`.trim()||e.email||"").join(", "):"—"}`}),(0,t.jsxs)(l.Box,{sx:{mb:2,display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:1},children:[(0,t.jsx)(c.TextField,{label:"Template name",value:ex,onChange:e=>ey(e.target.value),size:"small"}),(0,t.jsx)(o.Button,{variant:"outlined",onClick:function(){var t,a;let i,l;if(!e?.email)return;let o=function(e,t){let a=String(e),i={[t.studentFullName]:"{{StudentFullName}}",[t.studentFirstName]:"{{StudentFirstName}}",[t.studentLastName]:"{{StudentLastName}}",[t.universityName]:"{{UniversityName}}"};for(let[e,l]of(t.primaryCoachLastName&&(i[t.primaryCoachLastName]="{{PrimaryCoachLastName}}"),t.coachList&&(i[t.coachList]="{{CoachList}}"),Object.entries(i)))if(e&&e.trim().length){let t=RegExp(Z(e),"g");a=a.replace(t,l)}return a}(eF||eA(),eQ());eg([(t={agencyEmail:e.email,clientId:v,name:ex||`Template ${new Date().toLocaleString()}`,html:o,enabledSections:eh},i=X(),a=[l={...t,id:Math.random().toString(36).slice(2)+Date.now().toString(36),createdAt:Date.now()},...i],localStorage.setItem(K,JSON.stringify(a)),l),...ef]),ey("")},disabled:!(eF||eA())||!e?.email,children:"Save as Template"}),(0,t.jsxs)(c.TextField,{select:!0,label:"Templates",value:eb,onChange:e=>(function(e){let t=ef.find(t=>t.id===e);if(!t)return;let a=function(e,t){let a=String(e);for(let[e,i]of Object.entries({"{{StudentFirstName}}":t.studentFirstName||"","{{StudentLastName}}":t.studentLastName||"","{{StudentFullName}}":t.studentFullName||"","{{UniversityName}}":t.universityName||"","{{PrimaryCoachLastName}}":t.primaryCoachLastName||"","{{CoachList}}":t.coachList||""})){let t=RegExp(Z(e),"g");a=a.replace(t,i)}return a}(t.html,eQ());eU(a),es(a),t.enabledSections&&eu(t.enabledSections),ev(e)})(String(e.target.value)),size:"small",children:[(0,t.jsx)(p.MenuItem,{value:"",children:"(Select a template)"}),ef.map(e=>(0,t.jsx)(p.MenuItem,{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)(a.Typography,{variant:"h6",gutterBottom:!0,children:"Email Sections"}),Object.entries(eh).map(([e,i])=>(0,t.jsxs)(A,{expanded:i,onChange:(t,a)=>eM(e,a),sx:{mb:1},children:[(0,t.jsx)(H,{expandIcon:(0,t.jsx)(W,{}),children:(0,t.jsxs)(l.Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,t.jsx)(_.Switch,{checked:i,onChange:t=>eM(e,t.target.checked)}),(0,t.jsx)(a.Typography,{sx:{textTransform:"capitalize"},children:e})]})}),(0,t.jsx)(D,{children:i?(0,t.jsxs)(l.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:1},children:["accomplishments"===e&&(ek.accomplishments||[]).map((e,a)=>(0,t.jsx)(m.FormControlLabel,{control:(0,t.jsx)(u.Checkbox,{checked:!!em.accomplishments?.[`acc-${a}`],onChange:e=>eB("accomplishments",`acc-${a}`,e.target.checked)}),label:e},`acc-${a}`)),"athletic"===e&&[{k:"m1",label:`${ek.athleteMetricsTitleOne||""}: ${ek.athleteMetricsValueOne||""}`.trim()},{k:"m2",label:`${ek.athleteMetricsTitleTwo||""}: ${ek.athleteMetricsValueTwo||""}`.trim()},{k:"m3",label:`${ek.athleteMetricsTitleThree||""}: ${ek.athleteMetricsValueThree||""}`.trim()},{k:"m4",label:`${ek.athleteMetricsTitleFour||""}: ${ek.athleteMetricsValueFour||""}`.trim()}].filter(e=>":"!==e.label).map(e=>(0,t.jsx)(m.FormControlLabel,{control:(0,t.jsx)(u.Checkbox,{checked:!!em.athletic?.[e.k],onChange:t=>eB("athletic",e.k,t.target.checked)}),label:e.label},e.k))]}):(0,t.jsx)(a.Typography,{variant:"body2",color:"text.secondary",children:"Section disabled"})})]},e))]}),(0,t.jsxs)(l.Box,{children:[(0,t.jsx)(a.Typography,{variant:"h6",gutterBottom:!0,children:"Preview"}),(0,t.jsx)(l.Box,{sx:{border:"1px solid #ddd",borderRadius:1,p:2,minHeight:200,bgcolor:"#fafafa"},children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:eF||eA()}})}),(0,t.jsxs)(l.Box,{sx:{display:"flex",gap:1,mt:2},children:[(0,t.jsx)(o.Button,{onClick:()=>navigator.clipboard.writeText(eF||eA()),children:"Copy HTML"}),(0,t.jsx)(o.Button,{onClick:async()=>{let e=eF||eA();try{if(navigator.clipboard&&"function"==typeof navigator.clipboard.write&&window.ClipboardItem){let t=new Blob([e],{type:"text/html"}),a=document.createElement("div");a.innerHTML=e;let i=(a.textContent||"").toString(),l=new Blob([i],{type:"text/plain"});await navigator.clipboard.write([new window.ClipboardItem({"text/html":t,"text/plain":l})])}else{let t=document.createElement("div");t.innerHTML=e,await navigator.clipboard.writeText(t.textContent||"")}}catch(e){console.error("Clipboard copy failed",e)}},children:"Copy Rich Text"}),(0,t.jsx)(o.Button,{variant:"outlined",onClick:eL,children:eT?"Gmail Connected":e$?"Connecting…":"Connect Gmail"}),(0,t.jsx)(o.Button,{variant:"outlined",onClick:eE,disabled:!eI.length||!eT,children:"Create Gmail Draft"}),(0,t.jsx)(o.Button,{variant:"contained",onClick:()=>es(eF||eA()),children:"Lock In"}),(0,t.jsx)(o.Button,{variant:"outlined",onClick:eG,disabled:!eF&&!eF&&(eR||!eI.length||!eP),children:eF?"Improve…":"Improve with AI"})]})]})]})]}),(0,t.jsxs)(l.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,t.jsx)(o.Button,{disabled:0===g,onClick:()=>x(e=>Math.max(0,e-1)),children:"Back"}),(0,t.jsx)(o.Button,{variant:"contained",onClick:ez,disabled:!eW||e_&&eH,children:e_?eH?"Generating…":"Generate":"Next"})]})]})}function ei(){return(0,t.jsxs)("main",{style:{padding:24},children:[(0,t.jsx)(a.Typography,{variant:"h4",gutterBottom:!0,children:"Recruiter"}),(0,t.jsx)(ea,{})]})}e.s(["default",()=>ei],65964)}]);