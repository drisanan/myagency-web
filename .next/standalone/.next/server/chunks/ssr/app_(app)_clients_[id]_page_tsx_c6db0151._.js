module.exports=[18750,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(17110),e=a.i(24089),f=a.i(77940),g=a.i(74908),h=a.i(28388),i=a.i(74653),j=a.i(782),j=j,k=a.i(94333),l=a.i(93598),m=a.i(24358),m=m,n=a.i(60204),o=a.i(80785),p=a.i(12218),q=a.i(9386),r=a.i(42419),r=r,s=a.i(1728),s=s,t=a.i(19470),u=a.i(48617),v=a.i(50944),w=a.i(66001),x=a.i(94195),y=a.i(48385),z=a.i(31796),A=a.i(43672),B=a.i(68386),C=a.i(15937),D=a.i(10446),E=a.i(7946),F=a.i(71682),G=a.i(70025),H=a.i(33217),I=a.i(37927);async function J(a,b){let c=await fetch(`/api/notes?athleteId=${encodeURIComponent(a)}&agencyEmail=${encodeURIComponent(b)}`);if(!c.ok)throw Error("Failed to load notes");let d=await c.json();return(d?.data).sort((a,b)=>b.createdAt-a.createdAt)}async function K(a){let b=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json","x-agency-email":a.agencyEmail},body:JSON.stringify(a)});if(!b.ok)throw Error("Failed to create note");let c=await b.json();return c?.data}async function L(a,b,c){let d=await fetch("/api/notes",{method:"PATCH",headers:{"Content-Type":"application/json","x-agency-email":c},body:JSON.stringify({id:a,...b,agencyEmail:c})});if(!d.ok)throw Error("Failed to update note");let e=await d.json();return e?.data}async function M(a,b){if(!(await fetch("/api/notes",{method:"DELETE",headers:{"Content-Type":"application/json","x-agency-email":b},body:JSON.stringify({id:a,agencyEmail:b})})).ok)throw Error("Failed to delete note");return!0}var N=a.i(29026);function O({athleteId:a}){let d,g,h,j,k,l,{session:m}=(0,N.useSession)(),n=m?.email||"",{notes:o,query:r,createNote:s,updateNote:u,deleteNote:v,creating:w,updating:x,deleting:O}=(d=(0,I.useQueryClient)(),g=["notes",a,n],h=(0,H.useQuery)({queryKey:g,queryFn:()=>J(a,n),enabled:!!(a&&n)}),j=(0,G.useMutation)({mutationFn:b=>K({...b,athleteId:a,agencyEmail:n,body:b.body}),onSuccess:()=>d.invalidateQueries({queryKey:g})}),k=(0,G.useMutation)({mutationFn:a=>L(a.id,a,n),onSuccess:()=>d.invalidateQueries({queryKey:g})}),l=(0,G.useMutation)({mutationFn:a=>M(a,n),onSuccess:()=>d.invalidateQueries({queryKey:g})}),{query:h,notes:h.data??[],createNote:j.mutateAsync,updateNote:k.mutateAsync,deleteNote:l.mutateAsync,creating:"pending"===j.status,updating:"pending"===k.status,deleting:"pending"===l.status}),[P,Q]=c.default.useState(!1),[R,S]=c.default.useState(null),[T,U]=c.default.useState({body:"",type:"other"}),[V,W]=c.default.useState(""),X=()=>{U({title:"",body:"",type:"other"}),S(null),W("")},Y=async()=>{if(!T.body?.trim())return void W("Body is required");try{R?await u({id:R.id,title:T.title,body:T.body,type:T.type}):await s({title:T.title,body:T.body,type:T.type,author:m?.email}),Q(!1),X()}catch(a){W(a?.message||"Failed to save")}},Z=async a=>{await v(a)};return(0,b.jsxs)(e.Box,{children:[(0,b.jsxs)(q.Stack,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[(0,b.jsx)(t.Typography,{variant:"h6",children:"Notes"}),(0,b.jsx)(f.Button,{variant:"contained",onClick:()=>{X(),Q(!0)},"data-testid":"note-add",startIcon:(0,b.jsx)(F.FaRegStickyNote,{}),children:"Add note"})]}),r.isLoading?(0,b.jsx)(t.Typography,{children:"Loading..."}):0===o.length?(0,b.jsx)(t.Typography,{color:"text.secondary",children:"No notes yet."}):(0,b.jsx)(q.Stack,{spacing:1.5,children:o.map(a=>(0,b.jsxs)(E.Paper,{variant:"outlined",sx:{p:1.5,display:"flex",gap:1,alignItems:"flex-start"},"data-testid":"note-item",children:[(0,b.jsxs)(q.Stack,{spacing:1,sx:{flex:1,minWidth:0},children:[(0,b.jsxs)(q.Stack,{direction:"row",alignItems:"center",spacing:1,sx:{flexWrap:"wrap"},children:[(0,b.jsx)(i.Chip,{size:"small",label:a.type||"other"}),(0,b.jsx)(t.Typography,{variant:"body2",color:"text.secondary",children:new Date(a.createdAt).toLocaleString()}),a.title?(0,b.jsx)(t.Typography,{variant:"subtitle2",sx:{fontWeight:700,ml:.5},noWrap:!0,children:a.title}):null]}),(0,b.jsx)(t.Typography,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:a.body})]}),(0,b.jsxs)(q.Stack,{direction:"row",spacing:1,children:[(0,b.jsx)(C.IconButton,{"aria-label":"Edit note",onClick:()=>{S(a),U({title:a.title||"",body:a.body||"",type:a.type||"other"}),W(""),Q(!0)},"data-testid":"note-edit",children:(0,b.jsx)(F.FaEdit,{})}),(0,b.jsx)(C.IconButton,{"aria-label":"Delete note",onClick:()=>Z(a.id),"data-testid":"note-delete",children:(0,b.jsx)(F.FaTrash,{})})]})]},a.id))}),(0,b.jsxs)(y.Dialog,{open:P,onClose:()=>Q(!1),fullWidth:!0,maxWidth:"xs",PaperProps:{sx:{minWidth:{xs:"80vw",md:"50vw"},minHeight:{xs:"20vh",md:"22vh"}}},children:[(0,b.jsxs)(B.DialogTitle,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[(0,b.jsxs)(e.Box,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,b.jsx)(e.Box,{component:"img",src:"/marketing/an-logo.png",alt:"Logo",sx:{width:32,height:32,objectFit:"contain"}}),(0,b.jsx)(t.Typography,{variant:"h6",children:R?"Edit note":"Add note"})]}),(0,b.jsx)(C.IconButton,{"aria-label":"Close",onClick:()=>Q(!1),children:"×"})]}),(0,b.jsxs)(A.DialogContent,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,b.jsx)(D.TextField,{label:"Subject",value:T.title||"",onChange:a=>U(b=>({...b,title:a.target.value})),"data-testid":"note-title"}),(0,b.jsx)(D.TextField,{label:"Type",select:!0,value:T.type||"other",onChange:a=>U(b=>({...b,type:a.target.value})),"data-testid":"note-type",children:["recruiting","account","advice","event","other"].map(a=>(0,b.jsx)(p.MenuItem,{value:a,children:a},a))}),(0,b.jsx)(D.TextField,{label:"Note",multiline:!0,minRows:3,value:T.body,onChange:a=>U(b=>({...b,body:a.target.value})),error:!!V,helperText:V,"data-testid":"note-body"})]}),(0,b.jsxs)(z.DialogActions,{children:[(0,b.jsx)(f.Button,{onClick:()=>Q(!1),children:"Cancel"}),(0,b.jsx)(f.Button,{variant:"contained",onClick:Y,disabled:w||x,"data-testid":"note-save",children:R?"Save changes":"Add note"})]})]})]})}var P=a.i(69237);function Q(){var a;let y=(0,v.useParams)(),z=(0,v.useSearchParams)(),A=(0,v.useRouter)(),B=Array.isArray(y?.id)?y?.id[0]:y?.id,[C,D]=c.default.useState(null),[E,F]=c.default.useState(0),[G,H]=c.default.useState(null),[I,J]=c.default.useState(null);c.default.useEffect(()=>{let a=!0;return(async()=>{if(!B)return;let b=await (0,w.getClient)(B);a&&J(b)})(),()=>{a=!1}},[B]);let K=c.default.useMemo(()=>I?.id?(0,x.getMailEntries)().filter(a=>a.clientId===I.id):[],[I?.id]);if(c.default.useEffect(()=>{"notes"===z?.get("tab")&&F(1)},[z]),!I)return(0,b.jsx)(e.Box,{sx:{p:3},children:(0,b.jsx)(t.Typography,{variant:"h6",children:"Athlete not found"})});let L=`${I.firstName??""} ${I.lastName??""}`.trim()||"Unknown Athlete",M=(a=I.sport)?a.replace(/([a-z])([A-Z])/g,"$1 $2"):"Unknown sport",N=I.photoUrl||I.profileImageUrl||"/marketing/an-logo.png",Q=()=>D(null);return(0,b.jsxs)(e.Box,{sx:{p:3,bgcolor:"#fff",borderRadius:2},children:[(0,b.jsxs)(q.Stack,{direction:"row",alignItems:"center",spacing:2,sx:{mb:2},children:[(0,b.jsx)(d.Avatar,{src:N,alt:L,sx:{width:56,height:56}}),(0,b.jsxs)(e.Box,{sx:{flex:1,minWidth:0},children:[(0,b.jsx)(t.Typography,{variant:"h6",noWrap:!0,children:L}),(0,b.jsx)(t.Typography,{variant:"body2",color:"text.secondary",noWrap:!0,children:M})]}),(0,b.jsx)(f.Button,{variant:"outlined",endIcon:(0,b.jsx)(u.IoChevronDownOutline,{}),onClick:a=>D(a.currentTarget),children:"Actions"}),(0,b.jsxs)(o.Menu,{anchorEl:C,open:!!C,onClose:Q,children:[(0,b.jsx)(p.MenuItem,{onClick:()=>{Q(),A.push(`/clients/${I.id}/edit`)},children:"Edit"}),(0,b.jsx)(p.MenuItem,{onClick:()=>{Q(),A.push(`/clients/${I.id}/delete`)},sx:{color:"#f04438"},children:"Delete account"})]})]}),(0,b.jsx)(k.Divider,{sx:{mb:2}}),(0,b.jsxs)(s.default,{value:E,onChange:(a,b)=>F(b),sx:{mb:1},children:[(0,b.jsx)(r.default,{label:"Emails"}),(0,b.jsx)(r.default,{label:"Notes","data-testid":"notes-tab"}),(0,b.jsx)(r.default,{label:"Tasks","data-testid":"tasks-tab"})]}),0===E&&(0,b.jsx)(g.Card,{variant:"outlined",sx:{borderRadius:2},children:(0,b.jsxs)(h.CardContent,{sx:{p:0},children:[(0,b.jsxs)(e.Box,{sx:{px:2,pt:2,pb:1,display:"flex",alignItems:"center",gap:2},children:[(0,b.jsx)(i.Chip,{label:"Sent",color:"primary",variant:"outlined"}),(0,b.jsxs)(t.Typography,{variant:"body2",color:"text.secondary",children:[K.length," sent"]})]}),(0,b.jsx)(k.Divider,{}),(0,b.jsxs)(l.List,{disablePadding:!0,children:[K.map(a=>{let d=a.id||`${a.email||a.to||""}-${a.subject||""}-${a.mailedAt||a.sentAt||a.date||""}`,g=G===d,h=a.sentAt||a.date||a.mailedAt||Date.now();return(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsx)(m.default,{secondaryAction:(0,b.jsxs)(q.Stack,{alignItems:"flex-end",spacing:.5,children:[(0,b.jsxs)(t.Typography,{variant:"body2",color:"text.secondary",children:[new Date(h).toLocaleDateString()," ",new Date(h).toLocaleTimeString()]}),(0,b.jsx)(f.Button,{size:"small",onClick:()=>H(g?null:d),children:g?"Hide":"View"})]}),children:(0,b.jsx)(n.ListItemText,{primary:(0,b.jsxs)(q.Stack,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[(0,b.jsx)(t.Typography,{variant:"subtitle2",children:(a.recipientFirstName||"First")+" "+(a.recipientLastName||"Last")}),(0,b.jsxs)(t.Typography,{variant:"body2",color:"text.secondary",children:["• ",a.university||"University"]}),(0,b.jsxs)(t.Typography,{variant:"body2",color:"text.secondary",children:["• ",a.position||"Position"]})]}),secondary:(0,b.jsx)(t.Typography,{variant:"body2",color:"text.secondary",noWrap:!0,children:a.subject||"(No subject)"})})}),(0,b.jsx)(j.default,{in:g,timeout:"auto",unmountOnExit:!0,children:(0,b.jsx)(e.Box,{sx:{px:3,pb:2},children:(0,b.jsx)(t.Typography,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap"},children:a.body||a.html||"(No content)"})})}),(0,b.jsx)(k.Divider,{})]},d)}),0===K.length&&(0,b.jsx)(e.Box,{sx:{px:3,py:4},children:(0,b.jsx)(t.Typography,{variant:"body2",color:"text.secondary",children:"No sent emails yet."})})]})]})}),1===E&&(0,b.jsx)(e.Box,{sx:{mt:2},children:(0,b.jsx)(O,{athleteId:I.id})}),2===E&&(0,b.jsx)(e.Box,{sx:{mt:2},children:(0,b.jsx)(P.TasksPanel,{athleteId:I.id})})]})}a.s(["default",()=>Q],18750)}];

//# sourceMappingURL=app_%28app%29_clients_%5Bid%5D_page_tsx_c6db0151._.js.map